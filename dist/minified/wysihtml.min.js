/*! wysihtml - v0.6.0-beta1 (2018-03-19) */

var wysihtml={version:"0.6.0-beta1",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},editorExtenders:[],extendEditor:function(e){this.editorExtenders.push(e)},INVISIBLE_SPACE:"\ufeff",INVISIBLE_SPACE_REG_EXP:/\uFEFF/g,VOID_ELEMENTS:"area, base, br, col, embed, hr, img, input, keygen, link, meta, param, source, track, wbr",PERMITTED_PHRASING_CONTENT_ONLY:"h1, h2, h3, h4, h5, h6, p, pre",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,TAB_KEY:9,DELETE_KEY:46};wysihtml.polyfills=function(f,d){var n={normalizeHasCaretError:function(){if("createRange"in d&&"getSelection"in f){var e,t,n,o=window.pageYOffset,r=window.pageXOffset,i=d.createElement("div"),s=d.createTextNode("a"),a=d.createTextNode("a"),l=d.createTextNode("a"),c=d.createRange();return document.activeElement&&(1===document.activeElement.nodeType&&-1<["INPUT","TEXTAREA","SELECT","BUTTON"].indexOf(document.activeElement.nodeName)?e={type:"form",node:document.activeElement,start:document.activeElement.selectionStart,end:document.activeElement.selectionEnd}:(t=f.getSelection())&&t.anchorNode&&(e={type:"range",anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset})),i.setAttribute("contenteditable","true"),i.appendChild(s),i.appendChild(a),i.appendChild(l),d.body.appendChild(i),c.setStart(a,1),c.setEnd(a,1),(t=f.getSelection()).removeAllRanges(),t.addRange(c),i.normalize(),t=f.getSelection(),n=1!==i.childNodes.length||t.anchorNode!==i.firstChild||2!==t.anchorOffset,i.parentNode.removeChild(i),t.removeAllRanges(),e&&("form"===e.type?(void 0!==e.start&&void 0!==e.end&&e.node.setSelectionRange(e.start,e.end),e.node.focus()):"range"===e.type&&((c=d.createRange()).setStart(e.anchorNode,e.anchorOffset),c.setEnd(e.focusNode,e.focusOffset),t.addRange(c))),o===window.pageYOffset&&r===window.pageXOffset||f.scrollTo(r,o),n}},apply:function(){var e;(e=f.Element.prototype).matches=e.matches||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=this,n=(t.document||t.ownerDocument).querySelectorAll(e),o=0;n[o]&&n[o]!==t;)++o;return!!n[o]},e.closest=e.closest||function(e){for(var t=this;t&&!t.matches(e);)t=t.parentElement;return t},e.remove=e.remove||function(){this.parentNode&&this.parentNode.removeChild(this)},"classList"in d.documentElement||!f.Object.defineProperty||void 0===f.HTMLElement||f.Object.defineProperty(f.HTMLElement.prototype,"classList",{get:function(){var r=this;function e(o){return function(e){var t=r.className.split(/\s+/),n=t.indexOf(e);o(t,n,e),r.className=t.join(" ")}}var t={add:e(function(e,t,n){~t||e.push(n)}),remove:e(function(e,t){~t&&e.splice(t,1)}),toggle:e(function(e,t,n){~t?e.splice(t,1):e.push(n)}),contains:function(e){return!!~r.className.split(/\s+/).indexOf(e)},item:function(e){return r.className.split(/\s+/)[e]||null}};return f.Object.defineProperty(t,"length",{get:function(){return r.className.split(/\s+/).length}}),t}});var u=function(e){var t=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t.push(e):t=t.concat(u(e));return t},t=function(){f.removeEventListener("load",t),"Node"in f&&"normalize"in f.Node.prototype&&n.normalizeHasCaretError()&&function(){f.Node.prototype.normalize;f.Node.prototype.normalize=function(){var e=u(this),t=this.ownerDocument.defaultView.getSelection(),n=t.anchorNode,o=t.anchorOffset,r=n&&1===n.nodeType&&0<n.childNodes.length?n.childNodes[o]:void 0,i=t.focusNode,s=t.focusOffset,a=i&&1===i.nodeType&&0<s?i.childNodes[s-1]:void 0,l=this.ownerDocument.createRange(),c=e.shift(),d=c?e.shift():null;for(a&&3===a.nodeType&&(s=(i=a).nodeValue.length,a=void 0),r&&3===r.nodeType&&(n=r,r=void(o=0)),(n===i&&s<o||n!==i&&n.compareDocumentPosition(i)&f.Node.DOCUMENT_POSITION_PRECEDING&&!(n.compareDocumentPosition(i)&f.Node.DOCUMENT_POSITION_CONTAINS))&&(i=[n,n=i][0],s=[o,o=s][0]);c&&d;)d.previousSibling&&d.previousSibling===c?(n===d&&(o=(n=c).nodeValue.length+o),i===d&&(s=(i=c).nodeValue.length+s),c.nodeValue=c.nodeValue+d.nodeValue,d.parentNode.removeChild(d)):c=d,d=e.shift();a&&(s=Array.prototype.indexOf.call(a.parentNode.childNodes,a)+1),r&&(o=Array.prototype.indexOf.call(r.parentNode.childNodes,r)),function(e){var t=e.ownerDocument,n=e;do{if(n===t)return!0;n=n.parentNode}while(n);return!1}(this)&&n&&n.parentNode&&i&&i.parentNode&&(l.setStart(n,o),l.setEnd(i,s),t.removeAllRanges(),t.addRange(l))}}()};"complete"!==d.readyState?f.addEventListener("load",t):t(),function(){if(!function(){try{var e=new f.CustomEvent("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()&&"CustomEvent"in f){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=d.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=f.Event.prototype,f.CustomEvent=e}}()}};return n},wysihtml.polyfills(window,document).apply();var rangy,Base=function(){};Base.extend=function(e,t){var n=Base.prototype.extend;Base._prototyping=!0;var o=new this;n.call(o,e),o.base=function(){},delete Base._prototyping;var r=o.constructor,i=o.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==i)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],o)};return i.ancestor=this,i.extend=this.extend,i.forEach=this.forEach,i.implement=this.implement,i.prototype=o,i.toString=this.toString,i.valueOf=function(e){return"object"==e?i:r.valueOf()},n.call(i,t),"function"==typeof i.init&&i.init(),i},Base.prototype={extend:function(e,t){if(1<arguments.length){var n=this[e];if(n&&"function"==typeof t&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var o=t.valueOf();(t=function(){var e=this.base||Base.prototype.base;this.base=n;var t=o.apply(this,arguments);return this.base=e,t}).valueOf=function(e){return"object"==e?t:o},t.toString=Base.toString}this[e]=t}else if(e){var r=Base.prototype.extend;Base._prototyping||"function"==typeof this||(r=this.extend||r);for(var i={toSource:null},s=["constructor","toString","valueOf"],a=Base._prototyping?0:1;l=s[a++];)e[l]!=i[l]&&r.call(this,l,e[l]);for(var l in e)i[l]||r.call(this,l,e[l])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var o in e)void 0===this.prototype[o]&&t.call(n,e[o],o,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),function(){var o="object",r="function",n="undefined",l=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],c=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],t=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],i=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function d(e,t){var n=typeof e[t];return n==r||!(n!=o||!e[t])||"unknown"==n}function s(e,t){return!(typeof e[t]!=o||!e[t])}function e(e,t){return typeof e[t]!=n}function a(o){return function(e,t){for(var n=t.length;n--;)if(!o(e,t[n]))return!1;return!0}}var u=a(d),f=a(s),h=a(e);function m(e){return e&&u(e,i)&&h(e,t)}function p(e){return s(e,"body")?e.body:e.getElementsByTagName("body")[0]}var g,y,v={},N=typeof window!=n&&typeof document!=n,C={isHostMethod:d,isHostObject:s,isHostProperty:e,areHostMethods:u,areHostObjects:f,areHostProperties:h,isTextRange:m,getBody:p,forEach:[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,o=e.length;n<o;++n)t(e[n],n)}},b={version:"1.3.1-dev",initialized:!1,isBrowser:N,supported:!0,util:C,features:{},modules:v,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==n||rangyAutoInitialize}};function w(e){typeof console!=n&&d(console,"log")&&console.log(e)}function E(e,t){N&&t?alert(e):w(e)}function S(e){b.initialized=!0,b.supported=!1,E("Rangy is not supported in this environment. Reason: "+e,b.config.alertOnFail)}b.fail=S,b.warn=function(e){E("Rangy warning: "+e,b.config.alertOnWarn)},!{}.hasOwnProperty?S("hasOwnProperty not supported"):(C.extend=g=function(e,t,n){var o,r;for(var i in t)t.hasOwnProperty(i)&&(o=e[i],r=t[i],n&&null!==o&&"object"==typeof o&&null!==r&&"object"==typeof r&&g(o,r,!0),e[i]=r);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},C.createOptions=function(e,t){var n={};return g(n,t),e&&g(n,e),n}),N||S("Rangy can only run in a browser"),function(){var e;if(N){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(e){}}e||(e=function(e){for(var t=[],n=0,o=e.length;n<o;++n)t[n]=e[n];return t}),C.toArray=e}(),N&&(d(document,"addEventListener")?y=function(e,t,n){e.addEventListener(t,n,!1)}:d(document,"attachEvent")?y=function(e,t,n){e.attachEvent("on"+t,n)}:S("Document does not have required addEventListener or attachEvent method"),C.addListener=y);var T=[];function x(e){return e.message||e.description||String(e)}function R(){if(N&&!b.initialized){var e,t=!1,n=!1;d(document,"createRange")&&(e=document.createRange(),u(e,c)&&h(e,l)&&(t=!0));var o=p(document);if(o&&"body"==o.nodeName.toLowerCase())if(o&&d(o,"createTextRange")&&m(e=o.createTextRange())&&(n=!0),t||n){var r;for(var i in b.initialized=!0,b.features={implementsDomRange:t,implementsTextRange:n},v)(r=v[i])instanceof _&&r.init(r,b);for(var s=0,a=T.length;s<a;++s)try{T[s](b)}catch(e){w("Rangy init listener threw an exception. Continuing. Detail: "+x(e))}}else S("Neither Range nor TextRange are available");else S("No body element found")}}function O(e,t,n){n&&(e+=" in module "+n.name),b.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function A(e,t,n,o){e[t]=function(){return O(t,n,o),e[n].apply(e,C.toArray(arguments))}}C.deprecationNotice=O,C.createAliasForDeprecatedMethod=A,b.init=R,b.addInitListener=function(e){b.initialized?e(b):T.push(e)};var L=[];function _(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function B(t,e,n){var o=new _(t,e,function(e){if(!e.initialized){e.initialized=!0;try{n(b,e),e.supported=!0}catch(e){w("Module '"+t+"' failed to load: "+x(e)),e.stack&&w(e.stack)}}});return v[t]=o}function P(){}b.addShimListener=function(e){L.push(e)},N&&(b.shim=b.createMissingNativeApi=function(e){e=e||window,R();for(var t=0,n=L.length;t<n;++t)L[t](e)},A(b,"createMissingNativeApi","shim")),_.prototype={init:function(){for(var e,t,n=this.dependencies||[],o=0,r=n.length;o<r;++o){if(t=n[o],!((e=v[t])&&e instanceof _))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){b.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){b.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},b.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var o=B(e,n,t);b.initialized&&b.supported&&o.init()},b.createCoreModule=function(e,t,n){B(e,t,n)},b.RangePrototype=P,b.rangePrototype=new P,b.selectionPrototype=new function(){},b.createCoreModule("DomUtil",[],function(n,c){var o="undefined",r=n.util,s=r.getBody;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||c.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||c.fail("document missing getElementsByTagName method");var e=document.createElement("div");r.areHostMethods(e,["insertBefore","appendChild","cloneNode"])||c.fail("Incomplete Element implementation"),r.isHostProperty(e,"innerHTML")||c.fail("Element is missing innerHTML property");var t=document.createTextNode("test");r.areHostMethods(t,["splitText","deleteData","insertData","appendData","cloneNode"])||c.fail("Incomplete Text Node implementation");var i=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};function d(e){for(var t=0;e=e.previousSibling;)++t;return t}function u(e,t){var n,o=[];for(n=e;n;n=n.parentNode)o.push(n);for(n=t;n;n=n.parentNode)if(i(o,n))return n;return null}function a(e,t,n){for(var o=n?t:t.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1}function f(e,t,n){for(var o,r=n?e:e.parentNode;r;){if((o=r.parentNode)===t)return r;r=o}return null}function l(e){var t=e.nodeType;return 3==t||4==t||8==t}function h(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e}function m(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=o)return e.ownerDocument;if(typeof e.document!=o)return e.document;if(e.parentNode)return m(e.parentNode);throw c.createError("getDocument: no document found for node")}function p(e){var t=m(e);if(typeof t.defaultView!=o)return t.defaultView;if(typeof t.parentWindow!=o)return t.parentWindow;throw c.createError("Cannot get a window object for node")}function g(e){if(typeof e.contentDocument!=o)return e.contentDocument;if(typeof e.contentWindow!=o)return e.contentWindow.document;throw c.createError("getIframeDocument: No Document object found for iframe element")}function y(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}var v,N=!1;function C(e){try{return e.parentNode,!1}catch(e){return!0}}function b(e){if(!e)return"[No node]";if(N&&C(e))return"[Broken node]";if(l(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+d(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function w(e){this.root=e,this._next=e}function E(e,t){this.node=e,this.offset=t}function S(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}!function(){var e=document.createElement("b");e.innerHTML="1";var t=e.firstChild;e.innerHTML="<br />",N=C(t),n.features.crashyTextNodes=N}(),typeof window.getComputedStyle!=o?v=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=o?v=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:c.fail("No means of obtaining computed style properties found"),w.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},E.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+b(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},(S.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24}).toString=function(){return this.message},n.dom={arrayContains:i,isHtmlNamespace:function(e){var t;return typeof e.namespaceURI==o||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){var t=e.parentNode;return 1==t.nodeType?t:null},getNodeIndex:d,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:u,isAncestorOf:a,isOrIsAncestorOf:function(e,t){return a(e,t,!0)},getClosestAncestorIn:f,isCharacterDataNode:l,isTextOrCommentNode:function(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t},insertAfter:h,splitDataNode:function(e,t,n){var o=e.cloneNode(!1);if(o.deleteData(0,t),e.deleteData(t,e.length-t),h(o,e),n)for(var r,i=0;r=n[i++];)r.node==e&&r.offset>t?(r.node=o,r.offset-=t):r.node==e.parentNode&&r.offset>d(e)&&++r.offset;return o},getDocument:m,getWindow:p,getIframeWindow:function(e){if(typeof e.contentWindow!=o)return e.contentWindow;if(typeof e.contentDocument!=o)return e.contentDocument.defaultView;throw c.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:g,getBody:s,isWindow:y,getContentDocument:function(e,t,n){var o;if(e?r.isHostProperty(e,"nodeType")?o=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?g(e):m(e):y(e)&&(o=e.document):o=document,!o)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return o},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,t,n,o){var r,i,s,a,l;if(e==n)return t===o?0:t<o?-1:1;if(r=f(n,e,!0))return t<=d(r)?-1:1;if(r=f(e,n,!0))return d(r)<o?-1:1;if(!(i=u(e,n)))throw new Error("comparePoints error: nodes have no common ancestor");if((s=e===i?i:f(e,i,!0))===(a=n===i?i:f(n,i,!0)))throw c.createError("comparePoints got to case 4 and childA and childB are the same!");for(l=i.firstChild;l;){if(l===s)return-1;if(l===a)return 1;l=l.nextSibling}},isBrokenNode:C,inspectNode:b,getComputedStyleProperty:v,createTestElement:function(e,t,n){var o=s(e),r=e.createElement("div");r.contentEditable=""+!!n,t&&(r.innerHTML=t);var i=o.firstChild;return i?o.insertBefore(r,i):o.appendChild(r),r},removeNode:function(e){return e.parentNode.removeChild(e)},fragmentFromNodeChildren:function(e){for(var t,n=m(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new w(e)},DomPosition:E},n.DOMException=S}),b.createCoreModule("DomRange",["DomUtil"],function(s,e){var a=s.dom,o=s.util,t=a.DomPosition,l=s.DOMException,u=a.isCharacterDataNode,f=a.getNodeIndex,c=a.isOrIsAncestorOf,r=a.getDocument,h=a.comparePoints,d=a.splitDataNode,m=a.getClosestAncestorIn,p=a.getNodeLength,i=a.arrayContains,g=a.getRootContainer,n=s.features.crashyTextNodes,y=a.removeNode;function v(e,t){return 3!=e.nodeType&&(c(e,t.startContainer)||c(e,t.endContainer))}function N(e){return e.document||r(e.startContainer)}function C(e){return new t(e.parentNode,f(e))}function b(e){return new t(e.parentNode,f(e)+1)}function w(e,t,n){var o=11==e.nodeType?e.firstChild:e;return u(t)?n==t.length?a.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:d(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),o}function E(e,t,n){if(z(e),z(t),N(t)!=N(e))throw new l("WRONG_DOCUMENT_ERR");var o=h(e.startContainer,e.startOffset,t.endContainer,t.endOffset),r=h(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?o<=0&&0<=r:o<0&&0<r}function S(e,t,n){var o,r,i,s;for(n=n||{stop:!1};i=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(i))return void(n.stop=!0);if(S(s=e.getSubtreeIterator(),t,n),s.detach(),n.stop)return}else for(o=a.createIterator(i);r=o.next();)if(!1===t(r))return void(n.stop=!0)}function T(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(T(t=e.getSubtreeIterator()),t.detach()):e.remove()}function x(e){for(var t,n,o=N(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(x(n)),n.detach()):e.remove(),10==t.nodeType)throw new l("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function R(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+a.inspectNode(e.startContainer)+":"+e.startOffset+", "+a.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function O(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&u(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||u(this.sc)?m(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||u(this.ec)?m(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}O.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,u(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!u(n)||n!==this.sc&&n!==this.ec?n.parentNode&&y(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return v(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new fe(N(this.range));var t=this._current,n=t,o=0,r=t,i=p(t);c(t,this.sc)&&(n=this.sc,o=this.so),c(t,this.ec)&&(r=this.ec,i=this.eo),ue(e,n,o,r,i)}return new O(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var A=[1,3,4,5,7,8,10],L=[2,9,11],_=[1,3,4,5,7,8,10,11],B=[1,3,4,5,7,8];function P(r){return function(e,t){for(var n,o=t?e:e.parentNode;o;){if(n=o.nodeType,i(r,n))return o;o=o.parentNode}return null}}var I=P([9,11]),D=P([5,6,10,12]),k=P([6,10,12]);function M(e,t){if(k(e,t))throw new l("INVALID_NODE_TYPE_ERR")}function H(e,t){if(!i(t,e.nodeType))throw new l("INVALID_NODE_TYPE_ERR")}function V(e,t){if(t<0||t>(u(e)?e.length:e.childNodes.length))throw new l("INDEX_SIZE_ERR")}function F(e,t){if(I(e,!0)!==I(t,!0))throw new l("WRONG_DOCUMENT_ERR")}function W(e){if(D(e,!0))throw new l("NO_MODIFICATION_ALLOWED_ERR")}function q(e,t){if(!e)throw new l(t)}function U(e,t){return t<=(u(e)?e.length:e.childNodes.length)}function j(e){return!!e.startContainer&&!!e.endContainer&&!(n&&(a.isBrokenNode(e.startContainer)||a.isBrokenNode(e.endContainer)))&&g(e.startContainer)==g(e.endContainer)&&U(e.startContainer,e.startOffset)&&U(e.endContainer,e.endOffset)}function z(e){if(!j(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var $=document.createElement("style"),K=!1;try{$.innerHTML="<b>x</b>",K=3==$.firstChild.nodeType}catch(e){}var G=(s.features.htmlParsingConforms=K)?function(e){var t=this.startContainer,n=r(t);if(!t)throw new l("INVALID_STATE_ERR");var o=null;return 1==t.nodeType?o=t:u(t)&&(o=a.parentElement(t)),(o=null===o||"HTML"==o.nodeName&&a.isHtmlNamespace(r(o).documentElement)&&a.isHtmlNamespace(o)?n.createElement("body"):o.cloneNode(!1)).innerHTML=e,a.fragmentFromNodeChildren(o)}:function(e){var t=N(this).createElement("body");return t.innerHTML=e,a.fragmentFromNodeChildren(t)};function Y(e,t){z(e);var n=e.startContainer,o=e.startOffset,r=e.endContainer,i=e.endOffset,s=n===r;u(r)&&0<i&&i<r.length&&d(r,i,t),u(n)&&0<o&&o<n.length&&(n=d(n,o,t),s?(i-=o,r=n):r==n.parentNode&&i>=f(n)&&i++,o=0),e.setStartAndEnd(n,o,r,i)}function X(e){z(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}var Q=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],Z=0,J=1,ee=2,te=3,ne=0,oe=1,re=2,ie=3;function se(e){e.START_TO_START=Z,e.START_TO_END=J,e.END_TO_END=ee,e.END_TO_START=te,e.NODE_BEFORE=ne,e.NODE_AFTER=oe,e.NODE_BEFORE_AND_AFTER=re,e.NODE_INSIDE=ie}function ae(e){se(e),se(e.prototype)}function le(s,a){return function(){z(this);var e,t=this.startContainer,n=this.startOffset,o=this.commonAncestorContainer,r=new O(this,!0);t!==o&&(t=(e=b(m(t,o,!0))).node,n=e.offset),S(r,W),r.reset();var i=s(r);return r.detach(),a(this,t,n,t,n),i}}function ce(e,d){function t(n,o){return function(e){H(e,A),H(g(e),L);var t=(n?C:b)(e);(o?r:i)(this,t.node,t.offset)}}function r(e,t,n){var o=e.endContainer,r=e.endOffset;t===e.startContainer&&n===e.startOffset||(g(t)==g(o)&&1!=h(t,n,o,r)||(o=t,r=n),d(e,t,n,o,r))}function i(e,t,n){var o=e.startContainer,r=e.startOffset;t===e.endContainer&&n===e.endOffset||(g(t)==g(o)&&-1!=h(t,n,o,r)||(o=t,r=n),d(e,o,r,t,n))}var n=function(){};n.prototype=s.rangePrototype,e.prototype=new n,o.extend(e.prototype,{setStart:function(e,t){M(e,!0),V(e,t),r(this,e,t)},setEnd:function(e,t){M(e,!0),V(e,t),i(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],o=t,r=n;switch(e.length){case 3:r=e[2];break;case 4:o=e[2],r=e[3]}d(this,t,n,o,r)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:t(!0,!0),setStartAfter:t(!1,!0),setEndBefore:t(!0,!1),setEndAfter:t(!1,!1),collapse:function(e){z(this),e?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){M(e,!0),d(this,e,0,e,p(e))},selectNode:function(e){M(e,!1),H(e,A);var t=C(e),n=b(e);d(this,t.node,t.offset,n.node,n.offset)},extractContents:le(x,d),deleteContents:le(T,d),canSurroundContents:function(){z(this),W(this.startContainer),W(this.endContainer);var e=new O(this,!0),t=e._first&&v(e._first,this)||e._last&&v(e._last,this);return e.detach(),!t},splitBoundaries:function(){Y(this)},splitBoundariesPreservingPositions:function(e){Y(this,e)},normalizeBoundaries:function(){z(this);var e,r=this.startContainer,i=this.startOffset,s=this.endContainer,a=this.endOffset,t=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(a=(s=e).length,e.appendData(t.data),y(t))},n=function(e){var t=e.previousSibling;if(t&&t.nodeType==e.nodeType){var n=(r=e).length;if(i=t.length,e.insertData(0,t.data),y(t),r==s)a+=i,s=r;else if(s==e.parentNode){var o=f(e);a==o?(s=e,a=n):o<a&&a--}}},o=!0;if(u(s))a==s.length?t(s):0==a&&(e=s.previousSibling)&&e.nodeType==s.nodeType&&(a=e.length,r==s&&(o=!1),e.appendData(s.data),y(s),s=e);else{if(0<a){var l=s.childNodes[a-1];l&&u(l)&&t(l)}o=!this.collapsed}if(o){if(u(r))0==i?n(r):i==r.length&&(e=r.nextSibling)&&e.nodeType==r.nodeType&&(s==e&&(a+=(s=r).length),r.appendData(e.data),y(e));else if(i<r.childNodes.length){var c=r.childNodes[i];c&&u(c)&&n(c)}}else r=s,i=a;d(this,r,i,s,a)},collapseToPoint:function(e,t){M(e,!0),V(e,t),this.setStartAndEnd(e,t)}}),ae(e)}function de(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:a.getCommonAncestor(e.startContainer,e.endContainer)}function ue(e,t,n,o,r){e.startContainer=t,e.startOffset=n,e.endContainer=o,e.endOffset=r,e.document=a.getDocument(t),de(e)}function fe(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,de(this)}o.extend(s.rangePrototype,{compareBoundaryPoints:function(e,t){var n,o,r,i;z(this),F(this.startContainer,t.startContainer);var s=e==te||e==Z?"start":"end",a=e==J||e==Z?"start":"end";return n=this[s+"Container"],o=this[s+"Offset"],r=t[a+"Container"],i=t[a+"Offset"],h(n,o,r,i)},insertNode:function(e){if(z(this),H(e,_),W(this.startContainer),c(e,this.startContainer))throw new l("HIERARCHY_REQUEST_ERR");var t=w(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var e,t;if(z(this),this.collapsed)return N(this).createDocumentFragment();if(this.startContainer===this.endContainer&&u(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=N(this).createDocumentFragment()).appendChild(e),t;var n=new O(this,!0);return e=function e(t){for(var n,o,r,i=N(t.range).createDocumentFragment();o=t.next();){if(n=t.isPartiallySelectedSubtree(),o=o.cloneNode(!n),n&&(r=t.getSubtreeIterator(),o.appendChild(e(r)),r.detach()),10==o.nodeType)throw new l("HIERARCHY_REQUEST_ERR");i.appendChild(o)}return i}(n),n.detach(),e},canSurroundContents:function(){z(this),W(this.startContainer),W(this.endContainer);var e=new O(this,!0),t=e._first&&v(e._first,this)||e._last&&v(e._last,this);return e.detach(),!t},surroundContents:function(e){if(H(e,B),!this.canSurroundContents())throw new l("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);w(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){z(this);for(var e,t=new fe(N(this)),n=Q.length;n--;)t[e=Q[n]]=this[e];return t},toString:function(){z(this);var e=this.startContainer;if(e===this.endContainer&&u(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new O(this,!0);return S(n,function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){z(this);var t=e.parentNode,n=f(e);if(!t)throw new l("NOT_FOUND_ERR");var o=this.comparePoint(t,n),r=this.comparePoint(t,n+1);return o<0?0<r?re:ne:0<r?oe:ie},comparePoint:function(e,t){return z(this),q(e,"HIERARCHY_REQUEST_ERR"),F(e,this.startContainer),h(e,t,this.startContainer,this.startOffset)<0?-1:0<h(e,t,this.endContainer,this.endOffset)?1:0},createContextualFragment:G,toHtml:function(){return X(this)},intersectsNode:function(e,t){if(z(this),g(e)!=g(this.startContainer))return!1;var n=e.parentNode,o=f(e);if(!n)return!0;var r=h(n,o,this.endContainer,this.endOffset),i=h(n,o+1,this.startContainer,this.startOffset);return t?r<=0&&0<=i:r<0&&0<i},isPointInRange:function(e,t){return z(this),q(e,"HIERARCHY_REQUEST_ERR"),F(e,this.startContainer),0<=h(e,t,this.startContainer,this.startOffset)&&h(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return E(this,e,!1)},intersectsOrTouchesRange:function(e){return E(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=h(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=h(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange();return-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==h(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==h(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new l("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ie},containsNodeContents:function(e){return 0<=this.comparePoint(e,0)&&this.comparePoint(e,p(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(0<n.length){t.setStart(n[0],0);var o=n.pop();return t.setEnd(o,o.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return z(this),function(o,e,r){var i,s=!(!e||!e.length),a=!!r;s&&(i=new RegExp("^("+e.join("|")+")$"));var l=[];return S(new O(o,!1),function(e){if((!s||i.test(e.nodeType))&&(!a||r(e))){var t=o.startContainer;if(e!=t||!u(t)||o.startOffset!=t.length){var n=o.endContainer;e==n&&u(n)&&0==o.endOffset||l.push(e)}}}),l}(this,e,t)},getDocument:function(){return N(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(e){var t=N(this),n=s.createRange(t);e=e||a.getBody(t),n.selectNodeContents(e);var o=this.intersection(n),r=0,i=0;return o&&(n.setEnd(o.startContainer,o.startOffset),i=(r=n.toString().length)+o.toString().length),{start:r,end:i,containerNode:e}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var o,r,i,s,a=[t],l=!1,c=!1;!c&&(o=a.pop());)if(3==o.nodeType)r=n+o.length,!l&&e.start>=n&&e.start<=r&&(this.setStart(o,e.start-n),l=!0),l&&e.end>=n&&e.end<=r&&(this.setEnd(o,e.end-n),c=!0),n=r;else for(i=(s=o.childNodes).length;i--;)a.push(s[i])},getName:function(){return"DomRange"},equals:function(e){return fe.rangesEqual(this,e)},isValid:function(){return j(this)},inspect:function(){return R(this)},detach:function(){}}),ce(fe,ue),o.extend(fe,{rangeProperties:Q,RangeIterator:O,copyComparisonConstants:ae,createPrototypeRange:ce,inspect:R,toHtml:X,getRangeDocument:N,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),s.DomRange=fe}),b.createCoreModule("WrappedRange",["DomRange"],function(d,u){var f,e,w=d.dom,h=d.util,E=w.DomPosition,m=d.DomRange,p=w.getBody,g=w.getContentDocument,S=w.isCharacterDataNode;if(d.features.implementsDomRange&&function(){var t,n,o=m.rangeProperties;function r(e){for(var t,n=o.length;n--;)e[t=o[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}f=function(e){if(!e)throw u.createError("WrappedRange: Range must be specified");this.nativeRange=e,r(this)},m.createPrototypeRange(f,function(e,t,n,o,r){var i=e.startContainer!==t||e.startOffset!=n,s=e.endContainer!==o||e.endOffset!=r,a=!e.equals(e.nativeRange);(i||s||a)&&(e.setEnd(o,r),e.setStart(t,n))}),(t=f.prototype).selectNode=function(e){this.nativeRange.selectNode(e),r(this)},t.cloneContents=function(){return this.nativeRange.cloneContents()},t.surroundContents=function(e){this.nativeRange.surroundContents(e),r(this)},t.collapse=function(e){this.nativeRange.collapse(e),r(this)},t.cloneRange=function(){return new f(this.nativeRange.cloneRange())},t.refresh=function(){r(this)},t.toString=function(){return this.nativeRange.toString()};var e=document.createTextNode("test");p(document).appendChild(e);var i=document.createRange();i.setStart(e,0),i.setEnd(e,0);try{i.setStart(e,1),t.setStart=function(e,t){this.nativeRange.setStart(e,t),r(this)},t.setEnd=function(e,t){this.nativeRange.setEnd(e,t),r(this)},n=function(t){return function(e){this.nativeRange[t](e),r(this)}}}catch(e){t.setStart=function(t,n){try{this.nativeRange.setStart(t,n)}catch(e){this.nativeRange.setEnd(t,n),this.nativeRange.setStart(t,n)}r(this)},t.setEnd=function(t,n){try{this.nativeRange.setEnd(t,n)}catch(e){this.nativeRange.setStart(t,n),this.nativeRange.setEnd(t,n)}r(this)},n=function(n,o){return function(t){try{this.nativeRange[n](t)}catch(e){this.nativeRange[o](t),this.nativeRange[n](t)}r(this)}}}t.setStartBefore=n("setStartBefore","setEndBefore"),t.setStartAfter=n("setStartAfter","setEndAfter"),t.setEndBefore=n("setEndBefore","setStartBefore"),t.setEndAfter=n("setEndAfter","setStartAfter"),t.selectNodeContents=function(e){this.setStartAndEnd(e,0,w.getNodeLength(e))},i.selectNodeContents(e),i.setEnd(e,3);var s=document.createRange();s.selectNodeContents(e),s.setEnd(e,4),s.setStart(e,2),-1==i.compareBoundaryPoints(i.START_TO_END,s)&&1==i.compareBoundaryPoints(i.END_TO_START,s)?t.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:t.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var a=document.createElement("div");a.innerHTML="123";var l=a.firstChild,c=p(document);c.appendChild(a),i.setStart(l,1),i.setEnd(l,2),i.deleteContents(),"13"==l.data&&(t.deleteContents=function(){this.nativeRange.deleteContents(),r(this)},t.extractContents=function(){var e=this.nativeRange.extractContents();return r(this),e}),c.removeChild(a),c=null,h.isHostMethod(i,"createContextualFragment")&&(t.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),p(document).removeChild(e),t.getName=function(){return"WrappedRange"},d.WrappedRange=f,d.createNativeRange=function(e){return(e=g(e,u,"createNativeRange")).createRange()}}(),d.features.implementsTextRange){var i=function(e,t,n,o,r){var i=e.duplicate();i.collapse(n);var s=i.parentElement();if(w.isOrIsAncestorOf(t,s)||(s=t),!s.canHaveHTML){var a=new E(s.parentNode,w.getNodeIndex(s));return{boundaryPosition:a,nodeInfo:{nodeIndex:a.offset,containerElement:a.node}}}var l=w.getDocument(s).createElement("span");l.parentNode&&w.removeNode(l);for(var c,d,u,f,h,m=n?"StartToStart":"StartToEnd",p=r&&r.containerElement==s?r.nodeIndex:0,g=s.childNodes.length,y=g,v=y;v==g?s.appendChild(l):s.insertBefore(l,s.childNodes[v]),i.moveToElementText(l),0!=(c=i.compareEndPoints(m,e))&&p!=y;){if(-1==c){if(y==p+1)break;p=v}else y=y==p+1?p:v;v=Math.floor((p+y)/2),s.removeChild(l)}if(h=l.nextSibling,-1==c&&h&&S(h)){var N;if(i.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(h.data)){var C=i.duplicate(),b=C.text.replace(/\r\n/g,"\r").length;for(N=C.moveStart("character",b);-1==(c=C.compareEndPoints("StartToEnd",C));)N++,C.moveStart("character",1)}else N=i.text.length;f=new E(h,N)}else d=(o||!n)&&l.previousSibling,f=(u=(o||n)&&l.nextSibling)&&S(u)?new E(u,0):d&&S(d)?new E(d,d.data.length):new E(s,w.getNodeIndex(l));return w.removeNode(l),{boundaryPosition:f,nodeInfo:{nodeIndex:v,containerElement:s}}},r=function(e,t){var n,o,r,i,s=e.offset,a=w.getDocument(e.node),l=p(a).createTextRange(),c=S(e.node);return c?o=(n=e.node).parentNode:(n=s<(i=e.node.childNodes).length?i[s]:null,o=e.node),(r=a.createElement("span")).innerHTML="&#feff;",n?o.insertBefore(r,n):o.appendChild(r),l.moveToElementText(r),l.collapse(!t),o.removeChild(r),c&&l[t?"moveStart":"moveEnd"]("character",s),l};((e=function(e){this.textRange=e,this.refresh()}).prototype=new m(document)).refresh=function(){var e,t,n,o,r=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var o=n.parentElement();(n=e.duplicate()).collapse(!1);var r=n.parentElement(),i=o==r?o:w.getCommonAncestor(o,r);return i==t?i:w.getCommonAncestor(t,i)}(this.textRange);0==(o=this.textRange).compareEndPoints("StartToEnd",o)?t=e=i(this.textRange,r,!0,!0).boundaryPosition:(e=(n=i(this.textRange,r,!0,!1)).boundaryPosition,t=i(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},e.prototype.getName=function(){return"WrappedTextRange"},m.copyComparisonConstants(e);var t=function(e){if(e.collapsed)return r(new E(e.startContainer,e.startOffset),!0);var t=r(new E(e.startContainer,e.startOffset),!0),n=r(new E(e.endContainer,e.endOffset),!1),o=p(m.getRangeDocument(e)).createTextRange();return o.setEndPoint("StartToStart",t),o.setEndPoint("EndToEnd",n),o};if(e.rangeToTextRange=t,e.prototype.toTextRange=function(){return t(this)},d.WrappedTextRange=e,!d.features.implementsDomRange||d.config.preferTextRange){var n=Function("return this;")();void 0===n.Range&&(n.Range=e),d.createNativeRange=function(e){return e=g(e,u,"createNativeRange"),p(e).createTextRange()},d.WrappedRange=e}}d.createRange=function(e){return e=g(e,u,"createRange"),new d.WrappedRange(d.createNativeRange(e))},d.createRangyRange=function(e){return e=g(e,u,"createRangyRange"),new m(e)},h.createAliasForDeprecatedMethod(d,"createIframeRange","createRange"),h.createAliasForDeprecatedMethod(d,"createIframeRangyRange","createRangyRange"),d.addShimListener(function(e){var t=e.document;void 0===t.createRange&&(t.createRange=function(){return d.createRange(t)}),t=e=null})}),b.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(u,l){u.config.checkSelectionRanges=!0;var r,i,e="boolean",t="number",f=u.dom,n=u.util,o=n.isHostMethod,a=u.DomRange,s=u.WrappedRange,c=u.DOMException,d=f.DomPosition,h=u.features,m="Control",p=f.getDocument,g=f.getBody,y=a.rangesEqual;function v(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function N(e,t){if(e){if(f.isWindow(e))return e;if(e instanceof z)return e.win;var n=f.getContentDocument(e,l,t);return f.getWindow(n)}return window}function C(e){return N(e,"getDocSelection").document.selection}function b(e){var t=!1;return e.anchorNode&&(t=1==f.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}var w=o(window,"getSelection"),E=n.isHostObject(document,"selection");h.implementsWinGetSelection=w;var S=(h.implementsDocSelection=E)&&(!w||u.config.preferTextRange);if(S)r=C,u.isSelectionValid=function(e){var t=N(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||p(n.createRange().parentElement())==t};else{if(!w)return l.fail("Neither document.selection or window.getSelection() detected."),!1;r=function(e){return N(e,"getWinSelection").getSelection()},u.isSelectionValid=function(){return!0}}var T=(u.getNativeSelection=r)();if(!T)return l.fail("Native selection was null (possibly issue 138?)"),!1;var x=u.createNativeRange(document),R=g(document),O=n.areHostProperties(T,["anchorNode","focusNode","anchorOffset","focusOffset"]);h.selectionHasAnchorAndFocus=O;var A=o(T,"extend");h.selectionHasExtend=A;var L=typeof T.rangeCount==t;h.selectionHasRangeCount=L;var _=!1,B=!0,P=A?function(e,t){var n=a.getRangeDocument(t),o=u.createRange(n);o.collapseToPoint(t.endContainer,t.endOffset),e.addRange(V(o)),e.extend(t.startContainer,t.startOffset)}:null;n.areHostMethods(T,["addRange","getRangeAt","removeAllRanges"])&&typeof T.rangeCount==t&&h.implementsDomRange&&function(){var e=window.getSelection();if(e){for(var t=e.rangeCount,n=1<t,o=[],r=b(e),i=0;i<t;++i)o[i]=e.getRangeAt(i);var s=f.createTestElement(document,"",!1),a=s.appendChild(document.createTextNode("   ")),l=document.createRange();if(l.setStart(a,1),l.collapse(!0),e.removeAllRanges(),e.addRange(l),B=1==e.rangeCount,e.removeAllRanges(),!n){var c=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(c&&36<=parseInt(c[1]))_=!1;else{var d=l.cloneRange();l.setStart(a,0),d.setEnd(a,3),d.setStart(a,2),e.addRange(l),e.addRange(d),_=2==e.rangeCount}}for(f.removeNode(s),e.removeAllRanges(),i=0;i<t;++i)0==i&&r?P?P(e,o[i]):(u.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),e.addRange(o[i])):e.addRange(o[i])}}(),h.selectionSupportsMultipleRanges=_,h.collapsedNonEditableSelectionsSupported=B;var I,D,k=!1;function M(e,t,n){var o=n?"end":"start",r=n?"start":"end";e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function H(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function V(e){var t;return e instanceof a?((t=u.createNativeRange(e.getDocument())).setEnd(e.endContainer,e.endOffset),t.setStart(e.startContainer,e.startOffset)):e instanceof s?t=e.nativeRange:h.implementsDomRange&&e instanceof f.getWindow(e.startContainer).Range&&(t=e),t}function F(e){var t=e.getNodes();if(!function(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;t<n;++t)if(!f.isAncestorOf(e[0],e[t]))return!1;return!0}(t))throw l.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function W(e){return!!e&&void 0!==e.text}function q(e,t){var n=new s(t);e._ranges=[n],M(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function U(e){if(e._ranges.length=0,"None"==e.docSelection.type)H(e);else{var t=e.docSelection.createRange();if(W(t))q(e,t);else{e.rangeCount=t.length;for(var n,o=p(t.item(0)),r=0;r<e.rangeCount;++r)(n=u.createRange(o)).selectNode(t.item(r)),e._ranges.push(n);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,M(e,e._ranges[e.rangeCount-1],!1)}}}function j(e,t){for(var n=e.docSelection.createRange(),o=F(t),r=p(n.item(0)),i=g(r).createControlRange(),s=0,a=n.length;s<a;++s)i.add(n.item(s));try{i.add(o)}catch(e){throw l.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}i.select(),U(e)}function z(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function $(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}R&&o(R,"createControlRange")&&(I=R.createControlRange(),n.areHostProperties(I,["item","add"])&&(k=!0)),h.implementsControlRange=k,i=O?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},o(T,"getRangeAt")?D=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:O&&(D=function(e){var t=p(e.anchorNode),n=u.createRange(t);return n.setStartAndEnd(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),n.collapsed!==this.isCollapsed&&n.setStartAndEnd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset),n}),z.prototype=u.selectionPrototype;var K=[];function G(e,t){for(var n,o,r=K.length;r--;)if(o=(n=K[r]).selection,"deleteAll"==t)$(o);else if(n.win==e)return"delete"==t?(K.splice(r,1),!0):o;return"deleteAll"==t&&(K.length=0),null}var Y=function(e){if(e&&e instanceof z)return e.refresh(),e;var t=G(e=N(e,"getNativeSelection")),n=r(e),o=E?C(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new z(n,o,e),K.push({win:e,selection:t})),t};u.getSelection=Y,n.createAliasForDeprecatedMethod(u,"getIframeSelection","getSelection");var X,Q=z.prototype;function Z(e,t){for(var n,o=p(t[0].startContainer),r=g(o).createControlRange(),i=0,s=t.length;i<s;++i){n=F(t[i]);try{r.add(n)}catch(e){throw l.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),U(e)}if(!S&&O&&n.areHostMethods(T,["removeAllRanges","addRange"])){Q.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),H(this)};var J=function(e,t){P(e.nativeSelection,t),e.refresh()};Q.addRange=L?function(e,t){if(k&&E&&this.docSelection.type==m)j(this,e);else if(v(t)&&A)J(this,e);else{var n;_?n=this.rangeCount:(this.removeAllRanges(),n=0);var o=V(e).cloneRange();try{this.nativeSelection.addRange(o)}catch(e){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==n+1){if(u.config.checkSelectionRanges){var r=D(this.nativeSelection,this.rangeCount-1);r&&!y(r,e)&&(e=new s(r))}M(this,this._ranges[this.rangeCount-1]=e,ee(this.nativeSelection)),this.isCollapsed=i(this)}else this.refresh()}}:function(e,t){v(t)&&A?J(this,e):(this.nativeSelection.addRange(V(e)),this.refresh())},Q.setRanges=function(e){if(k&&E&&1<e.length)Z(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(o(T,"empty")&&o(x,"select")&&k&&S))return l.fail("No means of selecting a Range or TextRange was found"),!1;Q.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=p(this.anchorNode);else if(this.docSelection.type==m){var t=this.docSelection.createRange();t.length&&(e=p(t.item(0)))}if(e)g(e).createTextRange().select(),this.docSelection.empty()}}catch(e){}H(this)},Q.addRange=function(e){this.docSelection.type==m?j(this,e):(u.WrappedTextRange.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,M(this,e,!1))},Q.setRanges=function(e){this.removeAllRanges();var t=e.length;1<t?Z(this,e):t&&this.addRange(e[0])}}if(Q.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new c("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},S)X=function(e){var t;u.isSelectionValid(e.win)?t=e.docSelection.createRange():(t=g(e.win.document).createTextRange()).collapse(!0),e.docSelection.type==m?U(e):W(t)?q(e,t):H(e)};else if(o(T,"getRangeAt")&&typeof T.rangeCount==t)X=function(e){if(k&&E&&e.docSelection.type==m)U(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var t=0,n=e.rangeCount;t<n;++t)e._ranges[t]=new u.WrappedRange(e.nativeSelection.getRangeAt(t));M(e,e._ranges[e.rangeCount-1],ee(e.nativeSelection)),e.isCollapsed=i(e)}else H(e)};else{if(!O||typeof T.isCollapsed!=e||typeof x.collapsed!=e||!h.implementsDomRange)return l.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;X=function(e){var t,n,o,r=e.nativeSelection;r.anchorNode?(t=D(r,0),e._ranges=[t],e.rangeCount=1,o=(n=e).nativeSelection,n.anchorNode=o.anchorNode,n.anchorOffset=o.anchorOffset,n.focusNode=o.focusNode,n.focusOffset=o.focusOffset,e.isCollapsed=i(e)):H(e)}}Q.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,o=this.anchorOffset;if(X(this),e){var r=t.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=o)return!0;for(;r--;)if(!y(t[r],this._ranges[r]))return!0;return!1}};var ee,te=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var o=0,r=n.length;o<r;++o)y(t,n[o])||e.addRange(n[o]);e.rangeCount||H(e)};function ne(e,t){if(e.win.document!=p(t))throw new c("WRONG_DOCUMENT_ERR")}function oe(o){return function(e,t){var n;this.rangeCount?(n=this.getRangeAt(0))["set"+(o?"Start":"End")](e,t):(n=u.createRange(this.win.document)).setStartAndEnd(e,t),this.setSingleRange(n,this.isBackward())}}function re(e){var t=[],n=new d(e.anchorNode,e.anchorOffset),o=new d(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var i=0,s=e.rangeCount;i<s;++i)t[i]=a.inspect(e.getRangeAt(i));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}Q.removeRange=k&&E?function(e){if(this.docSelection.type==m){for(var t=this.docSelection.createRange(),n=F(e),o=p(t.item(0)),r=g(o).createControlRange(),i=!1,s=0,a=t.length;s<a;++s)t.item(s)!==n||i?r.add(t.item(s)):i=!0;r.select(),U(this)}else te(this,e)}:function(e){te(this,e)},!S&&O&&h.implementsDomRange?(ee=b,Q.isBackward=function(){return ee(this)}):ee=Q.isBackward=function(){return!1},Q.isBackwards=Q.isBackward,Q.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},Q.collapse=function(e,t){ne(this,e);var n=u.createRange(e);n.collapseToPoint(e,t),this.setSingleRange(n),this.isCollapsed=!0},Q.collapseToStart=function(){if(!this.rangeCount)throw new c("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},Q.collapseToEnd=function(){if(!this.rangeCount)throw new c("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},Q.selectAllChildren=function(e){ne(this,e);var t=u.createRange(e);t.selectNodeContents(e),this.setSingleRange(t)},Q.deleteFromDocument=function(){if(k&&E&&this.docSelection.type==m){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),f.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var o=0,r=n.length;o<r;++o)n[o].deleteContents();this.addRange(n[r-1])}}},Q.eachRange=function(e,t){for(var n=0,o=this._ranges.length;n<o;++n)if(e(this.getRangeAt(n)))return t},Q.getAllRanges=function(){var t=[];return this.eachRange(function(e){t.push(e)}),t},Q.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},Q.callMethodOnEachRange=function(t,n){var o=[];return this.eachRange(function(e){o.push(e[t].apply(e,n||[]))}),o},Q.setStart=oe(!0),Q.setEnd=oe(!1),u.rangePrototype.select=function(e){Y(this.getDocument()).setSingleRange(this,e)},Q.changeEachRange=function(t){var n=[],e=this.isBackward();this.eachRange(function(e){t(e),n.push(e)}),this.removeAllRanges(),e&&1==n.length?this.addRange(n[0],"backward"):this.setRanges(n)},Q.containsNode=function(t,n){return this.eachRange(function(e){return e.containsNode(t,n)},!0)||!1},Q.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},Q.moveToBookmark=function(e){for(var t,n,o=[],r=0;t=e.rangeBookmarks[r++];)(n=u.createRange(this.win)).moveToBookmark(t),o.push(n);e.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},Q.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},Q.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},Q.toHtml=function(){var t=[];return this.eachRange(function(e){t.push(a.toHtml(e))}),t.join("")},h.implementsTextRange&&(Q.getNativeTextRange=function(){var e;if(e=this.docSelection){var t=e.createRange();if(W(t))return t;throw l.createError("getNativeTextRange: selection is a control selection")}if(0<this.rangeCount)return u.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw l.createError("getNativeTextRange: selection contains no range")}),Q.getName=function(){return"WrappedSelection"},Q.inspect=function(){return re(this)},Q.detach=function(){G(this.win,"delete"),$(this)},z.detachAll=function(){G(null,"deleteAll")},z.inspect=re,z.isDirectionBackward=v,u.Selection=z,u.selectionPrototype=Q,u.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return Y(e)}),e=null})});var I=!1,D=function(e){I||(I=!0,!b.initialized&&b.config.autoInitialize&&R())};N&&("complete"==document.readyState?D():(d(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",D,!1),y(window,"load",D))),rangy=b}(),rangy.createModule("SaveRestore",["WrappedRange"],function(l,s){var a=l.dom,c=a.removeNode,d=l.Selection.isDirectionBackward,u="\ufeff";function f(e,t){return(t||document).getElementById(e)}function h(e,t){var n,o="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),r=a.getDocument(e.startContainer),i=e.cloneRange();return i.collapse(t),(n=r.createElement("span")).id=o,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(r.createTextNode(u)),i.insertNode(n),n}function m(e,t,n,o){var r=f(n,e);r?(t[o?"setStartBefore":"setEndBefore"](r),c(r)):s.warn("Marker element has been removed. Cannot restore selection.")}function p(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function g(e,t){var n,o=l.DomRange.getRangeDocument(e),r=e.toString(),i=d(t);return e.collapsed?{document:o,markerId:(n=h(e,!1)).id,collapsed:!0}:(n=h(e,!1),{document:o,startMarkerId:h(e,!0).id,endMarkerId:n.id,collapsed:!1,backward:i,toString:function(){return"original text: '"+r+"', new text: '"+e.toString()+"'"}})}function o(e,t){var n=e.document;void 0===t&&(t=!0);var o=l.createRange(n);if(e.collapsed){var r=f(e.markerId,n);if(r){r.style.display="inline";var i=r.previousSibling;i&&3==i.nodeType?(c(r),o.collapseToPoint(i,i.length)):(o.collapseBefore(r),c(r))}else s.warn("Marker element has been removed. Cannot restore selection.")}else m(n,o,e.startMarkerId,!0),m(n,o,e.endMarkerId,!1);return t&&o.normalizeBoundaries(),o}function i(e,t){var n,o,r=[],i=d(t);(e=e.slice(0)).sort(p);for(var s=0,a=e.length;s<a;++s)r[s]=g(e[s],i);for(s=a-1;0<=s;--s)n=e[s],o=l.DomRange.getRangeDocument(n),n.collapsed?n.collapseAfter(f(r[s].markerId,o)):(n.setEndBefore(f(r[s].endMarkerId,o)),n.setStartAfter(f(r[s].startMarkerId,o)));return r}function y(e){for(var t=[],n=e.length-1;0<=n;n--)t[n]=o(e[n],!0);return t}function v(e,t){var n=f(t,e);n&&c(n)}l.util.extend(l,{saveRange:g,restoreRange:o,saveRanges:i,restoreRanges:y,saveSelection:function(e){if(!l.isSelectionValid(e))return s.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var t=l.getSelection(e),n=t.getAllRanges(),o=1==n.length&&t.isBackward(),r=i(n,o);return o?t.setSingleRange(n[0],o):t.setRanges(n),{win:e,rangeInfos:r,restored:!1}},restoreSelection:function(e,t){if(!e.restored){var n=e.rangeInfos,o=l.getSelection(e.win),r=y(n);1==n.length&&t&&l.features.selectionHasExtend&&n[0].backward?(o.removeAllRanges(),o.addRange(r[0],!0)):o.setRanges(r),e.restored=!0}},removeMarkerElement:v,removeMarkers:function(e){for(var t,n=e.rangeInfos,o=0,r=n.length;o<r;++o)(t=n[o]).collapsed?v(e.doc,t.markerId):(v(e.doc,t.startMarkerId),v(e.doc,t.endMarkerId))}})}),rangy.createModule("TextRange",["WrappedSelection"],function(y,t){var e,n,o,c="undefined",p="character",g="word",l=y.dom,r=y.util,s=r.extend,a=r.createOptions,d=l.getBody,i=/^[ \t\f\r\n]+$/,u=/^[ \t\f\r]+$/,f=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,h=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,m="en",v=y.Selection.isDirectionBackward,N=!1,C=!1;function b(e,t){for(var n=e.slice(t.start,t.end),o={isWord:t.isWord,chars:n,toString:function(){return n.join("")}},r=0,i=n.length;r<i;++r)n[r].token=o;return o}function w(e,t,n){for(var o,r=n(e,t),i=[],s=0;o=r[s++];)i.push(b(e,o));return i}e=l.createTestElement(document,"<p>1 </p><p></p>",!0),n=e.firstChild,(o=y.getSelection()).collapse(n.lastChild,2),o.setStart(n.firstChild,0),e.innerHTML="1 <br />",o.collapse(e,2),o.setStart(e.firstChild,0),N=1==(""+o).length,e.innerHTML="1 <p>1</p>",o.collapse(e,2),o.setStart(e.firstChild,0),C=1==(""+o).length,l.removeNode(e),o.removeAllRanges();var E={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""};var S={includeBlockContentTrailingSpace:!1,includeSpaceBeforeBr:!N,includeSpaceBeforeBlock:!C,includePreLineTrailingSpace:!0},T={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:function(e,t){var n,o=e.join(""),r=[];function i(e,t,n){r.push({start:e,end:t,isWord:n})}for(var s,a,l=0;n=t.wordRegex.exec(o);){if(a=(s=n.index)+n[0].length,l<s&&i(l,s,!1),t.includeTrailingSpace)for(;h.test(e[a]);)++a;i(s,a,!0),l=a}return l<e.length&&i(l,e.length,!1),r}}},x={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},R={wordOptions:null,characterOptions:null},O={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},A={wordOptions:null,characterOptions:null,direction:"forward"};function L(e,t){var n,o,r,i=a(e,t);return t.hasOwnProperty("wordOptions")&&(i.wordOptions=(n=i.wordOptions)?(o=n.language||m,s(r={},T[o]||T[m]),s(r,n),r):T[m]),t.hasOwnProperty("characterOptions")&&(i.characterOptions=a(i.characterOptions,E)),i}var _,B,P,I=l.getComputedStyleProperty;B=document.createElement("table"),(P=d(document)).appendChild(B),_="block"==I(B,"display"),P.removeChild(B);var D={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};function k(e,t){var n=I(e,"display",t),o=e.tagName.toLowerCase();return"block"==n&&_&&D.hasOwnProperty(o)?D[o]:n}function M(e){for(var t,n=function(e){for(var t=[];e.parentNode;)t.unshift(e.parentNode),e=e.parentNode;return t}(t=e).concat([t]),o=0,r=n.length;o<r;++o)if(1==n[o].nodeType&&"none"==k(n[o]))return!0;return!1}function H(e,t){return!t&&e.hasChildNodes()?e.firstChild:function(e){for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null}(e)}function V(e){var t=e.previousSibling;if(t){for(e=t;e.hasChildNodes();)e=e.lastChild;return e}var n=e.parentNode;return n&&1==n.nodeType?n:null}function F(e){if(!e||3!=e.nodeType)return!1;var t=e.data;if(""===t)return!0;var n=e.parentNode;if(!n||1!=n.nodeType)return!1;var o=I(e.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(o)||/^[\t\r ]+$/.test(t)&&"pre-line"==o}function W(e){return""===e.data||!!F(e)&&(!e.parentNode||!!M(e))}function q(e){var t,n,o=e.nodeType;return 7==o||8==o||M(e)||/^(script|style)$/i.test(e.nodeName)||3==(t=e).nodeType&&(n=t.parentNode)&&"hidden"==I(n,"visibility")||W(e)}function U(e,t){var n=e.nodeType;return 7==n||8==n||1==n&&"none"==k(e,t)}function j(){this.store={}}j.prototype={get:function(e){return this.store.hasOwnProperty(e)?this.store[e]:null},set:function(e,t){return this.store[e]=t}};function z(o,r,i){return function(e){var t=this.cache;if(t.hasOwnProperty(o))return 0,t[o];0;var n=r.call(this,i?this[i]:this,e);return t[o]=n}}function $(e,t){this.node=e,this.session=t,this.cache=new j,this.positions=new j}var K={getPosition:function(e){var t=this.positions;return t.get(e)||t.set(e,new ne(this,e))},toString:function(){return"[NodeWrapper("+l.inspectNode(this.node)+")]"}},G="NON_SPACE",Y="UNCOLLAPSIBLE_SPACE",X="COLLAPSIBLE_SPACE",Q="TRAILING_SPACE_BEFORE_BLOCK",Z="TRAILING_SPACE_IN_BLOCK",J="TRAILING_SPACE_BEFORE_BR",ee="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",te="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";function ne(e,t){this.offset=t,this.nodeWrapper=e,this.node=e.node,this.session=e.session,this.cache=new j}s($.prototype=K,{isCharacterDataNode:z("isCharacterDataNode",l.isCharacterDataNode,"node"),getNodeIndex:z("nodeIndex",l.getNodeIndex,"node"),getLength:z("nodeLength",l.getNodeLength,"node"),containsPositions:z("containsPositions",function(e){return l.isCharacterDataNode(e)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(e.nodeName)},"node"),isWhitespace:z("isWhitespace",F,"node"),isCollapsedWhitespace:z("isCollapsedWhitespace",W,"node"),getComputedDisplay:z("computedDisplay",k,"node"),isCollapsed:z("collapsed",q,"node"),isIgnored:z("ignored",U,"node"),next:z("nextPos",H,"node"),previous:z("previous",V,"node"),getTextNodeInfo:z("textNodeInfo",function(e){var t=null,n=!1,o=I(e.parentNode,"whiteSpace"),r="pre-line"==o;return r?(t=u,n=!0):"normal"!=o&&"nowrap"!=o||(t=i,n=!0),{node:e,text:e.data,spaceRegex:t,collapseSpaces:n,preLine:r}},"node"),hasInnerText:z("hasInnerText",function(e,t){for(var n=this.session,o=n.getPosition(e.parentNode,this.getNodeIndex()+1),r=n.getPosition(e,0),i=t?o:r,s=t?r:o;i!==s;){if(i.prepopulateChar(),i.isDefinitelyNonEmpty())return!0;i=t?i.previousVisible():i.nextVisible()}return!1},"node"),isRenderedBlock:z("isRenderedBlock",function(e){for(var t=e.getElementsByTagName("br"),n=0,o=t.length;n<o;++n)if(!q(t[n]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:z("trailingSpace",function(e){if("br"==e.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var t=e.lastChild;t;){if(!U(t))return 1==t.nodeType?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"\t";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:z("leadingSpace",function(e){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var oe={character:"",characterType:"EMPTY",isBr:!1,prepopulateChar:function(){var e=this;if(!e.prepopulatedChar){var t=e.node,n=e.offset,o="",r="EMPTY",i=!1;if(0<n)if(3==t.nodeType){var s=t.data,a=s.charAt(n-1),l=e.nodeWrapper.getTextNodeInfo(),c=l.spaceRegex;l.collapseSpaces?c.test(a)?1<n&&c.test(s.charAt(n-2))||(l.preLine&&"\n"===s.charAt(n)?(o=" ",r=ee):(o=" ",r=X)):(o=a,r=G,i=!0):(o=a,r=Y,i=!0)}else{var d=t.childNodes[n-1];if(d&&1==d.nodeType&&!q(d)&&("br"==d.tagName.toLowerCase()?(o="\n",e.isBr=!0,i=!(r=X)):e.checkForTrailingSpace=!0),!o){var u=t.childNodes[n];u&&1==u.nodeType&&!q(u)&&(e.checkForLeadingSpace=!0)}}e.prepopulatedChar=!0,e.character=o,e.characterType=r,e.isCharInvariant=i}},isDefinitelyNonEmpty:function(){var e=this.characterType;return e==G||e==Y},resolveLeadingAndTrailingSpaces:function(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();e&&(this.isTrailingSpace=!0,this.character=e,this.characterType=X),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();t&&(this.isLeadingSpace=!0,this.character=t,this.characterType=X),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(e){for(var t=this;t=t.previousVisible();)if(""!==t.getCharacter(e))return t;return null},getCharacter:function(e){this.resolveLeadingAndTrailingSpaces();var t,n,o,r=this.character,i=(t=e.ignoreCharacters,(o="string"==typeof(n=t||"")?n.split(""):n).sort(function(e,t){return e.charCodeAt(0)-t.charCodeAt(0)}),o.join("").replace(/(.)\1+/g,"$1")),s=""!==r&&-1<i.indexOf(r);if(this.isCharInvariant)return s?"":r;var a=["character",e.includeSpaceBeforeBr,e.includeBlockContentTrailingSpace,e.includePreLineTrailingSpace,i].join("_"),l=this.cache.get(a);if(null!==l)return l;var c,d,u="",f=this.characterType==X,h=!1,m=this;function p(){return h||(d=m.getPrecedingUncollapsedPosition(e),h=!0),d}return f&&(this.type==te?u="\n":" "==r&&(!p()||d.isTrailingSpace||"\n"==d.character||" "==d.character&&d.characterType==X)||("\n"==r&&this.isLeadingSpace?p()&&"\n"!=d.character&&(u="\n"):(c=this.nextUncollapsed())&&(c.isBr?this.type=J:c.isTrailingSpace&&"\n"==c.character?this.type=Z:c.isLeadingSpace&&"\n"==c.character&&(this.type=Q),"\n"==c.character?(this.type!=J||e.includeSpaceBeforeBr)&&(this.type!=Q||e.includeSpaceBeforeBlock)&&(this.type==Z&&c.isTrailingSpace&&!e.includeBlockContentTrailingSpace||(this.type!=ee||c.type!=G||e.includePreLineTrailingSpace)&&("\n"==r?c.isTrailingSpace?this.isTrailingSpace||this.isBr&&(c.type="TRAILING_LINE_BREAK_AFTER_BR",p()&&d.isLeadingSpace&&!d.isTrailingSpace&&"\n"==d.character?c.character="":c.type=te):u="\n":" "==r&&(u=" "))):u=r))),-1<i.indexOf(u)&&(u=""),this.cache.set(a,u),u},equals:function(e){return!!e&&this.node===e.node&&this.offset===e.offset},inspect:function(){return"[Position("+l.inspectNode(this.node)+":"+this.offset+")]"},toString:function(){return this.character}};s(ne.prototype=oe,{next:z("nextPos",function(e){var t,n,o,r=e.nodeWrapper,i=e.node,s=e.offset,a=r.session;return i?(s==r.getLength()?n=(t=i.parentNode)?r.getNodeIndex()+1:0:r.isCharacterDataNode()?(t=i,n=s+1):(o=i.childNodes[s],a.getNodeWrapper(o).containsPositions()?(t=o,n=0):(t=i,n=s+1)),t?a.getPosition(t,n):null):null}),previous:z("previous",function(e){var t,n,o,r=e.nodeWrapper,i=e.node,s=e.offset,a=r.session;return 0==s?n=(t=i.parentNode)?r.getNodeIndex():0:r.isCharacterDataNode()?(t=i,n=s-1):(o=i.childNodes[s-1],a.getNodeWrapper(o).containsPositions()?(t=o,n=l.getNodeLength(o)):(t=i,n=s-1)),t?a.getPosition(t,n):null}),nextVisible:z("nextVisible",function(e){var t=e.next();if(!t)return null;var n=t.nodeWrapper,o=t.node,r=t;return n.isCollapsed()&&(r=n.session.getPosition(o.parentNode,n.getNodeIndex()+1)),r}),nextUncollapsed:z("nextUncollapsed",function(e){for(var t=e;t=t.nextVisible();)if(t.resolveLeadingAndTrailingSpaces(),""!==t.character)return t;return null}),previousVisible:z("previousVisible",function(e){var t=e.previous();if(!t)return null;var n=t.nodeWrapper,o=t.node,r=t;return n.isCollapsed()&&(r=n.session.getPosition(o.parentNode,n.getNodeIndex())),r})});var re=null,ie=function(){function e(r){var i=new j;return{get:function(e){var t=i.get(e[r]);if(t)for(var n,o=0;n=t[o++];)if(n.node===e)return n;return null},set:function(e){var t=e.node[r];(i.get(t)||i.set(t,[])).push(e)}}}var n=r.isHostProperty(document.documentElement,"uniqueID");function t(){this.initCaches()}return t.prototype={initCaches:function(){var t;this.elementCache=n?(t=new j,{get:function(e){return t.get(e.uniqueID)},set:function(e){t.set(e.node.uniqueID,e)}}):e("tagName"),this.textNodeCache=e("data"),this.otherNodeCache=e("nodeName")},getNodeWrapper:function(e){var t;switch(e.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}var n=t.get(e);return n||(n=new $(e,this),t.set(n)),n},getPosition:function(e,t){return this.getNodeWrapper(e).getPosition(t)},getRangeBoundaryPosition:function(e,t){var n=t?"start":"end";return this.getPosition(e[n+"Container"],e[n+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},t}();function se(){return re||(ae(),re=new ie)}function ae(){re&&re.detach(),re=null}function le(e,n,o,r){o&&(n?q(o.node)&&(o=e.previousVisible()):q(o.node)&&(o=o.nextVisible()));var i=e,s=!1;var a,l=!1;return{next:function(){if(l)return l=!1,a;for(var e;t=void 0,t=null,n?(t=i,s||(i=i.previousVisible(),s=!i||o&&i.equals(o))):s||(t=i=i.nextVisible(),s=!i||o&&i.equals(o)),s&&(i=null),e=t;)if(e.getCharacter(r))return a=e;return null;var t},rewind:function(){if(!a)throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");l=!0},dispose:function(){e=o=null}}}s(l,{nextNode:H,previousNode:V});var ce=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0,o=e.length;n<o;++n)if(e[n]===t)return n;return-1};function de(e,t,n){var a=le(e,!1,null,t),l=le(e,!0,null,t),o=n.tokenizer;function r(e){for(var t,n,o=[],r=e?a:l,i=!1,s=!1;t=r.next();){if(n=t.character,f.test(n))s&&(i=!(s=!1));else{if(i){r.rewind();break}s=!0}o.push(t)}return o}var i=r(!0),s=r(!1).reverse(),c=w(s.concat(i),n,o),d=i.length?c.slice(ce(c,i[0].token)):[],u=s.length?c.slice(0,ce(c,s.pop().token)+1):[];return{nextEndToken:function(){for(var e,t;1==d.length&&!(e=d[0]).isWord&&0<(t=r(!0)).length;)d=w(e.chars.concat(t),n,o);return d.shift()},previousStartToken:function(){for(var e,t;1==u.length&&!(e=u[0]).isWord&&0<(t=r(!1)).length;)u=w(t.reverse().concat(e.chars),n,o);return u.pop()},dispose:function(){a.dispose(),l.dispose(),d=u=null}}}function ue(e,t,n,o){var r=e.getRangeBoundaryPosition(t,!0),i=e.getRangeBoundaryPosition(t,!1);return le(o?i:r,!!o,o?r:i,n)}function fe(e,t,n,o,l){var r,i,s,a,c,d,u=v(l.direction),f=le(e,u,e.session.getRangeBoundaryPosition(o,u),l.characterOptions),h="",m=[],p=null;function g(e,t){var n,o,r,i,s=m[e].previousVisible(),a=m[t-1];return{startPos:s,endPos:a,valid:!l.wholeWordsOnly||(n=s,o=a,r=l.wordOptions,(i=y.createRange(n.node)).setStartAndEnd(n.node,n.offset,o.node,o.offset),!i.expand("word",{wordOptions:r}))}}for(;r=f.next();)if(i=r.character,n||l.caseSensitive||(i=i.toLowerCase()),u?(m.unshift(r),h=i+h):(m.push(r),h+=i),n){if(c=t.exec(h))if(a=(s=c.index)+c[0].length,d){if(!u&&a<h.length||u&&0<s){p=g(s,a);break}}else d=!0}else if(-1!=(s=h.indexOf(t))){p=g(s,s+t.length);break}return d&&(p=g(s,a)),f.dispose(),p}function he(o){return function(){var e=!!re,t=[se()].concat(r.toArray(arguments)),n=o.apply(this,t);return e||ae(),n}}function me(a,l){return he(function(e,t,n,o){typeof n==c&&(n=t,t=p),o=L(o,R);var r=a;l&&(r=0<=n,this.collapse(!r));var i=function(e,t,n,o,r){var i,s,a,l,c=0,d=e,u=Math.abs(n);if(0!==n){var f=n<0;switch(t){case p:for(s=le(e,f,null,o);(i=s.next())&&c<u;)++c,d=i;a=i,s.dispose();break;case g:for(var h=de(e,o,r),m=f?h.previousStartToken:h.nextEndToken;(l=m())&&c<u;)l.isWord&&(++c,d=f?l.chars[0]:l.chars[l.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented")}f?(d=d.previousVisible(),c=-c):d&&d.isLeadingSpace&&!d.isTrailingSpace&&(t==g&&(a=(s=le(e,!1,null,o)).next(),s.dispose()),a&&(d=a.previousVisible()))}return{position:d,unitsMoved:c}}(e.getRangeBoundaryPosition(this,r),t,n,o.characterOptions,o.wordOptions),s=i.position;return this[r?"setStart":"setEnd"](s.node,s.offset),i.unitsMoved})}function pe(s){return he(function(e,t){for(var n,o=ue(e,this,t=a(t,E),!s),r=0;(n=o.next())&&f.test(n.character);)++r;o.dispose();var i=0<r;return i&&this[s?"moveStart":"moveEnd"]("character",s?r:-r,{characterOptions:t}),i})}function ge(o){return he(function(e,t){var n=!1;return this.changeEachRange(function(e){n=e[o](t)||n}),n})}s(y.rangePrototype,{moveStart:me(!0,!1),moveEnd:me(!1,!1),move:me(!0,!0),trimStart:pe(!0),trimEnd:pe(!1),trim:he(function(e,t){var n=this.trimStart(t),o=this.trimEnd(t);return n||o}),expand:he(function(e,t,n){var o=!1,r=(n=L(n,O)).characterOptions;if(t||(t=p),t==g){var i,s,a=n.wordOptions,l=e.getRangeBoundaryPosition(this,!0),c=e.getRangeBoundaryPosition(this,!1),d=de(l,r,a).nextEndToken(),u=d.chars[0].previousVisible();if(this.collapsed)i=d;else i=de(c,r,a).previousStartToken();return s=i.chars[i.chars.length-1],u.equals(l)||(this.setStart(u.node,u.offset),o=!0),s&&!s.equals(c)&&(this.setEnd(s.node,s.offset),o=!0),n.trim&&(n.trimStart&&(o=this.trimStart(r)||o),n.trimEnd&&(o=this.trimEnd(r)||o)),o}return this.moveEnd(p,1,n)}),text:he(function(e,t){return this.collapsed?"":function(e,t,n){for(var o,r=[],i=ue(e,t,n);o=i.next();)r.push(o);return i.dispose(),r}(e,this,a(t,E)).join("")}),selectCharacters:he(function(e,t,n,o,r){var i={characterOptions:r};t||(t=d(this.getDocument())),this.selectNodeContents(t),this.collapse(!0),this.moveStart("character",n,i),this.collapse(!0),this.moveEnd("character",o-n,i)}),toCharacterRange:he(function(e,t,n){t||(t=d(this.getDocument()));var o,r=t.parentNode,i=l.getNodeIndex(t),s=-1==l.comparePoints(this.startContainer,this.endContainer,r,i),a=this.cloneRange();return s?(a.setStartAndEnd(this.startContainer,this.startOffset,r,i),o=-a.text(n).length):(a.setStartAndEnd(r,i,this.startContainer,this.startOffset),o=a.text(n).length),{start:o,end:o+this.text(n).length}}),findText:he(function(e,t,n){(n=L(n,x)).wholeWordsOnly&&(n.wordOptions.includeTrailingSpace=!1);var o=v(n.direction),r=n.withinRange;r||(r=y.createRange()).selectNodeContents(this.getDocument());var i=t,s=!1;"string"==typeof i?n.caseSensitive||(i=i.toLowerCase()):s=!0;var a=e.getRangeBoundaryPosition(this,!o),l=r.comparePoint(a.node,a.offset);-1===l?a=e.getRangeBoundaryPosition(r,!0):1===l&&(a=e.getRangeBoundaryPosition(r,!1));for(var c,d=a,u=!1;;)if(c=fe(d,i,s,r,n)){if(c.valid)return this.setStartAndEnd(c.startPos.node,c.startPos.offset,c.endPos.node,c.endPos.offset),!0;d=o?c.startPos:c.endPos}else{if(!n.wrap||u)return!1;r=r.cloneRange(),d=e.getRangeBoundaryPosition(r,!o),r.setBoundary(a.node,a.offset,o),u=!0}}),pasteHtml:function(e){if(this.deleteContents(),e){var t=this.createContextualFragment(e),n=t.lastChild;this.insertNode(t),this.collapseAfter(n)}}}),s(y.selectionPrototype,{expand:he(function(e,t,n){this.changeEachRange(function(e){e.expand(t,n)})}),move:he(function(e,t,n,o){var r=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var i=this.getRangeAt(0);o||(o={}),o.characterOptions=a(o.characterOptions,S),r=i.move(t,n,o),this.setSingleRange(i)}return r}),trimStart:ge("trimStart"),trimEnd:ge("trimEnd"),trim:ge("trim"),selectCharacters:he(function(e,t,n,o,r,i){var s=y.createRange(t);s.selectCharacters(t,n,o,i),this.setSingleRange(s,r)}),saveCharacterRanges:he(function(e,t,n){for(var o=this.getAllRanges(),r=[],i=1==o.length&&this.isBackward(),s=0,a=o.length;s<a;++s)r[s]={characterRange:o[s].toCharacterRange(t,n),backward:i,characterOptions:n};return r}),restoreCharacterRanges:he(function(e,t,n){this.removeAllRanges();for(var o,r,i,s=0,a=n.length;s<a;++s)i=(r=n[s]).characterRange,(o=y.createRange(t)).selectCharacters(t,i.start,i.end,r.characterOptions),this.addRange(o,r.backward)}),text:he(function(e,t){for(var n=[],o=0,r=this.rangeCount;o<r;++o)n[o]=this.getRangeAt(o).text(t);return n.join("")})}),y.innerText=function(e,t){var n=y.createRange(e);return n.selectNodeContents(e),n.text(t)},y.createWordIterator=function(e,t,n){var o=se();n=L(n,A);var r=de(o.getPosition(e,t),n.characterOptions,n.wordOptions),i=v(n.direction);return{next:function(){return i?r.previousStartToken():r.nextEndToken()},dispose:function(){r.dispose(),this.next=function(){}}}},y.noMutation=function(e){e(se()),ae()},y.noMutation.createEntryPointFunction=he,y.textRange={isBlockNode:function(e){return e&&(1==e.nodeType&&!/^(inline(-block|-table)?|none)$/.test(k(e))||9==e.nodeType||11==e.nodeType)},isCollapsedWhitespaceNode:W,createPosition:he(function(e,t,n){return e.getPosition(t,n)})}}),wysihtml.browser=function(){var n,o,t=navigator.userAgent,s=document.createElement("div"),e=-1!==t.indexOf("Gecko")&&-1===t.indexOf("KHTML")&&!l(),r=-1!==t.indexOf("AppleWebKit/")&&!l(),i=-1!==t.indexOf("Chrome/")&&!l(),a=-1!==t.indexOf("Opera/")&&!l();function l(e,t){var n,o=-1;return"Microsoft Internet Explorer"==navigator.appName?n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(-1<navigator.userAgent.indexOf("Trident")?n=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"):/Edge\/(\d+)./i.test(navigator.userAgent)&&(n=/Edge\/(\d+)./i)),n&&null!=n.exec(navigator.userAgent)&&(o=parseFloat(RegExp.$1)),-1!==o&&(!e||(t?"<"===t?e<o:">"===t?o<e:"<="===t?e<=o:">="===t?o<=e:void 0:e===o))}return{USER_AGENT:t,supported:function(){var e,t=this.USER_AGENT.toLowerCase(),n="contentEditable"in s,o=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,r=document.querySelector&&document.querySelectorAll,i=this.isIos()&&+(/ipad|iphone|ipod/.test(e=t)&&e.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]<5||this.isAndroid()&&+(t.match(/android (\d+)/)||[void 0,0])[1]<4||-1!==t.indexOf("opera mobi")||-1!==t.indexOf("hpwos/");return n&&o&&r&&!i},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return l()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return l(12,">")},hasCurrentStyleProperty:function(){return"currentStyle"in s},insertsLineBreaksOnReturn:function(){return e},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in s||(s.setAttribute("on"+e,"return;"),"function"==typeof s["on"+e])},supportsEventsInIframeCorrectly:function(){return!a},supportsHTML5Tags:function(e){var t=e.createElement("div"),n="<article>foo</article>";return t.innerHTML=n,t.innerHTML.toLowerCase()===n},supportsCommand:(n={formatBlock:l(10,"<="),insertUnorderedList:l(),insertOrderedList:l()},o={insertHTML:e},function(e,t){if(!n[t]){try{return e.queryCommandSupported(t)}catch(e){}try{return e.queryCommandEnabled(t)}catch(e){return!!o[t]}}return!1}),doesAutoLinkingInContentEditable:function(){return l()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return e||a||r},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return e||l()||a},autoScrollsToCaret:function(){return!r},autoClosesUnclosedTags:function(){var e,t,n=s.cloneNode(!1);return n.innerHTML="<p><div></div>",t=n.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return a},supportsSpeechApiOn:function(e){return 11<=(t.match(/Chrome\/(\d+)/)||[void 0,0])[1]&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(e){return l(9)&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return l(12,">")},hasProblemsSettingCaretAfterImg:function(){return l()},hasLiDeletingProblem:function(){return l()},hasUndoInContextMenu:function(){return e||i||a},hasInsertNodeIssue:function(){return a},hasIframeFocusIssue:function(){return l()},createsNestedInvalidMarkupAfterPaste:function(){return r},hasCaretBlockElementIssue:function(){return r},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModernPaste:function(){return!l()},fixStyleKey:function(e){return"cssFloat"===e?"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat":e},usesControlRanges:function(){return document.body&&"createControlRange"in document.body},hasCaretAtLinkEndInsertionProblems:function(){return r}}}(),wysihtml.lang.array=function(i){return{contains:function(e){if(Array.isArray(e)){for(var t=e.length;t--;)if(-1!==wysihtml.lang.array(i).indexOf(e[t]))return!0;return!1}return-1!==wysihtml.lang.array(i).indexOf(e)},indexOf:function(e){if(i.indexOf)return i.indexOf(e);for(var t=0,n=i.length;t<n;t++)if(i[t]===e)return t;return-1},without:function(e){e=wysihtml.lang.array(e);for(var t=[],n=0,o=i.length;n<o;n++)e.contains(i[n])||t.push(i[n]);return t},get:function(){for(var e=0,t=i.length,n=[];e<t;e++)n.push(i[e]);return n},map:function(e,t){if(Array.prototype.map)return i.map(e,t);for(var n=i.length>>>0,o=new Array(n),r=0;r<n;r++)o[r]=e.call(t,i[r],r,i);return o},unique:function(){for(var e=[],t=i.length,n=0;n<t;)wysihtml.lang.array(e).contains(i[n])||e.push(i[n]),n++;return e}}},wysihtml.lang.Dispatcher=Base.extend({on:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function(e,t){this.events=this.events||{};var n,o,r=0;if(e){for(n=this.events[e]||[],o=[];r<n.length;r++)n[r]!==t&&t&&o.push(n[r]);this.events[e]=o}else this.events={};return this},fire:function(e,t){this.events=this.events||{};for(var n=this.events[e]||[],o=0;o<n.length;o++)n[o].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml.lang.object=function(r){return{merge:function(e,t){for(var n in e)t&&wysihtml.lang.object(e[n]).isPlainObject()&&(void 0===r[n]||wysihtml.lang.object(r[n]).isPlainObject())?void 0===r[n]?r[n]=wysihtml.lang.object(e[n]).clone(!0):wysihtml.lang.object(r[n]).merge(wysihtml.lang.object(e[n]).clone(!0)):r[n]=wysihtml.lang.object(e[n]).isPlainObject()?wysihtml.lang.object(e[n]).clone(!0):e[n];return this},difference:function(e){var t={};for(var n in r)r.hasOwnProperty(n)&&(e.hasOwnProperty(n)||(t[n]=r[n]));for(var o in e)e.hasOwnProperty(o)&&(r.hasOwnProperty(o)&&r[o]===e[o]||(t[0]=r[0]));return t},get:function(){return r},clone:function(e){var t,n={};if(null===r||!wysihtml.lang.object(r).isPlainObject())return r;for(t in r)r.hasOwnProperty(t)&&(n[t]=e?wysihtml.lang.object(r[t]).clone(e):r[t]);return n},isArray:function(){return"[object Array]"===Object.prototype.toString.call(r)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(r)},isPlainObject:function(){return r&&"[object Object]"===Object.prototype.toString.call(r)&&!("Node"in window?r instanceof Node:r instanceof Element||r instanceof Text)},isEmpty:function(){for(var e in r)if(r.hasOwnProperty(e))return!1;return!0}}},function(){var e=/^\s+/,t=/\s+$/,r=/[&<>\t"]/g,i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\t":"&nbsp; "};wysihtml.lang.string=function(o){return o=String(o),{trim:function(){return o.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)o=this.replace("#{"+t+"}").by(e[t]);return o},replace:function(t){return{by:function(e){return o.split(t).join(e)}}},escapeHTML:function(e,t){var n=o.replace(r,function(e){return i[e]});return e&&(n=n.replace(/(?:\r\n|\r|\n)/g,"<br />")),t&&(n=n.replace(/  /gi,"&nbsp; ")),n}}}}(),function(s){var a=s.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),l=/((https?:\/\/|www\.)[^\s<]{3,})/gi,c=/([^\w\/\-](,?))$/i,d=100,u={")":"(","]":"[","}":"{"};s.dom.autoLink=function(e,t){return function(e,t){for(var n;e.parentNode;){if(e=e.parentNode,n=e.nodeName,e.className&&s.lang.array(e.className.split(" ")).contains(t))return!0;if(a.contains(n))return!0;if("body"===n)return!1}return!1}(e,t)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),function e(t,n){if(!(a.contains(t.nodeName)||t.className&&s.lang.array(t.className.split(" ")).contains(n))){if(t.nodeType!==s.TEXT_NODE||!t.data.match(l)){for(var o=s.lang.array(t.childNodes).get(),r=o.length,i=0;i<r;i++)e(o[i],n);return t}!function(e){var t,n,o=e.parentNode,r=s.lang.string(e.data).escapeHTML(),i=(t=o.ownerDocument,(n=t._wysihtml_tempElement)||(n=t._wysihtml_tempElement=t.createElement("div")),n);for(i.innerHTML="<span></span>"+r.replace(l,function(e,t){var n=(t.match(c)||[])[1]||"",o=u[n];(t=t.replace(c,"")).split(o).length>t.split(n).length&&(t+=n,n="");var r=t,i=t;return t.length>d&&(i=i.substr(0,d)+"..."),"www."===r.substr(0,4)&&(r="http://"+r),'<a href="'+r+'">'+i+"</a>"+n}),i.removeChild(i.firstChild);i.firstChild;)o.insertBefore(i.firstChild,e);o.removeChild(e)}(t)}}(e,t))},s.dom.autoLink.URL_REG_EXP=l}(wysihtml),function(e){var o=wysihtml.dom;o.addClass=function(e,t){var n=e.classList;if(n)return n.add(t);o.hasClass(e,t)||(e.className+=" "+t)},o.removeClass=function(e,t){var n=e.classList;if(n)return n.remove(t);e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")},o.hasClass=function(e,t){var n=e.classList;if(n)return n.contains(t);var o=e.className;return 0<o.length&&(o==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(o))}}(),wysihtml.dom.compareDocumentPosition=document.documentElement.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)}:function(e,t){var n,o;if(n=9===e.nodeType?e:e.ownerDocument,o=9===t.nodeType?t:t.ownerDocument,e===t)return 0;if(e===t.ownerDocument)return 20;if(e.ownerDocument===t)return 10;if(n!==o)return 1;if(2===e.nodeType&&e.childNodes&&-1!==wysihtml.lang.array(e.childNodes).indexOf(t))return 20;if(2===t.nodeType&&t.childNodes&&-1!==wysihtml.lang.array(t.childNodes).indexOf(e))return 10;for(var r=e,i=[],s=null;r;){if(r==t)return 10;i.push(r),r=r.parentNode}for(r=t,s=null;r;){if(r==e)return 20;var a=wysihtml.lang.array(i).indexOf(r);if(-1!==a){var l=i[a],c=wysihtml.lang.array(l.childNodes).indexOf(i[a-1]);return wysihtml.lang.array(l.childNodes).indexOf(s)<c?2:4}r=(s=r).parentNode}return 1},wysihtml.dom.contains=function(){var e=document.documentElement;return e.contains?function(e,t){if(t.nodeType!==wysihtml.ELEMENT_NODE){if(t.parentNode===e)return!0;t=t.parentNode}return e!==t&&e.contains(t)}:e.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0}(),function(o){var t=document;o.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView||this.element.ownerDocument.parentWindow},getDocument:function(){return this.element.ownerDocument},constructor:function(e,t,n){this.callback=e||o.EMPTY_FUNCTION,this.config=o.lang.object({}).merge(t).get(),this.config.className||(this.config.className="wysihtml-sandbox"),this.element=n?this._bindElement(n):this._createElement()},destroy:function(){},_createElement:function(){var e=t.createElement("div");return e.className=this.config.className,this._loadElement(e),e},_bindElement:function(e){return e.className=e.className?e.className+" wysihtml-sandbox":"wysihtml-sandbox",this._loadElement(e,!0),e},_loadElement:function(e,t){var n=this;if(!t){var o=this._getHtml();e.innerHTML=o}this.loaded=!0,setTimeout(function(){n.callback(n)},0)},_getHtml:function(e){return""}})}(wysihtml),wysihtml.dom.convertToList=function(){function y(e,t){var n=e.createElement("li");return t.appendChild(n),n}return function(e,t,n){if("UL"===e.nodeName||"OL"===e.nodeName||"MENU"===e.nodeName)return e;var o,r,i,s,a,l,c,d,u,f,h=e.ownerDocument,m=(f=t,h.createElement(f)),p=e.querySelectorAll("br"),g=p.length;for(u=0;u<g;u++)for(s=p[u];(a=s.parentNode)&&a!==e&&a.lastChild===s;){if("block"===wysihtml.dom.getStyle("display").from(a)){a.removeChild(s);break}wysihtml.dom.insert(s).after(s.parentNode)}for(r=(o=wysihtml.lang.array(e.childNodes).get()).length,u=0;u<r;u++)d=d||y(h,m),i=o[u],l="block"===wysihtml.dom.getStyle("display").from(i),c="BR"===i.nodeName,!l||n&&wysihtml.dom.hasClass(i,n)?c?d=d.firstChild?null:d:d.appendChild(i):((d=d.firstChild?y(h,m):d).appendChild(i),d=null);return 0===o.length&&y(h,m),e.parentNode.replaceChild(m,e),m}}(),wysihtml.dom.copyAttributes=function(s){return{from:function(i){return{to:function e(t){for(var n,o=0,r=s.length;o<r;o++)n=s[o],void 0!==i[n]&&""!==i[n]&&(t[n]=i[n]);return{andTo:e}}}}}},function(a){var l=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],c=function(e){for(var t=0,n=l.length;t<n;t++)if("border-box"===a.getStyle(l[t]).from(e))return l[t]};a.copyStyles=function(s){return{from:function(e){var t;c(t=e)&&parseInt(a.getStyle("width").from(t),10)<t.offsetWidth&&(s=wysihtml.lang.array(s).without(l));for(var n,o="",r=s.length,i=0;i<r;i++)n=s[i],o+=n+":"+a.getStyle(n).from(e)+";";return{to:function e(t){return a.setStyles(o).on(t),{andTo:e}}}}}}}(wysihtml.dom),wysihtml.dom.delegate=function(s,a,e,l){var t=function(e){for(var t=e.target,n=3===t.nodeType?t.parentNode:t,o=s.querySelectorAll(a),r=0,i=o.length;r<i;r++)o[r].contains(n)&&l.call(o[r],e)};return s.addEventListener(e,t,!1),{stop:function(){s.removeEventListener(e,t,!1)}}},function(u){function i(e,t){for(var n=[e],o=e;t&&o&&o!==t||!t&&o;)n.unshift(o),o=o.parentNode;return n}u.dom.domNode=function(d){var o=[u.ELEMENT_NODE,u.TEXT_NODE];return{is:{emptyTextNode:function(e){var t=e?/^\s*$/g:/^[\r\n]*$/g;return d&&d.nodeType===u.TEXT_NODE&&t.test(d.data)},rangyBookmark:function(){return d&&1===d.nodeType&&d.classList.contains("rangySelectionBoundary")},visible:function(){var e=!/^\s*$/g.test(u.dom.getTextContent(d));return e||1===d.nodeType&&d.querySelector("img, br, hr, object, embed, canvas, input, textarea")&&(e=!0),e},lineBreak:function(){return d&&1===d.nodeType&&"BR"===d.nodeName},block:function(){return d&&1===d.nodeType&&"block"===d.ownerDocument.defaultView.getComputedStyle(d).display},voidElement:function(){return u.dom.domNode(d).test({query:u.VOID_ELEMENTS})}},prev:function(e){var t=d.previousSibling,n=e&&e.nodeTypes?e.nodeTypes:o;return t?u.dom.domNode(t).is.rangyBookmark()||!u.lang.array(n).contains(t.nodeType)||e&&e.ignoreBlankTexts&&u.dom.domNode(t).is.emptyTextNode(!0)?u.dom.domNode(t).prev(e):t:null},next:function(e){var t=d.nextSibling,n=e&&e.nodeTypes?e.nodeTypes:o;return t?u.dom.domNode(t).is.rangyBookmark()||!u.lang.array(n).contains(t.nodeType)||e&&e.ignoreBlankTexts&&u.dom.domNode(t).is.emptyTextNode(!0)?u.dom.domNode(t).next(e):t:null},commonAncestor:function(e,t){var n=i(d,t),o=i(e,t);if(n[0]!=o[0])return null;for(var r=0;r<n.length;r++)if(n[r]!=o[r])return n[r-1];return null},lastLeafNode:function(e){var t;if(1!==d.nodeType)return d;if(!(t=d.lastChild))return d;if(e&&e.leafClasses)for(var n=e.leafClasses.length;n--;)if(u.dom.hasClass(d,e.leafClasses[n]))return d;return u.dom.domNode(t).lastLeafNode(e)},escapeParent:function(e,t){var n,o,r,i=d;if(!u.dom.contains(e,d))throw new Error("Child is not a descendant of node.");do{for(o=(n=i.parentNode).cloneNode(!1);n.lastChild&&n.lastChild!==i;)o.insertBefore(n.lastChild,o.firstChild);if(n!==e&&((r=n.cloneNode(!1)).appendChild(i),i=r),n.parentNode.insertBefore(i,n.nextSibling),""!==o.innerHTML)if(/^\s+$/.test(o.innerHTML))for(;o.lastChild;)n.parentNode.insertBefore(o.lastChild,i.nextSibling);else n.parentNode.insertBefore(o,i.nextSibling);if(""===n.innerHTML)n.parentNode.removeChild(n);else if(/^\s+$/.test(n.innerHTML)){for(;n.firstChild;)n.parentNode.insertBefore(n.firstChild,n);n.parentNode.removeChild(n)}}while(n&&n!==e);t&&i&&(i.parentNode.insertBefore(t,i),t.appendChild(i))},transferContentTo:function(e,t){if(1===d.nodeType){if(u.dom.domNode(e).is.voidElement()||3===e.nodeType)for(;d.lastChild;)e.parentNode.insertBefore(d.lastChild,e.nextSibling);else for(;d.firstChild;)e.appendChild(d.firstChild);t&&d.parentNode.removeChild(d)}else 3!==d.nodeType&&8!==d.nodeType||(u.dom.domNode(e).is.voidElement()?e.parentNode.insertBefore(d,e.nextSibling):e.appendChild(d))},test:function(e){var t;if(!e)return!1;if(1!==d.nodeType)return!1;if(e.query&&!d.matches(e.query))return!1;if(e.nodeName&&d.nodeName.toLowerCase()!==e.nodeName.toLowerCase())return!1;if(e.className&&!d.classList.contains(e.className))return!1;if(e.classRegExp&&0===((d.className||"").match(e.classRegExp)||[]).length)return!1;if(e.styleProperty&&0<e.styleProperty.length)for(var n=!1,o=Array.isArray(e.styleProperty)?e.styleProperty:[e.styleProperty],r=0,i=o.length;r<i;r++){if(t=u.browser.fixStyleKey(o[r]),d.style[t]){if(!e.styleValue){n=!0;break}if(e.styleValue instanceof RegExp){if(0<d.style[t].trim().match(e.styleValue).length){n=!0;break}}else if(Array.isArray(e.styleValue)){if(e.styleValue.indexOf(d.style[t].trim())){n=!0;break}}else if(e.styleValue===d.style[t].trim().replace(/, /g,",")){n=!0;break}}if(!n)return!1}if(e.attribute){var s=u.dom.getAttributes(d),a=[],l=!1;for(var c in Array.isArray(e.attribute)?a=e.attribute:a[e.attribute]=e.attributeValue,a)if(a.hasOwnProperty(c))if(void 0===a[c]){if(void 0!==s[c]){l=!0;break}}else if(s[c]===a[c]){l=!0;break}if(!l)return!1}return!0}}}}(wysihtml),wysihtml.dom.getAsDom=function(){var o=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(e,t){var n;return t=t||document,"object"==typeof e&&e.nodeType?(n=t.createElement("div")).appendChild(e):wysihtml.browser.supportsHTML5Tags(t)?(n=t.createElement("div")).innerHTML=e:(!function(e){if(!e._wysihtml_supportsHTML5Tags){for(var t=0,n=o.length;t<n;t++)e.createElement(o[t]);e._wysihtml_supportsHTML5Tags=!0}}(t),n=function(e,t){var n=t.createElement("div");n.style.display="none",t.body.appendChild(n);try{n.innerHTML=e}catch(e){}return t.body.removeChild(n),n}(e,t)),n}}(),wysihtml.dom.getAttribute=function(e,t){var n=!wysihtml.browser.supportsGetAttributeCorrectly();return t=t.toLowerCase(),"IMG"==e.nodeName&&"src"==t&&!0===wysihtml.dom.isLoadedImage(e)?e.src:n&&"outerHTML"in e?-1!=e.outerHTML.toLowerCase().indexOf(" "+t+"=")?e.getAttribute(t):null:e.getAttribute(t)},wysihtml.dom.getAttributes=function(e){var t,n=!wysihtml.browser.supportsGetAttributeCorrectly(),o=e.nodeName,r=[];for(t in e.attributes)(e.attributes.hasOwnProperty&&e.attributes.hasOwnProperty(t)||!e.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(e.attributes,t))&&e.attributes[t].specified&&("IMG"==o&&"src"==e.attributes[t].name.toLowerCase()&&!0===wysihtml.dom.isLoadedImage(e)?r.src=e.src:wysihtml.lang.array(["rowspan","colspan"]).contains(e.attributes[t].name.toLowerCase())&&n?1!==e.attributes[t].value&&(r[e.attributes[t].name]=e.attributes[t].value):r[e.attributes[t].name]=e.attributes[t].value);return r},wysihtml.dom.getParentElement=function(e,t,n,o){for(n=n||50;n--&&e&&"BODY"!==e.nodeName&&(!o||e!==o);){if(wysihtml.dom.domNode(e).test(t))return e;e=e.parentNode}return null},wysihtml.dom.getPastedHtml=function(e){var t;return wysihtml.browser.supportsModernPaste()&&e.clipboardData&&(wysihtml.lang.array(e.clipboardData.types).contains("text/html")?t=e.clipboardData.getData("text/html"):wysihtml.lang.array(e.clipboardData.types).contains("text/plain")&&(t=wysihtml.lang.string(e.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),t},wysihtml.dom.getPastedHtmlWithDiv=function(t,n){var o=t.selection.getBookmark(),e=t.element.ownerDocument,r=e.createElement("DIV"),i=t.getScrollPos();e.body.appendChild(r),r.style.width="1px",r.style.height="1px",r.style.overflow="hidden",r.style.position="absolute",r.style.top=i.y+"px",r.style.left=i.x+"px",r.setAttribute("contenteditable","true"),r.focus(),setTimeout(function(){var e;t.selection.setBookmark(o),(e=r.innerHTML)&&/^<br\/?>$/i.test(e.trim())&&(e=!1),n(e),r.parentNode.removeChild(r)},0)},wysihtml.dom.getStyle=function(){var u={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},f=/\-[a-z]/g;return function(d){return{from:function(e){if(e.nodeType===wysihtml.ELEMENT_NODE){var t=e.ownerDocument,n=u[d]||d.replace(f,function(e){return e.charAt(1).toUpperCase()}),o=e.style,r=e.currentStyle,i=o[n];if(i)return i;if(r)try{return r[n]}catch(e){}var s,a,l=t.defaultView||t.parentWindow,c=("height"===d||"width"===d)&&"TEXTAREA"===e.nodeName;return l.getComputedStyle?(c&&(s=o.overflow,o.overflow="hidden"),a=l.getComputedStyle(e,null).getPropertyValue(d),c&&(o.overflow=s||""),a):void 0}}}}}(),wysihtml.dom.getTextNodes=function(e,t){var n=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t&&/^\s*$/.test(e.innerText||e.textContent)||n.push(e):n=n.concat(wysihtml.dom.getTextNodes(e,t));return n},function(i){var s={},a=1;i.dom.hasElementWithClassName=function(e,t){if(!i.browser.supportsNativeGetElementsByClassName())return!!e.querySelector("."+t);var n,o=((n=e)._wysihtml_identifier||(n._wysihtml_identifier=a++))+":"+t,r=s[o];return r||(r=s[o]=e.getElementsByClassName(t)),0<r.length}}(wysihtml),wysihtml.dom.hasElementWithTagName=function(){var i={},s=1;return function(e,t){var n,o=((n=e)._wysihtml_identifier||(n._wysihtml_identifier=s++))+":"+t,r=i[o];return r||(r=i[o]=e.getElementsByTagName(t)),0<r.length}}(),wysihtml.dom.insertCSS=function(r){return r=r.join("\n"),{into:function(e){var t=e.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=r:t.appendChild(e.createTextNode(r));var n=e.querySelector("head link");if(n)n.parentNode.insertBefore(t,n);else{var o=e.querySelector("head");o&&o.appendChild(t)}}}},wysihtml.dom.insert=function(t){return{after:function(e){e.parentNode.insertBefore(t,e.nextSibling)},before:function(e){e.parentNode.insertBefore(t,e)},into:function(e){e.appendChild(t)}}},wysihtml.dom.isLoadedImage=function(t){try{return t.complete&&!t.mozMatchesSelector(":-moz-broken")}catch(e){if(t.complete&&"complete"===t.readyState)return!0}},function(s){s.dom.lineBreaks=function(r){function o(e){return"BR"===e.nodeName}function i(e){return!!o(e)||"block"===s.dom.getStyle("display").from(e)}return{add:function(e){var t=r.ownerDocument,n=s.dom.domNode(r).next({ignoreBlankTexts:!0}),o=s.dom.domNode(r).prev({ignoreBlankTexts:!0});n&&!i(n)&&s.dom.insert(t.createElement("br")).after(r),o&&!i(o)&&s.dom.insert(t.createElement("br")).before(r)},remove:function(e){var t=s.dom.domNode(r).next({ignoreBlankTexts:!0}),n=s.dom.domNode(r).prev({ignoreBlankTexts:!0});t&&o(t)&&t.parentNode.removeChild(t),n&&o(n)&&n.parentNode.removeChild(n)}}}}(wysihtml),wysihtml.dom.observe=function(o,r,i){for(var s,e,t=0,n=(r="string"==typeof r?[r]:r).length;t<n;t++)e=r[t],o.addEventListener?o.addEventListener(e,i,!1):(s=function(e){"target"in e||(e.target=e.srcElement),e.preventDefault=e.preventDefault||function(){this.returnValue=!1},e.stopPropagation=e.stopPropagation||function(){this.cancelBubble=!0},i.call(o,e)},o.attachEvent("on"+e,s));return{stop:function(){for(var e,t=0,n=r.length;t<n;t++)e=r[t],o.removeEventListener?o.removeEventListener(e,i,!1):o.detachEvent("on"+e,s)}}},wysihtml.dom.parse=function(e,t){var h={1:function(e,t){var n,o,r,i=b.tags,s=e.nodeName.toLowerCase(),a=e.scopeName;if(e._wysihtml)return null;if(e._wysihtml=1,"wysihtml-temp"===e.className)return null;a&&"HTML"!=a&&(s=a+":"+s);"outerHTML"in e&&(wysihtml.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(s="div"));if(s in i){if(!(n=i[s])||n.remove)return null;if(n.unwrap)return!1;n="string"==typeof n?{rename_tag:n}:n}else{if(!e.firstChild)return null;n={rename_tag:m}}if(n.one_of_type&&!function(e,t,n,o){var r,i;if("SPAN"===e.nodeName&&!o&&("_wysihtml-temp-placeholder"===e.className||"rangySelectionBoundary"===e.className))return!0;for(i in n)if(n.hasOwnProperty(i)&&t.type_definitions&&t.type_definitions[i]&&(r=t.type_definitions[i],l(e,r)))return!0;return!1}(e,b,n.one_of_type,t)){if(!n.remove_action)return null;if("unwrap"===n.remove_action)return!1;if("rename"!==n.remove_action)return null;r=n.remove_action_rename_to||m}o=e.ownerDocument.createElement(r||n.rename_tag||s),function(e,t,n,o){var r,i,s,a,l,c={},d=n.set_class,u=n.add_class,f=n.add_style,h=n.set_attributes,m=b.classes,p=0,g=[],y=[],v=[],N=[];if(h&&(c=wysihtml.lang.object(h).clone()),c=wysihtml.lang.object(c).merge(function(e,t){var n,o,r,i=wysihtml.lang.object(b.attributes||{}).clone(),s=wysihtml.lang.object(i).merge(wysihtml.lang.object(t||{}).clone()).get(),a={},l=wysihtml.dom.getAttributes(e);for(n in s)if(/\*$/.test(n)){r=w(n.slice(0,-1),l);for(var c=0,d=r.length;c<d;c++)!1!==(o=E(r[c],l[r[c]],s[n],e.nodeName))&&(a[r[c]]=o)}else!1!==(o=E(n,l[n],s[n],e.nodeName))&&(a[n]=o);return a}(e,n.check_attributes)).get(),d&&g.push(d),u)for(a in u)(l=R[u[a]])&&"string"==typeof(s=l(wysihtml.dom.getAttribute(e,a)))&&g.push(s);if(f)for(a in f)(l=x[f[a]])&&(newStyle=l(wysihtml.dom.getAttribute(e,a)),"string"==typeof newStyle&&y.push(newStyle));if("string"==typeof m&&"any"===m)if(e.getAttribute("class"))if(b.classes_blacklist){for((N=e.getAttribute("class"))&&(g=g.concat(N.split(C))),r=g.length;p<r;p++)i=g[p],b.classes_blacklist[i]||v.push(i);v.length&&(c.class=wysihtml.lang.array(v).unique().join(" "))}else c.class=e.getAttribute("class");else g&&0<g.length&&(c.class=wysihtml.lang.array(g).unique().join(" "));else{for(o||(m["_wysihtml-temp-placeholder"]=1,m._rangySelectionBoundary=1,m["wysiwyg-tmp-selected-cell"]=1),(N=e.getAttribute("class"))&&(g=g.concat(N.split(C))),r=g.length;p<r;p++)i=g[p],m[i]&&v.push(i);v.length&&(c.class=wysihtml.lang.array(v).unique().join(" "))}for(a in c.class&&o&&(c.class=c.class.replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(c.class)&&delete c.class),y.length&&(c.style=wysihtml.lang.array(y).unique().join(" ")),c)try{t.setAttribute(a,c[a])}catch(e){}c.src&&(void 0!==c.width&&t.setAttribute("width",c.width),void 0!==c.height&&t.setAttribute("height",c.height))}(e,o,n,t),function(e,t,n){var o,r;if(n&&n.keep_styles)for(o in n.keep_styles)if(n.keep_styles.hasOwnProperty(o)){if(r="float"===o?e.style.styleFloat||e.style.cssFloat:e.style[o],n.keep_styles[o]instanceof RegExp&&!n.keep_styles[o].test(r))continue;"float"===o?t.style[e.style.styleFloat?"styleFloat":"cssFloat"]=r:e.style[o]&&(t.style[o]=r)}}(e,o,n),e=null,o.normalize&&o.normalize();return o},3:function(e){var t=e.nextSibling;{if(!t||t.nodeType!==wysihtml.TEXT_NODE){var n=e.data.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,"");return e.ownerDocument.createTextNode(n)}t.data=e.data.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,"")+t.data.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,"")}},8:function(e){if(b.comments)return e.ownerDocument.createComment(e.nodeValue)}},m="span",C=/\s+/,u={tags:{},classes:{}},b={},p=["ADDRESS","BLOCKQUOTE","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL"];function g(e,t,n,o){var r,i,s,a,l=e.nodeType,c=e.childNodes,d=c.length,u=h[l],f=0;if(o&&1===l&&wysihtml.dom.hasClass(e,o))return e;if(!(i=u&&u(e,n))){if(!1===i){for(r=e.ownerDocument.createDocumentFragment(),f=d;f--;)c[f]&&(s=g(c[f],t,n,o))&&(c[f]===s&&f--,r.insertBefore(s,r.firstChild));return""===(a=wysihtml.dom.getStyle("display").from(e))&&(a=wysihtml.lang.array(p).contains(e.tagName)?"block":""),wysihtml.lang.array(["block","flex","table"]).contains(a)&&r.appendChild(e.ownerDocument.createElement("br")),wysihtml.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(e.nodeName.toLowerCase())&&e.parentNode.lastChild!==e&&(e.nextSibling&&3===e.nextSibling.nodeType&&/^\s/.test(e.nextSibling.nodeValue)||r.appendChild(e.ownerDocument.createTextNode(" "))),r.normalize&&r.normalize(),r}return null}for(f=0;f<d;f++)c[f]&&(s=g(c[f],t,n,o))&&(c[f]===s&&f--,i.appendChild(s));if(t&&i.nodeName.toLowerCase()===m&&(!i.childNodes.length||/^\s*$/gi.test(i.innerHTML)&&(n||"_wysihtml-temp-placeholder"!==e.className&&"rangySelectionBoundary"!==e.className)||!i.attributes.length)){for(r=i.ownerDocument.createDocumentFragment();i.firstChild;)r.appendChild(i.firstChild);return r.normalize&&r.normalize(),r}return i.normalize&&i.normalize(),i}function l(e,t){var n,o,r,i,s,a=e.getAttribute("class"),l=e.getAttribute("style");if(t.methods)for(var c in t.methods)if(t.methods.hasOwnProperty(c)&&O[c]&&O[c](e))return!0;if(a&&t.classes){n=(a=a.replace(/^\s+/g,"").replace(/\s+$/g,"").split(C)).length;for(var d=0;d<n;d++)if(t.classes[a[d]])return!0}if(l&&t.styles)for(o in l=l.split(";"),t.styles)if(t.styles.hasOwnProperty(o))for(var u=l.length;u--;)if((s=l[u].split(":"))[0].replace(/\s/g,"").toLowerCase()===o&&(!0===t.styles[o]||1===t.styles[o]||wysihtml.lang.array(t.styles[o]).contains(s[1].replace(/\s/g,"").toLowerCase())))return!0;if(t.attrs)for(r in t.attrs)if(t.attrs.hasOwnProperty(r)&&"string"==typeof(i=wysihtml.dom.getAttribute(e,r))&&-1<i.search(t.attrs[r]))return!0;return!1}function w(e,t){var n=[];for(var o in t)t.hasOwnProperty(o)&&0===o.indexOf(e)&&n.push(o);return n}function E(e,t,n,o){var r,i=wysihtml.lang.object(n).isFunction()?n:T[n];return!(!i||"string"!=typeof(r=i(t,o)))&&r}var n,o,r,i,s,a,c,d,f,y,v,N,S,T={url:(a=/^https?:\/\//i,function(e){return e&&e.match(a)?e.replace(a,function(e){return e.toLowerCase()}):null}),src:(s=/^(\/|https?:\/\/)/i,function(e){return e&&e.match(s)?e.replace(s,function(e){return e.toLowerCase()}):null}),href:(i=/^(#|\/|https?:\/\/|mailto:|tel:)/i,function(e){return e&&e.match(i)?e.replace(i,function(e){return e.toLowerCase()}):null}),alt:(r=/[^ a-z0-9_\-]/gi,function(e,t){return e?e.replace(r,""):"IMG"===t?"":null}),numbers:(o=/\D/g,function(e){return(e=(e||"").replace(o,""))||null}),dimension:(n=/\D*(\d+)(\.\d+)?\s?(%)?\D*/,function(e){return(e=(e||"").replace(n,"$1$2$3"))||null}),any:function(e){return e||null}},x={align_text:(c={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"},function(e){return c[String(e).toLowerCase()]})},R={align_img:(v={left:"wysiwyg-float-left",right:"wysiwyg-float-right"},function(e){return v[String(e).toLowerCase()]}),align_text:(y={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"},function(e){return y[String(e).toLowerCase()]}),clear_br:(f={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"},function(e){return f[String(e).toLowerCase()]}),size_font:(d={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"},function(e){return d[String(e).charAt(0)]})},O={has_visible_contet:(S=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"],function(e){if((N=(e.innerText||e.textContent).replace(/\s/g,""))&&0<N.length)return!0;for(var t=S.length;t--;)if(e.querySelector(S[t]))return!0;return!!(e.offsetWidth&&0<e.offsetWidth&&e.offsetHeight&&0<e.offsetHeight)})},A={unwrap:function(e){wysihtml.dom.unwrap(e)},remove:function(e){e.parentNode.removeChild(e)}};return function(e,t){wysihtml.lang.object(b).merge(u).merge(t.rules).get();var n,o,r,i=t.context||e.ownerDocument||document,s=i.createDocumentFragment(),a="string"==typeof e,l=!1;for(!0===t.clearInternals&&(l=!0),n=a?wysihtml.dom.getAsDom(e,i):e,b.selectors&&function(e,t){var n,o,r;for(n in t)if(t.hasOwnProperty(n)){wysihtml.lang.object(t[n]).isFunction()?o=t[n]:"string"==typeof t[n]&&A[t[n]]&&(o=A[t[n]]);for(var i=(r=e.querySelectorAll(n)).length;i--;)o(r[i])}}(n,b.selectors);n.firstChild;)(o=g(r=n.firstChild,t.cleanUp,l,t.uneditableClass))&&s.appendChild(o),r!==o&&n.removeChild(r);if(t.unjoinNbsps)for(var c=wysihtml.dom.getTextNodes(s),d=c.length;d--;)c[d].nodeValue=c[d].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return n.innerHTML="",n.appendChild(s),a?wysihtml.quirks.getCorrectInnerHTML(n):n}(e,t)},wysihtml.dom.query=function(e,t){var n,o=[];e.nodeType&&(e=[e]);for(var r=0,i=e.length;r<i;r++)if(n=e[r].querySelectorAll(t))for(var s=n.length;s--;o.unshift(n[s]));return o},wysihtml.dom.removeEmptyTextNodes=function(e){for(var t,n=wysihtml.lang.array(e.childNodes).get(),o=n.length,r=0;r<o;r++)(t=n[r]).nodeType===wysihtml.TEXT_NODE&&/^[\n\r]*$/.test(t.data)&&t.parentNode.removeChild(t)},wysihtml.dom.removeInvisibleSpaces=function(e){for(var t=wysihtml.dom.getTextNodes(e),n=t.length;n--;)t[n].nodeValue=t[n].nodeValue.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,"")},wysihtml.dom.renameElement=function(e,t){for(var n,o=e.ownerDocument.createElement(t);n=e.firstChild;)o.appendChild(n);return wysihtml.dom.copyAttributes(["align","className"]).from(e).to(o),e.parentNode&&e.parentNode.replaceChild(o,e),o},wysihtml.dom.replaceWithChildNodes=function(e){if(e.parentNode){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}},function(t){function m(e){return"block"===t.getStyle("display").from(e)}function p(e){return"BR"===e.nodeName}function g(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}t.resolveList=function(e,t){if(e.nodeName.match(/^(MENU|UL|OL)$/)){var n,o,r,i,s,a,l,c=e.ownerDocument,d=c.createDocumentFragment(),u=wysihtml.dom.domNode(e).prev({ignoreBlankTexts:!0}),f=wysihtml.dom.domNode(e).next({ignoreBlankTexts:!0}),h=e.lastElementChild||e.lastChild;if(t)for(!u||m(u)||p(u)||g(d);a=e.firstElementChild||e.firstChild;){for(o=a.lastChild,l=a===h;n=a.firstChild;)r=n===o,i=(!l||f&&!m(f))&&r&&!m(n)&&!p(n),d.appendChild(n),i&&g(d);a.parentNode.removeChild(a)}else for(;a=e.firstElementChild||e.firstChild;){if(a.querySelector&&a.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;n=a.firstChild;)d.appendChild(n);else{for(s=c.createElement("p");n=a.firstChild;)s.appendChild(n);d.appendChild(s)}a.parentNode.removeChild(a)}e.parentNode.replaceChild(d,e)}}}(wysihtml.dom),function(l){var c=document,d=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],u=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],f=["referrer","write","open","close"];l.dom.Sandbox=Base.extend({constructor:function(e,t){this.callback=e||l.EMPTY_FUNCTION,this.config=l.lang.object({}).merge(t).get(),this.config.className||(this.config.className="wysihtml-sandbox"),this.editableArea=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=c.getElementById(e)),e.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw new Error("wysihtml.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var e=this,t=c.createElement("iframe");return t.className=this.config.className,l.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(t),l.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(t.src="javascript:'<html></html>'"),t.onload=function(){t.onreadystatechange=t.onload=null,e._onLoadIframe(t)},t.onreadystatechange=function(){/loaded|complete/.test(t.readyState)&&(t.onreadystatechange=t.onload=null,e._onLoadIframe(t))},t},_onLoadIframe:function(e){if(l.dom.contains(c.documentElement,e)){var t=this,n=e.contentWindow,o=e.contentWindow.document,r=c.characterSet||c.charset||"utf-8",i=this._getHtml({charset:r,stylesheets:this.config.stylesheets});if(o.open("text/html","replace"),o.write(i),o.close(),this.getWindow=function(){return e.contentWindow},this.getDocument=function(){return e.contentWindow.document},n.onerror=function(e,t,n){throw new Error("wysihtml.Sandbox: "+e,t,n)},!l.browser.supportsSandboxedIframes()){var s,a;for(s=0,a=d.length;s<a;s++)this._unset(n,d[s]);for(s=0,a=u.length;s<a;s++)this._unset(n,u[s],l.EMPTY_FUNCTION);for(s=0,a=f.length;s<a;s++)this._unset(o,f[s]);this._unset(o,"cookie","",!0)}l.polyfills&&l.polyfills(n,o).apply(),this.loaded=!0,setTimeout(function(){t.callback(t)},0)}},_getHtml:function(e){var t,n=e.stylesheets,o="",r=0;if(n="string"==typeof n?[n]:n)for(t=n.length;r<t;r++)o+='<link rel="stylesheet" href="'+n[r]+'">';return e.stylesheets=o,l.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(e)},_unset:function(e,t,n,o){try{e[t]=n}catch(e){}try{e.__defineGetter__(t,function(){return n})}catch(e){}if(o)try{e.__defineSetter__(t,function(){})}catch(e){}if(!l.browser.crashesWhenDefineProperty(t))try{var r={get:function(){return n}};o&&(r.set=function(){}),Object.defineProperty(e,t,r)}catch(e){}}})}(wysihtml),function(){var o={className:"class"};wysihtml.dom.setAttributes=function(n){return{on:function(e){for(var t in n)e.setAttribute(o[t]||t,n[t])}}}}(),wysihtml.dom.setStyles=function(o){return{on:function(e){var t=e.style;if("string"!=typeof o)for(var n in o)"float"===n?(t.cssFloat=o[n],t.styleFloat=o[n]):t[n]=o[n];else t.cssText+=";"+o}}},function(a){a.simulatePlaceholder=function(e,t,n,o){var r=o||"wysihtml-placeholder",i=function(){var e=0<t.element.offsetWidth&&0<t.element.offsetHeight;t.hasPlaceholderSet()&&(t.clear(),t.element.focus(),e&&setTimeout(function(){var e=t.selection.getSelection();e.focusNode&&e.anchorNode||t.selection.selectNode(t.element.firstChild||t.element)},0)),t.placeholderSet=!1,a.removeClass(t.element,r)},s=function(){t.isEmpty()&&!t.placeholderSet&&(t.placeholderSet=!0,t.setValue(n,!1),a.addClass(t.element,r))};e.on("set_placeholder",s).on("unset_placeholder",i).on("focus:composer",i).on("paste:composer",i).on("blur:composer",s),s()}}(wysihtml.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml.dom),wysihtml.dom.unwrap=function(e){var t=[];if(e.parentNode){for(;e.lastChild;)t.unshift(e.lastChild),wysihtml.dom.insert(e.lastChild).after(e);e.parentNode.removeChild(e)}return t},wysihtml.quirks.cleanPastedHTML=function(e,t){var n={color:wysihtml.dom.getStyle("color").from(t.referenceNode),fontSize:wysihtml.dom.getStyle("font-size").from(t.referenceNode)},o=function(e,t){var n,o,r,i,s=wysihtml.lang.object(e).clone(!0);for(n in s.tags)if(s.tags.hasOwnProperty(n)&&s.tags[n].keep_styles)for(o in s.tags[n].keep_styles)s.tags[n].keep_styles.hasOwnProperty(o)&&t[o]&&(s.tags[n].keep_styles[o]=(r=t[o],i=wysihtml.lang.string(r).trim().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),new RegExp("^((?!^"+i+"$).)*$","i")));return s}(function(e,t){var n;if(!e)return null;for(var o=0,r=e.length;o<r;o++)if(e[o].condition||(n=e[o].set),e[o].condition&&e[o].condition.test(t))return e[o].set;return n}(t.rules,e)||{},n);return wysihtml.dom.parse(e,{rules:o,cleanUp:!0,context:t.referenceNode.ownerDocument,uneditableClass:t.uneditableClass,clearInternals:!0,unjoinNbsps:!0})},wysihtml.quirks.ensureProperClearing=function(){var t=function(){var t=this;setTimeout(function(){var e=t.innerHTML.toLowerCase();"<p>&nbsp;</p>"!=e&&"<p>&nbsp;</p><p>&nbsp;</p>"!=e||(t.innerHTML="")},0)};return function(e){wysihtml.dom.observe(e.element,["cut","keydown"],t)}}(),function(a){a.quirks.getCorrectInnerHTML=function(e){var t=e.innerHTML;if(-1===t.indexOf("%7E"))return t;var n,o,r,i,s=e.querySelectorAll("[href*='~'], [src*='~']");for(i=0,r=s.length;i<r;i++)n=s[i].href||s[i].src,o=a.lang.string(n).replace("~").by("%7E"),t=a.lang.string(t).replace(o).by(n);return t}}(wysihtml),function(n){var o="wysihtml-quirks-redraw";n.quirks.redraw=function(e){n.dom.addClass(e,o),n.dom.removeClass(e,o);try{var t=e.ownerDocument;t.execCommand("italic",!1,null),t.execCommand("italic",!1,null)}catch(e){}}}(wysihtml),function(l){var c={rgba:{regex:/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,name:"rgba"},rgb:{regex:/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,name:"rgb"},hex6:{regex:/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,name:"hex",radix:16},hex3:{regex:/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,name:"hex",radix:16}},d=function(e){return new RegExp("(^|\\s|;)"+e+"\\s*:\\s*[^;$]+","gi")};function u(e){var t,n;for(t in c)if(c.hasOwnProperty(t)&&(n=c[t]).regex.test(e))return n}l.quirks.styleParser={getColorParseMethod:u,getColorFormat:function(e){var t=u(e);return t?t.name:void 0},parseColor:function(e,t){var n,o,r,i,s,a=e;if(t){if(n=d(t),!(o=e.match(n)))return!1;o=o.pop().split(":")[1],a=l.lang.string(o).trim()}return!!(r=u(a))&&(!!(i=a.match(r.regex))&&(s=r.radix||10,r===c.hex3?(i.shift(),i.push(1),l.lang.array(i).map(function(e,t){return t<3?parseInt(e,s)*s+parseInt(e,s):parseFloat(e)})):(i.shift(),i[3]||i.push(1),l.lang.array(i).map(function(e,t){return t<3?parseInt(e,s):parseFloat(e)}))))},unparseColor:function(e,t){return"hex"===t?(e[0].toString(16)+e[1].toString(16)+e[2].toString(16)).toUpperCase():"hash"===t?"#"+(e[0].toString(16)+e[1].toString(16)+e[2].toString(16)).toUpperCase():"rgb"===t?"rgb("+e[0]+","+e[1]+","+e[2]+")":"rgba"===t?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"csv"===t?e[0]+","+e[1]+","+e[2]+","+e[3]:e[3]&&1!==e[3]?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"rgb("+e[0]+","+e[1]+","+e[2]+")"},parseFontSize:function(e){var t=e.match(d("font-size"));return!!t&&l.lang.string(t[t.length-1].split(":")[1]).trim()}}}(wysihtml),function(y){var v=y.dom;function r(e,t){for(var n=0;t!==e;)if(n++,!(t=t.parentNode))throw new Error("not a descendant of ancestor!");return n}function s(e,t){return 3===e.nodeType?e:e.childNodes[t]||e}function l(t){var n=document.createElement("span"),o=function(e){t.removeEventListener("mouseup",o),t.removeEventListener("keydown",o),t.removeEventListener("touchstart",o),t.removeEventListener("focus",o),t.removeEventListener("blur",o),t.removeEventListener("paste",r),t.removeEventListener("drop",r),t.removeEventListener("beforepaste",r),n&&n.parentNode&&n.parentNode.removeChild(n)},r=function(e){n&&n.parentNode&&setTimeout(o,0)};return n.appendChild(t.ownerDocument.createTextNode(y.INVISIBLE_SPACE)),n.className="_wysihtml-temp-caret-fix",n.style.display="block",n.style.minWidth="1px",n.style.height="0px",t.addEventListener("mouseup",o),t.addEventListener("keydown",o),t.addEventListener("touchstart",o),t.addEventListener("focus",o),t.addEventListener("blur",o),t.addEventListener("paste",r),t.addEventListener("drop",r),t.addEventListener("beforepaste",r),n}y.Selection=Base.extend({constructor:function(e,t,n){rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc,this.win=this.composer.win,this.contain=t,this.unselectableClass=n||!1},getBookmark:function(){var e=this.getRange();return e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},createTemporaryCaretSpaceAfter:function(e){var n=this.doc.createElement("span"),t=this.doc.createTextNode(y.INVISIBLE_SPACE),o=function(e){var t;this.contain.removeEventListener("mouseup",o),this.contain.removeEventListener("keydown",i),this.contain.removeEventListener("touchstart",o),this.contain.removeEventListener("focus",o),this.contain.removeEventListener("blur",o),this.contain.removeEventListener("paste",r),this.contain.removeEventListener("drop",r),this.contain.removeEventListener("beforepaste",r),n&&n.parentNode&&(n.innerHTML=n.innerHTML.replace(y.INVISIBLE_SPACE_REG_EXP,""),/[^\s]+/.test(n.innerHTML)?(t=n.lastChild,y.dom.unwrap(n),this.setAfter(t)):n.parentNode.removeChild(n))}.bind(this),r=function(e){n&&n.parentNode&&setTimeout(o,0)},i=function(e){8===e.which||91===e.which||17===e.which||86===e.which&&(e.ctrlKey||e.metaKey)||o()};return n.className="_wysihtml-temp-caret-fix",n.style.position="absolute",n.style.display="block",n.style.minWidth="1px",n.style.zIndex="99999",n.appendChild(t),e.parentNode.insertBefore(n,e.nextSibling),this.setBefore(t),this.contain.addEventListener("mouseup",o),this.contain.addEventListener("keydown",i),this.contain.addEventListener("touchstart",o),this.contain.addEventListener("focus",o),this.contain.addEventListener("blur",o),this.contain.addEventListener("paste",r),this.contain.addEventListener("drop",r),this.contain.addEventListener("beforepaste",r),n},setAfter:function(o,r,e){var i,s=this.win,t=rangy.createRange(this.doc),n=function(){var e=o.parentNode,t=e?e.childNodes[e.childNodes.length-1]:null;if(!i||t===o&&1===o.nodeType&&"block"===s.getComputedStyle(o).display)if(r){var n=this.doc.createTextNode(y.INVISIBLE_SPACE);o.parentNode.insertBefore(n,o.nextSibling),this.selectNode(n),setTimeout(function(){n&&n.parentNode&&n.parentNode.removeChild(n)},0)}else this.createTemporaryCaretSpaceAfter(o)}.bind(this);if(t.setStartAfter(o),t.setEndAfter(o),document.activeElement&&document.activeElement===this.composer.element)i=this.setSelection(t),n(),e&&e(i);else{var a=this.composer.getScrollPos();this.composer.element.focus(),this.composer.setScrollPos(a),setTimeout(function(){i=this.setSelection(t),n(),e&&e(i)}.bind(this),0)}},selectNode:function(e,t){var n=rangy.createRange(this.doc),o=e.nodeType===y.ELEMENT_NODE,r="canHaveHTML"in e?e.canHaveHTML:"IMG"!==e.nodeName,i=o?e.innerHTML:e.data,s=""===i||i===y.INVISIBLE_SPACE,a=v.getStyle("display").from(e),l="block"===a||"list-item"===a;if(s&&o&&r&&!t)try{e.innerHTML=y.INVISIBLE_SPACE}catch(e){}r?n.selectNodeContents(e):n.selectNode(e),r&&s&&o?n.collapse(l):r&&s&&(n.setStartAfter(e),n.setEndAfter(e)),this.setSelection(n)},getSelectedNode:function(e){var t,n;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(n=this.doc.selection.createRange())&&n.length?n.item(0):(t=this.getSelection(this.doc)).focusNode===t.anchorNode?t.focusNode:(n=this.getRange(this.doc))?n.commonAncestorContainer:this.doc.body},fixSelBorders:function(){var e=this.getRange();!function(e){if(!e.canSurroundContents())for(var t=e.commonAncestorContainer,n=r(t,e.startContainer),o=r(t,e.endContainer);!e.canSurroundContents();)o<n?(e.setStartBefore(e.startContainer),n=r(t,e.startContainer)):(e.setEndAfter(e.endContainer),o=r(t,e.endContainer))}(e),this.setSelection(e)},getSelectedOwnNodes:function(e){for(var t=this.getOwnRanges(),n=[],o=0,r=t.length;o<r;o++)n.push(t[o].commonAncestorContainer||this.doc.body);return n},findNodesInSelection:function(t){for(var e,n=this.getOwnRanges(),o=[],r=0,i=n.length;r<i;r++)e=n[r].getNodes([1],function(e){return y.lang.array(t).contains(e.nodeName)}),o=o.concat(e);return o},filterElements:function(t){for(var e,n=this.getOwnRanges(),o=[],r=0,i=n.length;r<i;r++)e=n[r].getNodes([1],function(e){return t(e,n[r])}),o=o.concat(e);return o},containsUneditable:function(){for(var e=this.getOwnUneditables(),t=this.getSelection(),n=0,o=e.length;n<o;n++)if(t.containsNode(e[n]))return!0;return!1},deleteContents:function(){var e=this.getRange();this.deleteRangeContents(e),this.setSelection(e)},deleteRangeContents:function(e){var t,n,o,r;if(this.unselectableClass){(t=y.dom.getParentElement(e.startContainer,{query:"."+this.unselectableClass},!1,this.contain))&&e.setStartBefore(t),(n=y.dom.getParentElement(e.endContainer,{query:"."+this.unselectableClass},!1,this.contain))&&e.setEndAfter(n);for(var i=(o=e.getNodes([1],function(e){return y.dom.hasClass(e,this.unselectableClass)}.bind(this))).length;i--;)try{r=new CustomEvent("wysihtml:uneditable:delete"),o[i].dispatchEvent(r)}catch(e){}}e.deleteContents()},getCaretNode:function(){var e=this.getSelection();return e&&e.anchorNode?s(e.anchorNode,e.anchorOffset):null},getPreviousNode:function(e,t){var n;if(!e){var o=this.getSelection();e=o&&o.anchorNode?s(o.anchorNode,o.anchorOffset):null}if(e===this.contain)return!1;var r,i=e.previousSibling;return i!==this.contain&&(i&&3!==i.nodeType&&1!==i.nodeType?i=this.getPreviousNode(i,t):i&&3===i.nodeType&&/^\s*$/.test(i.textContent)?i=this.getPreviousNode(i,t):t&&i&&1===i.nodeType?(n=y.dom.getStyle("display").from(i),y.lang.array(["BR","HR","IMG"]).contains(i.nodeName)||y.lang.array(["block","inline-block","flex","list-item","table"]).contains(n)||!/^[\s]*$/.test(i.innerHTML)||(i=this.getPreviousNode(i,t))):i||e===this.contain||(r=e.parentNode)!==this.contain&&(i=this.getPreviousNode(r,t)),i!==this.contain&&i)},getNodesNearCaret:function(){if(!this.isCollapsed())throw"Selection must be caret when using selection.getNodesNearCaret()";var e,t,n,o,r=this.getOwnRanges();return r&&0<r.length?(1===r[0].startContainer.nodeType?(e=r[0].startContainer.childNodes[r[0].startOffset-1])||0!==r[0].startOffset?e&&(t=e.previousSibling,n=e.nextSibling):n=r[0].startContainer.childNodes[0]:(0===r[0].startOffset&&r[0].startContainer.previousSibling?3===(e=r[0].startContainer.previousSibling).nodeType&&(o=e.data.length):(e=r[0].startContainer,o=r[0].startOffset),t=e.previousSibling,n=e.nextSibling),{caretNode:e,prevNode:t,nextNode:n,textOffset:o}):null},getSelectionParentsByTag:function(e){for(var t,n=this.getSelectedOwnNodes(),o=[],r=0,i=n.length;r<i;r++)(t=n[r].nodeName&&"LI"===n[r].nodeName?n[r]:y.dom.getParentElement(n[r],{query:"li"},!1,this.contain))&&o.push(t);return o.length?o:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var e,t,n,o=this.getRange();if(o)return e=o.startContainer,t=o.startOffset,(n=rangy.createRange(this.doc)).selectNodeContents(e),n.setStart(e,t),n}},getRangeToNodeBeginning:function(){if(this.isCollapsed()){var e=this.getRange(),t=e.startContainer,n=e.startOffset,o=rangy.createRange(this.doc);return o.selectNodeContents(t),o.setEnd(t,n),o}},caretIsInTheEndOfNode:function(e){rangy.createRange(this.doc),this.getSelection();var t,n,o=this.getRangeToNodeEnd();return!!o&&(t=o.cloneContents().textContent,!!/^\s*$/.test(t)&&(!e||(n=this.getRangeToNodeBeginning().cloneContents().textContent,!/[\u00A0 ][\s\uFEFF]*$/.test(n))))},caretIsFirstInSelection:function(e){var t=rangy.createRange(this.doc),n=this.getSelection(),o=this.getRange(),r=s(o.startContainer,o.startOffset);if(r){if(r.nodeType===y.TEXT_NODE){if(!r.parentNode)return!1;if(!this.isCollapsed()||r.parentNode.firstChild!==r&&!y.dom.domNode(r.previousSibling).is.block())return!1;var i=this.win.getComputedStyle(r.parentNode).whiteSpace;return"pre"===i||"pre-wrap"===i?0===o.startOffset:/^\s*$/.test(r.data.substr(0,o.startOffset))}return!(!e||!y.dom.domNode(r).is.lineBreak())||(t.selectNodeContents(this.getRange().commonAncestorContainer),t.collapse(!0),this.isCollapsed()&&(t.startContainer===n.anchorNode||t.endContainer===n.anchorNode)&&t.startOffset===n.anchorOffset)}},caretIsInTheBeginnig:function(e){var t=this.getSelection(),n=t.anchorNode,o=t.anchorOffset;return e&&n?0===o&&(n.nodeName&&n.nodeName===e.toUpperCase()||y.dom.getParentElement(n.parentNode,{query:e},1)):n?0===o&&!this.getPreviousNode(n,!0):void 0},getBeforeSelection:function(e){var t,n,o=this.getSelection(),r=o.isBackwards()?o.focusNode:o.anchorNode,i=o.isBackwards()?o.focusOffset:o.anchorOffset,s=this.createRange();if(r&&3===r.nodeType&&/^\s*$/.test(r.data.slice(0,i))&&(i=0),(n=y.dom.getParentElement(r,{query:"._wysihtml-temp-caret-fix"},1))&&(r=n.parentNode,i=Array.prototype.indexOf.call(r.childNodes,n)),r){if(0<i)return 3===r.nodeType?(s.setStart(r,0),s.setEnd(r,i),{type:"text",range:s,offset:i,node:r}):(s.setStartBefore(r.childNodes[0]),t=r.childNodes[i-1],s.setEndAfter(t),{type:"element",range:s,offset:i,node:t});if(s.setStartAndEnd(r,0),e){var a=this.getPreviousNode(r,!0),l=null;if(a&&(l=1===a.nodeType&&y.dom.hasClass(a,this.unselectableClass)?a:y.dom.domNode(a).lastLeafNode()),l)return{type:"leafnode",range:s,offset:i,node:l}}return{type:"none",range:s,offset:i,node:r}}return null},executeAndRestoreRangy:function(e,t){var n=rangy.saveSelection(this.win);if(n)try{e()}catch(e){setTimeout(function(){throw e},0)}else e();rangy.restoreSelection(n)},executeAndRestore:function(e,t){var n,o,r,i,s,a,l,c,d=this.doc.body,u=t&&d.scrollTop,f=t&&d.scrollLeft,h="_wysihtml-temp-placeholder",m='<span class="'+h+'">'+y.INVISIBLE_SPACE+"</span>",p=this.getRange(!0);if(p){p.collapsed||(a=(l=p.cloneRange()).createContextualFragment(m),l.collapse(!1),l.insertNode(a),l.detach()),s=p.createContextualFragment(m),p.insertNode(s),a&&(n=this.contain.querySelectorAll("."+h),p.setStartBefore(n[0]),p.setEndAfter(n[n.length-1])),this.setSelection(p);try{e(p.startContainer,p.endContainer)}catch(e){setTimeout(function(){throw e},0)}if((n=this.contain.querySelectorAll("."+h))&&n.length){c=rangy.createRange(this.doc),r=n[0].nextSibling,1<n.length&&(i=n[n.length-1].previousSibling),i&&r?(c.setStartBefore(r),c.setEndAfter(i)):(o=this.doc.createTextNode(y.INVISIBLE_SPACE),v.insert(o).after(n[0]),c.setStartBefore(o),c.setEndAfter(o)),this.setSelection(c);for(var g=n.length;g--;)n[g].parentNode.removeChild(n[g])}else this.contain.focus();t&&(d.scrollTop=u,d.scrollLeft=f);try{n.parentNode.removeChild(n)}catch(e){}}else e(d,d)},set:function(e,t){var n=rangy.createRange(this.doc);n.setStart(e,t||0),this.setSelection(n)},insertHTML:function(e){var t,n,o=this.getRange(),r=this.doc.createElement("DIV"),i=this.doc.createDocumentFragment();if(o){for(o.deleteContents(),r.innerHTML=e,t=r.lastChild;r.firstChild;)i.appendChild(r.firstChild);for(o.insertNode(i),n=this.contain.lastChild;n&&3===n.nodeType&&n.previousSibling&&/^\s*$/.test(n.data);)n=n.previousSibling;t&&(n&&t===n&&1===t.nodeType&&this.contain.appendChild(this.doc.createElement("br")),this.setAfter(t))}},insertNode:function(e){var t=this.getRange();t&&(t.deleteContents(),t.insertNode(e))},canAppendChild:function(e){var t,n,o=this.getRange();return(t=e||o.startContainer)&&(n=(t.tagName||t.nodeName).toLowerCase()),-1===["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].indexOf(n)},splitElementAtCaret:function(e,t){var n,o,r,i,s,a=this.getSelection();if(0<a.rangeCount){(n=a.getRangeAt(0).cloneRange()).setEndAfter(e);for(var l=(s=(o=n.extractContents()).childNodes).length;l--;)y.dom.domNode(s[l]).is.visible()||o.removeChild(s[l]);e.parentNode.insertBefore(o,e.nextSibling),t?(r=t.firstChild||t,i=t.lastChild||t,e.parentNode.insertBefore(t,e.nextSibling),r&&i&&(n.setStartBefore(r),n.setEndAfter(i),this.setSelection(n))):(n.setStartAfter(e),n.setEndAfter(e)),y.dom.domNode(e).is.visible()||(""===y.dom.getTextContent(e)?e.parentNode.removeChild(e):e.parentNode.replaceChild(this.doc.createTextNode(" "),e))}},surround:function(e){var t,n=this.getOwnRanges(),o=[];if(0==n.length)return o;for(var r=n.length;r--;){t=this.doc.createElement(e.nodeName),o.push(t),e.className&&(t.className=e.className),e.cssStyle&&t.setAttribute("style",e.cssStyle);try{n[r].surroundContents(t),this.selectNode(t)}catch(e){t.appendChild(n[r].extractContents()),n[r].insertNode(t)}}return o},scrollIntoView:function(){var e,t,n=this.doc,o=n.documentElement.scrollHeight>n.documentElement.offsetHeight,r=n._wysihtmlScrollIntoViewElement=n._wysihtmlScrollIntoViewElement||((t=n.createElement("span")).innerHTML=y.INVISIBLE_SPACE,t);o&&(this.insertNode(r),e=function(e){var t=0;if(e.parentNode)for(;t+=e.offsetTop||0,e=e.offsetParent;);return t}(r),r.parentNode.removeChild(r),e>=n.body.scrollTop+n.documentElement.offsetHeight-5&&(n.body.scrollTop=e))},selectLine:function(){var e=rangy.createRange();y.browser.supportsSelectionModify()?this._selectLine_W3C():e.nativeRange&&e.nativeRange.getBoundingClientRect&&this._selectLineUniversal()},includeRangyRangeHelpers:function(){var e,t=this.getSelection(),n=t.getRangeAt(0),o=function(e){return e&&1===e.nodeType&&e.classList.contains("rangySelectionBoundary")},r=1===t.anchorNode.nodeType?t.anchorNode.childNodes[t.anchorOffset]:t.anchorNode,i=1===t.focusNode.nodeType?t.focusNode.childNodes[t.focusOffset]:t.focusNode;i&&t.focusOffset===(1===(e=i).nodeType?e.childNodes&&e.childNodes.length||0:e.data&&e.data.length||0)&&i.nextSibling&&o(i.nextSibling)&&n.setEndAfter(i.nextSibling),r&&0===t.anchorOffset&&r.previousSibling&&o(r.previousSibling)&&n.setStartBefore(r.previousSibling),n.select()},_selectLine_W3C:function(){var e=this.win.getSelection(),t=[e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset];e.modify("move","left","lineboundary"),e.modify("extend","right","lineboundary"),e.anchorNode===t[0]&&e.anchorOffset===t[1]&&e.focusNode===t[2]&&e.focusOffset===t[3]?this._selectLineUniversal():this.includeRangyRangeHelpers()},toLineBoundary:function(e,t){if(t=void 0!==t&&t,y.browser.supportsSelectionModify()){var n=this.win.getSelection();n.modify("extend",e,"lineboundary"),t&&("left"===e?n.collapseToStart():"right"===e&&n.collapseToEnd())}},getRangeRect:function(e){this.doc.createTextNode("i");var t,n=this.doc.createTextNode("i");return e.collapsed?(e.insertNode(n),e.selectNode(n),t=e.nativeRange.getBoundingClientRect(),e.deleteContents()):t=e.nativeRange.getBoundingClientRect(),t},_selectLineUniversal:function(){var e,t,n,o,r,i=this.getSelection().getRangeAt(0),s=0,a=this;for(i.cloneRange(),i.cloneRange(),i.collapsed&&(3===i.startContainer.nodeType&&i.startOffset<i.startContainer.data.length?i.moveEnd("character",1):1===i.startContainer.nodeType&&i.startContainer.childNodes[i.startOffset]&&3===i.startContainer.childNodes[i.startOffset].nodeType&&0<i.startContainer.childNodes[i.startOffset].data.length?i.moveEnd("character",1):0<i.startOffset&&(3===i.startContainer.nodeType||1===i.startContainer.nodeType&&(!(r=function(e){var t=e;if(t)for(;t&&(1===t.nodeType&&t.classList.contains("rangySelectionBoundary")||3===t.nodeType&&/^\s*$/.test(t.data));)t=t.previousSibling;return t}(i.startContainer.childNodes[i.startOffset-1]))||1!==r.nodeType||"block"!==a.win.getComputedStyle(r).display&&!y.lang.array(["BR","HR"]).contains(r.nodeName)))&&i.moveStart("character",-1)),i.collapsed||i.insertNode(this.doc.createTextNode(y.INVISIBLE_SPACE)),e=i.nativeRange.getBoundingClientRect();t=i.moveStart("character",-1),(n=i.nativeRange.getBoundingClientRect())&&Math.floor(n.top)===Math.floor(e.top)||(i.moveStart("character",1),o=!0),s++,0!==t&&!o&&s<2e3;);if(s=0,o=!1,e=i.nativeRange.getBoundingClientRect(),i.endContainer!==this.contain||this.contain.lastChild&&this.contain.childNodes[i.endOffset]!==this.contain.lastChild)for(;t=i.moveEnd("character",1),(n=i.nativeRange.getBoundingClientRect())&&Math.floor(n.bottom)===Math.floor(e.bottom)||(i.moveEnd("character",-1),i.endContainer&&1===i.endContainer.nodeType&&i.endContainer.childNodes[i.endOffset]&&1===i.endContainer.childNodes[i.endOffset].nodeType&&"BR"===i.endContainer.childNodes[i.endOffset].nodeName&&i.endContainer.childNodes[i.endOffset].previousSibling&&(1===i.endContainer.childNodes[i.endOffset].previousSibling.nodeType?i.setEnd(i.endContainer.childNodes[i.endOffset].previousSibling,i.endContainer.childNodes[i.endOffset].previousSibling.childNodes.length):3===i.endContainer.childNodes[i.endOffset].previousSibling.nodeType&&i.setEnd(i.endContainer.childNodes[i.endOffset].previousSibling,i.endContainer.childNodes[i.endOffset].previousSibling.data.length)),o=!0),s++,0!==t&&!o&&s<2e3;);i.select(),this.includeRangyRangeHelpers()},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var n=this.getRange();return n?n.getNodes(Array.isArray(e)?e:[e],t):[]},getOwnNodes:function(e,t,n){for(var o=this.getOwnRanges(),r=[],i=0,s=o.length;i<s;i++)o[i]&&(n&&o[i].splitBoundaries(),r=r.concat(o[i].getNodes(Array.isArray(e)?e:[e],t)));return r},fixRangeOverflow:function(e){if(this.contain&&this.contain.firstChild&&e){var t=e.compareNode(this.contain);if(2!==t)1===t&&e.setStartBefore(this.contain.firstChild),0===t&&e.setEndAfter(this.contain.lastChild),3===t&&(e.setStartBefore(this.contain.firstChild),e.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(e)){var n=e.endContainer.previousElementSibling;n&&e.setEnd(n,this._endOffsetForNode(n))}}},_endOffsetForNode:function(e){var t=document.createRange();return t.selectNodeContents(e),t.endOffset},_detectInlineRangeProblems:function(e){var t=v.compareDocumentPosition(e.startContainer,e.endContainer);return 0==e.endOffset&&4&t},getRange:function(e){var t=this.getSelection(),n=t&&t.rangeCount&&t.getRangeAt(0);return!0!==e&&this.fixRangeOverflow(n),n},getOwnUneditables:function(){var e=v.query(this.contain,"."+this.unselectableClass),t=v.query(e,"."+this.unselectableClass);return y.lang.array(e).without(t)},getOwnRanges:function(){var e,t=[],n=this.getRange();if(n&&t.push(n),this.unselectableClass&&this.contain&&n){var o,r=this.getOwnUneditables();if(0<r.length)for(var i=0,s=r.length;i<s;i++){e=[];for(var a=0,l=t.length;a<l;a++){if(t[a])switch(t[a].compareNode(r[i])){case 2:break;case 3:(o=t[a].cloneRange()).setEndBefore(r[i]),e.push(o),(o=t[a].cloneRange()).setStartAfter(r[i]),e.push(o);break;default:e.push(t[a])}t=e}}}return t},getSelection:function(){return rangy.getSelection(this.win)},setSelection:function(e){var t=rangy.getSelection(this.win);return t.setSingleRange(e),t&&t.anchorNode&&t.focusNode?t:null},selectAll:function(){var e,t=this.createRange(),n=this.composer,o=this,r=l(this.composer.element),i=l(this.composer.element),s=function(){t.setStart(n.element,0),t.setEnd(n.element,n.element.childNodes.length),e=o.setSelection(t)},a=function(){return!e||e.nativeSelection&&e.nativeSelection.type&&("Caret"===e.nativeSelection.type||"None"===e.nativeSelection.type)};y.dom.removeInvisibleSpaces(this.composer.element),s(),this.composer.element.firstChild&&a()&&(this.composer.element.appendChild(r),s(),a()&&(r.parentNode.removeChild(r),this.composer.element.insertBefore(i,this.composer.element.firstChild),s(),a()&&(this.composer.element.appendChild(r),s())))},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},getPlainText:function(){return this.getSelection().toString()},isEndToEndInNode:function(e){var t=this.getRange(),n=t.commonAncestorContainer,o=t.startContainer,r=t.endContainer;if(n.nodeType===y.TEXT_NODE&&(n=n.parentNode),o.nodeType===y.TEXT_NODE&&!/^\s*$/.test(o.data.substr(t.startOffset)))return!1;if(r.nodeType===y.TEXT_NODE&&!/^\s*$/.test(r.data.substr(t.endOffset)))return!1;for(;o&&o!==n;){if(o.nodeType!==y.TEXT_NODE&&!y.dom.contains(n,o))return!1;if(y.dom.domNode(o).prev({ignoreBlankTexts:!0}))return!1;o=o.parentNode}for(;r&&r!==n;){if(r.nodeType!==y.TEXT_NODE&&!y.dom.contains(n,r))return!1;if(y.dom.domNode(r).next({ignoreBlankTexts:!0}))return!1;r=r.parentNode}return!!y.lang.array(e).contains(n.nodeName)&&n},isInThisEditable:function(){var e=this.getSelection(),t=e.focusNode,n=e.anchorNode;return t&&1!==t.nodeType&&(t=t.parentNode),n&&1!==n.nodeType&&(n=n.parentNode),n&&t&&(y.dom.contains(this.composer.element,t)||this.composer.element===t)&&(y.dom.contains(this.composer.element,n)||this.composer.element===n)},deselect:function(){var e=this.getSelection();e&&e.removeAllRanges()}})}(wysihtml),wysihtml.Commands=Base.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return wysihtml.browser.supportsCommand(this.doc,e)},exec:function(e,t){var n=wysihtml.commands[e],o=wysihtml.lang.array(arguments).get(),r=n&&n.exec,i=null;if(this.composer.hasPlaceholderSet()&&!wysihtml.lang.array(["styleWithCSS","enableObjectResizing","enableInlineTableEditing"]).contains(e)&&(this.composer.element.innerHTML="",this.composer.selection.selectNode(this.composer.element)),this.editor.fire("beforecommand:composer"),r)o.unshift(this.composer),i=r.apply(n,o);else try{i=this.doc.execCommand(e,!1,t)}catch(e){}return this.editor.fire("aftercommand:composer"),i},remove:function(e,t){var n=wysihtml.commands[e],o=wysihtml.lang.array(arguments).get(),r=n&&n.remove;if(r)return o.unshift(this.composer),r.apply(n,o)},state:function(e,t){var n=wysihtml.commands[e],o=wysihtml.lang.array(arguments).get(),r=n&&n.state;if(r)return o.unshift(this.composer),r.apply(n,o);try{return this.doc.queryCommandState(e)}catch(e){return!1}},stateValue:function(e){var t=wysihtml.commands[e],n=wysihtml.lang.array(arguments).get(),o=t&&t.stateValue;return!!o&&(n.unshift(this.composer),o.apply(t,n))}}),function(a){var l={nodeName:"A",toggle:!1};a.commands.createLink={exec:function(e,t,n){var o,r,i=(r="object"==typeof(o=n)?o:{href:o},a.lang.object({}).merge(l).merge({attribute:r}).get());if(e.selection.isCollapsed()&&!this.state(e,t)){if(""!==i.attribute.text)var s=e.doc.createTextNode(i.attribute.text);else s=e.doc.createTextNode(i.attribute.href);e.selection.insertNode(s),e.selection.selectNode(s)}a.commands.formatInline.exec(e,t,i)},state:function(e,t){return a.commands.formatInline.state(e,t,l)}}}(wysihtml),function(O){var l=O.dom,A="h1, h2, h3, h4, h5, h6, p, pre",L="h1, h2, h3, h4, h5, h6, p, pre, div, blockquote",f="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u";function _(e,t){return 3===e.nodeType?e:e.childNodes[t]||e}function B(e){return e&&1===e.nodeType&&"BR"===e.nodeName}function a(e){return e&&1===e.nodeType&&e.classList.contains("rangySelectionBoundary")}function h(e,t){return B(e)||(o=t,(n=e)&&1===n.nodeType&&"block"===o.win.getComputedStyle(n).display);var n,o}function d(e,t){O.dom.removeInvisibleSpaces(e.element);for(var n,o=e.element,r=o.querySelectorAll(L),i=e.config.classNames.uneditableContainer+[""].concat(L.split(",")).join(", "+e.config.classNames.uneditableContainer+" "),s=o.querySelectorAll(i),a=O.lang.array(r).without(s),l=a.length;l--;)""!==a[l].innerHTML.replace(/[\uFEFF]/g,"")||0!==t.length&&a[l]===t[t.length-1]||(-1<(n=O.lang.array(t).indexOf(a[l]))&&t.splice(n,1),a[l].parentNode.removeChild(a[l]));return t}function P(e){return e.config.useLineBreaks?"DIV":"P"}function I(e,t,n){for(var o=e,r=null;o&&t&&o!==t;)1===o.nodeType&&o.matches(n?L:A)&&(r=o),o=o.parentNode;return r}function D(e,t,n){return e||(e=n.doc.createElement(t.nodeName||P(n))).appendChild(n.doc.createTextNode(O.INVISIBLE_SPACE)),t.nodeName&&e.nodeName!==t.nodeName&&(e=l.renameElement(e,t.nodeName)),t.classRegExp&&(e.className=e.className.replace(t.classRegExp,"")),t.className&&e.classList.add(t.className),t.styleProperty&&void 0!==t.styleValue&&(e.style[O.browser.fixStyleKey(t.styleProperty)]=t.styleValue),e}function u(e,t,n){var o,r=e.previousSibling,i=e.nextSibling,s=!1;t.styleProperty&&(e.style[O.browser.fixStyleKey(t.styleProperty)]=""),t.className&&e.classList.remove(t.className),t.classRegExp&&(e.className=e.className.replace(t.classRegExp,"")),null!==e.getAttribute("class")&&""===e.getAttribute("class").trim()&&e.removeAttribute("class"),t.nodeName&&e.nodeName.toLowerCase()===t.nodeName.toLowerCase()&&((o=e.getAttribute("style"))&&""!==o.trim()?e=l.renameElement(e,P(n)):(l.unwrap(e),s=!0)),null!==e.getAttribute("style")&&""===e.getAttribute("style").trim()&&e.removeAttribute("style"),s&&function(e,t,n){e&&a(e)&&(e=e.previousSibling);t&&a(t)&&(t=t.nextSibling);e&&e.previousSibling,e&&(1!==e.nodeType||"block"!==n.win.getComputedStyle(e).display&&!B(e))&&e.parentNode&&e.parentNode.insertBefore(n.doc.createElement("br"),e.nextSibling);t&&(1!==t.nodeType||"block"!==n.win.getComputedStyle(t).display)&&t.parentNode&&t.parentNode.insertBefore(n.doc.createElement("br"),t)}(r,i,n)}function k(e){for(var t,n=e.querySelectorAll(L)||[],o=n.length;o--;)t=O.dom.domNode(n[o]).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),O.dom.domNode(n[o]).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),t&&1!==t.nodeType&&"BR"!==t.nodeName&&""!==(n[o].innerHTML||n[o].nodeValue||"").trim()&&n[o].parentNode.insertBefore(n[o].ownerDocument.createElement("BR"),t),t&&1!==t.nodeType&&"BR"!==t.nodeName&&""!==(n[o].innerHTML||n[o].nodeValue||"").trim()&&n[o].parentNode.insertBefore(n[o].ownerDocument.createElement("BR"),t),O.dom.unwrap(n[o])}function M(e,t,n,o){var r,i,s,a,l,c=t.startContainer;if(o=o||I(c,n.element,!0))i=e.firstChild,s=e.lastChild,n.selection.splitElementAtCaret(o,e),l=O.dom.domNode(s).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),a=O.dom.domNode(i).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),i&&!h(i,n)&&a&&!h(a,n)&&i.parentNode.insertBefore(n.doc.createElement("br"),i),s&&!h(s,n)&&l&&!h(l,n)&&l.parentNode.insertBefore(n.doc.createElement("br"),l);else if((r=function(e,t){for(var n,o,r,i=e,s=null;i&&t&&i!==t;)1===i.nodeType&&i.matches(f)&&(o=i,null===s?n=s=i.cloneNode(!1):((r=i.cloneNode(!1)).appendChild(s),s=r)),i=i.parentNode;return{parent:o,outerNode:s,innerNode:n}}(c,n.element)).outerNode&&r.innerNode&&r.parent){if(1===e.childNodes.length){for(;e.firstChild.firstChild;)r.innerNode.appendChild(e.firstChild.firstChild);e.firstChild.appendChild(r.outerNode)}n.selection.splitElementAtCaret(r.parent,e)}else{var d=e.firstChild,u=e.lastChild;t.insertNode(e),t.setStartBefore(d),t.setEndAfter(u)}}function p(e,t,n){for(var o,r,i=e.cloneRange(),s=_(i.startContainer,i.startOffset).previousSibling,a=_(i.endContainer,i.endOffset).nextSibling,l=i.extractContents(),c=n.doc.createDocumentFragment();l.firstChild;){if(1===l.firstChild.nodeType&&l.firstChild.matches(L)){k(l.firstChild),0<(o=O.dom.unwrap(l.firstChild)).length&&(c.lastChild&&(1!==c.lastChild.nodeType||!h(c.lastChild,n))||!c.lastChild&&s&&(1!==s.nodeType||h(s,n)))&&c.appendChild(n.doc.createElement("BR"));for(var d=0,u=o.length;d<u;d++)c.appendChild(o[d]);0<o.length&&(1===c.lastChild.nodeType&&h(c.lastChild,n)||(a||c.lastChild!==l.lastChild)&&c.appendChild(n.doc.createElement("BR")))}else c.appendChild(l.firstChild);!1}return r=O.lang.array(c.childNodes).get(),M(c,i,n),r}var H=function(e,t){var n=e.data?e.data.slice(0,t):"";return/^\s*$/.test(n)},V=function(e,t){var n=e.data?e.data.slice(t):"";return/^\s*$/.test(n)},F=function(e){if(e){for(;e.firstChild&&3===e.firstChild.nodeType&&/^\s*$/.test(e.firstChild.data)&&e.lastChild!==e.firstChild;)e.removeChild(e.firstChild);for(;e.lastChild&&3===e.lastChild.nodeType&&/^\s*$/.test(e.lastChild.data)&&e.lastChild!==e.firstChild;)e.removeChild(e.lastChild);e.firstChild&&1===e.firstChild.nodeType&&"BR"===e.firstChild.nodeName&&e.lastChild!==e.firstChild&&e.removeChild(e.firstChild),e.lastChild&&1===e.lastChild.nodeType&&"BR"===e.lastChild.nodeName&&e.lastChild!==e.firstChild&&e.removeChild(e.lastChild)}};function g(e,t,n,o){var r,i,s,a,l,c,d,u,f,h,m,p=t?{nodeName:(s=t).nodeName||null,className:s.classRegExp?null:s.className||null,classRegExp:s.classRegExp||null,styleProperty:s.styleProperty||null}:null,g=e.cloneRange(),y=g.startContainer,v=_(g.startContainer,g.startOffset),N=_(g.endContainer,g.endOffset),C=g.startContainer!==v||3!==v.nodeType||H(v,g.startOffset)?O.dom.domNode(v).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}):v,b=1===g.endContainer.nodeType&&g.endContainer.childNodes[g.endOffset]===N&&(1===N.nodeType||!V(N,g.endOffset)&&!O.dom.domNode(N).is.rangyBookmark())||g.endContainer===N&&3===N.nodeType&&!V(N,g.endOffset)?N:O.dom.domNode(N).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),w=g.extractContents(),E=o.doc.createDocumentFragment(),S=p?O.dom.getParentElement(y,p,null,o.element):null,T=!n||!t||"BLOCKQUOTE"===t.nodeName&&"BLOCKQUOTE"===n,x=S||I(y,o.element,T);if(O.dom.domNode(b).is.rangyBookmark()&&(b=(N=b).nextSibling),F(w),t&&"BLOCKQUOTE"===t.nodeName){var R=D(null,t,o);R.appendChild(w),E.appendChild(R),i=[R]}else{if(w.firstChild)for(;w.firstChild;)if(1==w.firstChild.nodeType&&w.firstChild.matches(L))D(w.firstChild,t,o),w.firstChild.matches(A)&&k(w.firstChild),E.appendChild(w.firstChild);else{for(r=D(null,(l=n,c=o,d=void 0,(d=(a=t)?O.lang.object(a).clone(!0):null)&&(d.nodeName=d.nodeName||l||P(c)),d),o);w.firstChild&&(1!==w.firstChild.nodeType||!w.firstChild.matches(L));)1==w.firstChild.nodeType&&r.matches(A)&&k(w.firstChild),r.appendChild(w.firstChild);E.appendChild(r)}else E.appendChild(D(null,t,o));i=O.lang.array(E.childNodes).get()}return M(E,g,o,x),f=b,h=o,m=(u=C)&&O.dom.domNode(u).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),B(f)&&f.parentNode.removeChild(f),!B(u)||m&&1===m.nodeType&&"block"===h.win.getComputedStyle(m).display||u.parentNode.removeChild(u),0<i.length&&(void 0===i[i.length-1].lastChild||O.dom.domNode(i[i.length-1].lastChild).is.rangyBookmark())&&i[i.length-1].appendChild(o.doc.createElement("br")),i}function m(e,t){var n,o=O.dom.getParentElement(e.selection.getOwnRanges()[0].startContainer,{query:A+", "+(t?t.toLowerCase():"div")},null,e.element);o?((n=e.selection.createRange()).selectNode(o),e.selection.setSelection(n)):e.isEmpty()||e.selection.selectLine()}function y(e,t){var n=t.selection.createRange(),o=e[e.length-1],r=1===o.nodeType&&o.childNodes?0|o.childNodes.length:o.length||0;n.setStart(e[0],0),n.setEnd(o,r),n.select()}function v(e,t,n){for(var o,r,i,s,a,l,c,d,u,f=t.selection.getOwnRanges(),h=[],m=(f=function(e){for(var t,n,o,r,i,s,a=[],l=0,c=e.length;l<c;l++)if(1===e[l].startContainer.nodeType&&e[l].startContainer.matches("ul, ol")&&e[l].setStart(e[l].startContainer.childNodes[e[l].startOffset],0),1===e[l].endContainer.nodeType&&e[l].endContainer.matches("ul, ol")&&(s=e[l].endContainer.childNodes[Math.max(e[l].endOffset-1,0)]).childNodes&&e[l].setEnd(s,s.childNodes.length),0<(t=e[l].getNodes([1],function(e){return"LI"===e.nodeName})).length){for(n=0,o=t.length;n<o;n++)(i=e[l].compareNode(t[n]))!==e[l].NODE_AFTER&&i!==e[l].NODE_INSIDE||(r=e[l].cloneRange(),(s=O.dom.domNode(t[n]).prev({nodeTypes:[1]}))?r.setEnd(s,s.childNodes.length):t[n].closest("ul, ol")?r.setEndBefore(t[n].closest("ul, ol")):r.setEndBefore(t[n]),a.push(r),e[l].setStart(t[n],0)),i!==e[l].NODE_BEFORE&&i!==e[l].NODE_INSIDE||((r=e[l].cloneRange()).setEnd(t[n],t[n].childNodes.length),a.push(r),(s=O.dom.domNode(t[n]).next({nodeTypes:[1]}))?e[l].setStart(s,0):t[n].closest("ul, ol")?e[l].setStartAfter(t[n].closest("ul, ol")):e[l].setStartAfter(t[n]));a.push(e[l])}else a.push(e[l]);return a}(f)).length;m--;)a=f[m],l=t,c=void 0,d=a.startContainer,u=a.endContainer,d&&1===d.nodeType&&d===u?d.firstChild===d.lastChild&&1===a.endOffset&&d!==l.element&&"LI"!==d.nodeName&&"TD"!==d.nodeName&&(a.setStartBefore(d),a.setEndAfter(u)):d&&1===d.nodeType&&3===u.nodeType?d.firstChild===u&&a.endOffset===u.data.length&&d!==l.element&&"LI"!==d.nodeName&&"TD"!==d.nodeName&&a.setEndAfter(d):u&&1===u.nodeType&&3===d.nodeType?u.firstChild===d&&0===a.startOffset&&u!==l.element&&"LI"!==u.nodeName&&"TD"!==u.nodeName&&a.setStartBefore(u):d&&3===d.nodeType&&d===u&&1===d.parentNode.childNodes.length&&a.endOffset==u.data.length&&0===a.startOffset&&(c=d.parentNode)!==l.element&&"LI"!==c.nodeName&&"TD"!==c.nodeName&&(a.setStartBefore(c),a.setEndAfter(c)),r=f[m].startContainer,i=t,void 0,o=(s=O.dom.getParentElement(r,{query:L},null,i.element))?s.nodeName:null,h="remove"===e?h.concat(p(f[m],0,t)):h.concat(g(f[m],n,o,t));return h}function N(e){return"string"==typeof e&&(e={nodeName:e.toUpperCase()}),e}O.commands.formatBlock={exec:function(e,t,n){var o,r,i,s,a=[];if((n=N(n))&&n.toggle&&(r=this.state(e,t,n)),r){o=rangy.saveSelection(e.win);for(var l=0,c=r.length;l<c;l++)u(r[l],n,e)}else e.selection.isCollapsed()&&(o=rangy.saveSelection(e.win),(i=e).selection.isCollapsed()&&(s=i.selection.getNodesNearCaret())&&s.caretNode&&(O.dom.domNode(s.caretNode).is.lineBreak()||3===s.caretNode.nodeType&&0===s.textOffset&&(!s.prevNode||O.dom.domNode(s.prevNode).is.lineBreak())||1===s.caretNode.nodeType&&s.caretNode.classList.contains("rangySelectionBoundary")&&(!s.prevNode||O.dom.domNode(s.prevNode).is.lineBreak()||O.dom.domNode(s.prevNode).is.block())&&(!s.nextNode||O.dom.domNode(s.nextNode).is.lineBreak()||O.dom.domNode(s.nextNode).is.block()))?e.selection.selectLine():m(e,n&&n.nodeName?n.nodeName.toUpperCase():void 0)),a=n?v("apply",e,n):v("remove",e);a=d(e,a),o?rangy.restoreSelection(o):y(a,e)},remove:function(e,t,n){var o,r;n=N(n),e.selection.isCollapsed()&&(r=rangy.saveSelection(e.win),m(e,n&&n.nodeName?n.nodeName.toUpperCase():void 0)),o=d(e,o=v("remove",e)),r?rangy.restoreSelection(r):y(o,e)},state:function(e,t,n){n=N(n);for(var o,r=e.selection.filterElements(function(e){return O.dom.domNode(e).test(n||{query:L})}.bind(this)),i=e.selection.getSelectedOwnNodes(),s=0,a=i.length;s<a;s++)(o=l.getParentElement(i[s],n||{query:L},null,e.element))&&-1===r.indexOf(o)&&r.push(o);return 0!==r.length&&r}}}(wysihtml),function(u){var a="SPAN",r="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",l={b:"b, strong",strong:"b, strong",em:"em, i",i:"em, i"};function c(e){return/^\s*$/.test(e.className)}function d(e){return!e.getAttribute("style")||/^\s*$/.test(e.getAttribute("style"))}function n(e,t){var n,o,r,i;return 1===e.nodeType&&1===t.nodeType&&(e.nodeName===t.nodeName&&(n=e.className.trim().replace(/\s+/g," ").split(" "),o=t.className.trim().replace(/\s+/g," ").split(" "),!(0<u.lang.array(n).without(o).length)&&(r=u.dom.getAttributes(e),i=u.dom.getAttributes(t),!(r.length!==i.length||!u.lang.object(u.lang.object(r).difference(i)).isEmpty()))))}function f(e,t){var n=t&&t.nodeName||a,o=e.ownerDocument.createElement(n);if(t.classRegExp&&(o.className=o.className.replace(t.classRegExp,"")),t.className&&o.classList.add(t.className),t.styleProperty&&void 0!==t.styleValue&&(o.style[u.browser.fixStyleKey(t.styleProperty)]=t.styleValue),t.attribute)if("object"==typeof t.attribute)for(var r in t.attribute)t.attribute.hasOwnProperty(r)&&o.setAttribute(r,t.attribute[r]);else void 0!==t.attributeValue&&o.setAttribute(t.attribute,t.attributeValue);return o}function h(e,t){var n,o,r,i,s;t.className&&(!1!==t.toggle&&e.classList.contains(t.className)?e.classList.remove(t.className):(t.classRegExp&&(e.className=e.className.replace(t.classRegExp,"")),e.classList.add(t.className)),c(e)&&e.removeAttribute("class")),t.styleProperty&&(!1!==t.toggle&&e.style[u.browser.fixStyleKey(t.styleProperty)].trim().replace(/, /g,",")===t.styleValue?e.style[u.browser.fixStyleKey(t.styleProperty)]="":e.style[u.browser.fixStyleKey(t.styleProperty)]=t.styleValue),d(e)&&e.removeAttribute("style"),t.attribute&&("object"==typeof t.attribute?n=t.attribute:(n={})[t.attribute]=t.attributeValue||"",function(e,t,n){var o,r=u.dom.getAttributes(e),i=function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&(void 0===typeof t[n]||t[n]!==e[n]))return!1;return!0}(t,r);if(u.lang.object(r).difference(t),i&&!1!==n)for(o in t)t.hasOwnProperty(o)&&e.removeAttribute(o);else for(o in t)t.hasOwnProperty(o)&&e.setAttribute(o,t[o])}(e,n,t.toggle)),r=!!(o=t.nodeName?l[t.nodeName.toLowerCase()]||t.nodeName.toLowerCase():null)&&u.dom.domNode(e).test({query:o}),t.nodeName&&t.nodeName!==a&&!r||(!1!==t.toggle&&r||!t.nodeName&&e.nodeName===a)&&c(e)&&d(e)&&(i=e,s=u.dom.getAttributes(i),u.lang.object(s).isEmpty())&&u.dom.unwrap(e)}function m(e,t){var n=[];return e.isCollapsed()||(n=n.concat(e.getOwnNodes([3],function(e){return!u.dom.domNode(e).is.emptyTextNode()},t))),n}function p(e,t,n,o){var r,i=e,s=o?t:{nodeName:(r=t).nodeName||null,className:r.classRegExp?null:r.className||null,classRegExp:r.classRegExp||null,styleProperty:r.styleProperty||null};do{if(1===i.nodeType&&g(i,s))return i;i=i.parentNode}while(i&&i!==n);return null}function g(e,t){var n;if(t.nodeName){var o=l[t.nodeName.toLowerCase()]||t.nodeName.toLowerCase();return u.dom.domNode(e).test({query:o})}return(n=u.lang.object(t).clone()).query=r,u.dom.domNode(e).test(n)}function i(e,t){var n=document.documentElement||document.body,o=n.scrollTop,r=n.scrollLeft;rangy.getSelection(e.win);rangy.getSelection(e.win).removeAllRanges();try{rangy.getSelection(e.win).addRange(t)}catch(e){}e.doc.activeElement&&u.dom.contains(e.element,e.doc.activeElement)||(e.element.focus(),n.scrollTop=o,n.scrollLeft=r,rangy.getSelection(e.win).addRange(t))}function o(e,t){var n=rangy.createRange(t.doc),o=e[e.length-1];e[0]&&o&&(n.setStart(e[0],0),n.setEnd(o,o.length),i(t,n))}function s(e,t,n,o){var r=rangy.createRange(e.doc);t&&(r.setStart(t,n),r.setEnd(t,void 0!==o?o:n),i(e,r))}function y(e,t,n){var o,r,i,s=m(e.selection),a=[],l=!1;if(e.selection.isInThisEditable()){if(0===s.length&&e.selection.isCollapsed()){if(!(i=e.selection.getSelection().anchorNode))return{nodes:[],partial:!1};3===i.nodeType&&(s=[i])}s.length||(r=e.selection.getOwnRanges()[0])&&(s=[r.endContainer]);for(var c=0,d=s.length;c<d;c++)(o=p(s[c],t,e.element,n))?a.push(o):l=!0}return{nodes:a,partial:l}}function v(e){var t,n,o,r;return!!(e&&(t=e.anchorNode,n=e.anchorOffset,t&&3===t.nodeType&&0<n&&n<t.data.length))&&(o=t.data[n-1],r=t.data[n],/\w/.test(o)&&/\w/.test(r))}function N(e){var t,n,o,r,i,s;if(e&&(t=e.anchorNode,n=i=s=e.anchorOffset,o=t.ownerDocument,r=rangy.createRange(o),t&&3===t.nodeType)){for(;0<i&&/\w/.test(t.data[i-1]);)i--;for(;s<t.data.length&&/\w/.test(t.data[s]);)s++;return r.setStartAndEnd(t,i,s),r.splitBoundaries(),{wordOffset:n-i,range:r,textNode:r.getNodes([3],function(e){return!u.dom.domNode(e).is.emptyTextNode()})[0]}}return!1}function C(e,t){for(;t.firstChild;)e.appendChild(t.firstChild);t.parentNode.removeChild(t)}function b(e){for(var t=e.length;t--;)e[t]&&e[t].parentNode&&(e[t].nextSibling&&n(e[t],e[t].nextSibling)&&C(e[t],e[t].nextSibling),e[t].previousSibling&&n(e[t],e[t].previousSibling)&&C(e[t].previousSibling,e[t]))}function w(e,t,n){0<t.length&&o(t,e),b(y(e,n).nodes),0<t.length&&o(t,e)}function E(e,t,n,o){s(e,t,n),b(y(e,o).nodes),s(e,t,n)}function S(e,t){var n=f(e,t);e.parentNode.insertBefore(n,e),n.appendChild(e)}function T(e,t,n){var o,r=p(e,n,t.element);r&&(o=r.cloneNode(!1),u.dom.domNode(e).escapeParent(r,o),h(o,n))}function x(e,t,n){var o,r,i,s,a,l,c=e.selection.getSelection();if(t.length){for(r=t.length;r--;)S(t[r],n);w(e,t,n)}else if(v(c))S((o=N(c)).textNode,n),E(e,o.textNode,o.wordOffset,n);else{var d=e.selection.getOwnRanges()[0];d&&(s=e,a=n,l=f((i=d).endContainer,a),i.surroundContents(l),s.selection.selectNode(l))}}function R(e){return(e="string"==typeof e?{nodeName:e}:e).nodeName&&(e.nodeName=e.nodeName.toUpperCase()),e}u.commands.formatInline={exec:function(e,t,n){n=R(n),e.element.normalize();var o=m(e.selection,!0),r=y(e,n);0<r.nodes.length?function(e,t,n,o){var r,i,s,a,l=y(e,o,!0),c=e.selection.getSelection();if(t.length){if(l.partial||!1===o.toggle)for(a=t.length;a--;)p(t[a],o,e.element)&&T(t[a],e,o),p(t[a],o,e.element)||S(t[a],o);else for(a=t.length;a--;)T(t[a],e,o);w(e,t,o)}else if(!1!==o.toggle)if(v(c))i=(r=N(c)).textNode,T(r.textNode,e,o),E(e,r.textNode,r.wordOffset,o);else{i=e.doc.createTextNode(u.INVISIBLE_SPACE),(s=n.nodes[0].cloneNode(!1)).appendChild(i),e.selection.splitElementAtCaret(n.nodes[0],s),h(s,o),w(e,[i],o);var d=e.selection.getSelection();if(d.anchorNode&&d.focusNode)try{d.collapseToEnd()}catch(e){}}else for(a=n.nodes.length;a--;)h(n.nodes[a],o)}(e,o,r,n):x(e,o,n),e.element.normalize()},remove:function(e,t,n){n=R(n),e.element.normalize();var o=m(e.selection,!0),r=y(e,n);0<r.nodes.length&&function(e,t,n,o){var r,i,s,a,l,c=e.selection.getSelection();if(t.length){for(s=t.length;s--;)a=t[s],(l=p(a,o,e.element))&&u.dom.domNode(a).escapeParent(l);w(e,t,o)}else{for(r=c.anchorNode,i=c.anchorOffset,s=n.nodes.length;s--;)u.dom.unwrap(n.nodes[s]);E(e,r,i,o)}}(e,o,r,n),e.element.normalize()},state:function(e,t,n){var o=y(e,n=R(n),!0).nodes;return 0!==o.length&&o}}}(wysihtml),function(l){l.commands.indentList={exec:function(e,t,n){var o=e.selection.getSelectionParentsByTag("LI");return!!o&&this.tryToPushLiLevel(o,e.selection)},state:function(e,t){return!1},tryToPushLiLevel:function(t,e){var n,o,r,i,s,a=!1;return e.executeAndRestoreRangy(function(){for(var e=t.length;e--;)i=t[e],n="OL"===i.parentNode.nodeName?"OL":"UL",o=i.ownerDocument.createElement(n),r=l.dom.domNode(i).prev({nodeTypes:[l.ELEMENT_NODE]}),s=r?r.querySelector("ul, ol"):null,r&&(s?s.appendChild(i):(o.appendChild(i),r.appendChild(o)),a=!0)}),a}}}(wysihtml),wysihtml.commands.insertHTML={exec:function(e,t,n){e.selection.insertHTML(n)},state:function(){return!1}},function(e){var n="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(e,t){e.selection.insertHTML(n)},state:function(){return!1}}}(wysihtml),wysihtml.commands.insertList=function(C){var s=function(e,t){if(e&&e.nodeName){"string"==typeof t&&(t=[t]);for(var n=t.length;n--;)if(e.nodeName===t[n])return!0}return!1},b=function(e,t,n){var o={el:null,other:!1};if(e){var r=C.dom.getParentElement(e,{query:"li"},!1,n.element),i="UL"===t?"OL":"UL";s(e,t)?o.el=e:s(e,i)?o={el:e,other:!0}:r&&(s(r.parentNode,t)?o.el=r.parentNode:s(r.parentNode,i)&&(o={el:r.parentNode,other:!0}))}return o.el&&!n.element.contains(o.el)&&(o.el=null),o},w=function(t,e){for(var n=e.selection.getOwnRanges(),o=[],r=n.length;r--;)o=o.concat(n[r].getNodes([1],function(e){return s(e,t)}));return o};return{exec:function(e,t,n){var o,r,i,s,a,l,c,d,u,f,h,m,p=e.doc,g="OL"===n?"insertOrderedList":"insertUnorderedList",y=e.selection.getSelection(),v=1===y.anchorNode.nodeType&&y.anchorNode.firstChild?y.anchorNode.childNodes[y.anchorOffset]:y.anchorNode,N=1===y.focusNode.nodeType&&y.focusNode.firstChild?y.focusNode.childNodes[y.focusOffset]||y.focusNode.lastChild:y.focusNode;y.isBackwards()&&(v=[N,N=v][0]),C.dom.domNode(N).is.emptyTextNode(!0)&&N&&(N=C.dom.domNode(N).prev({nodeTypes:[1,3],ignoreBlankTexts:!0})),C.dom.domNode(v).is.emptyTextNode(!0)&&v&&(v=C.dom.domNode(v).next({nodeTypes:[1,3],ignoreBlankTexts:!0})),o=v&&N?v===N?v:C.dom.domNode(v).commonAncestor(N,e.element):e.selection.getSelectedNode(),(r=b(o,n,e)).el?r.other?(u=r.el,m="UL"===(f=n)?"OL":"UL",(h=e).selection.executeAndRestoreRangy(function(){for(var e=[u].concat(w(m,h)),t=e.length;t--;)C.dom.renameElement(e[t],f.toLowerCase())})):(i=r.el,d="UL"===(s=n)?"OL":"UL",(a=e).selection.executeAndRestoreRangy(function(){if((l=w(d,a)).length)for(var e=l.length;e--;)C.dom.renameElement(l[e],s.toLowerCase());else{for(var t=(c=w(["OL","UL"],a)).length;t--;)C.dom.resolveList(c[t],a.config.useLineBreaks);0===c.length&&C.dom.resolveList(i,a.config.useLineBreaks)}})):e.commands.support(g)?p.execCommand(g,!1,null):function(e,t){var n,o,r=rangy.saveSelection(t.win),i="_wysihtml-temp-"+(new Date).getTime();t.commands.exec("formatBlock",{nodeName:"div",className:i});var s=t.element.querySelector("."+i);s.innerHTML=s.innerHTML.replace(C.INVISIBLE_SPACE_REG_EXP,""),s&&(n=/^(\s|(<br>))+$/i.test(s.innerHTML),o=C.dom.convertToList(s,e.toLowerCase(),t.parent.config.classNames.uneditableContainer),r&&rangy.restoreSelection(r),n&&t.selection.selectNode(o.querySelector("li"),!0))}(n,e)},state:function(e,t,n){var o=e.selection.getSelectedNode(),r=b(o,n,e);return!(!r.el||r.other)&&r.el}}}(wysihtml),function(u){u.commands.outdentList={exec:function(e,t,n){var o=e.selection.getSelectionParentsByTag("LI");return!!o&&this.tryToPullLiLevel(o,e)},state:function(e,t){return!1},tryToPullLiLevel:function(n,o){var r,i,s,a,l,c=!1,d=this;return o.selection.executeAndRestoreRangy(function(){for(var e=n.length;e--;)if((a=n[e]).parentNode&&("OL"===(r=a.parentNode).tagName||"UL"===r.tagName)){if(c=!0,i=u.dom.getParentElement(r.parentNode,{query:"ol, ul"},!1,o.element),s=u.dom.getParentElement(r.parentNode,{query:"li"},!1,o.element),i&&s)a.nextSibling&&(l=d.getAfterList(r,a),a.appendChild(l)),i.insertBefore(a,s.nextSibling);else{a.nextSibling&&(l=d.getAfterList(r,a),a.appendChild(l));for(var t=a.childNodes.length;t--;)r.parentNode.insertBefore(a.childNodes[t],r.nextSibling);r.parentNode.insertBefore(document.createElement("br"),r.nextSibling),a.parentNode.removeChild(a)}0===r.childNodes.length&&r.parentNode.removeChild(r)}}),c},getAfterList:function(e,t){for(var n=e.nodeName,o=document.createElement(n);t.nextSibling;)o.appendChild(t.nextSibling);return o}}}(wysihtml),wysihtml.commands.redo={exec:function(e){return e.undoManager.redo()},state:function(e){return!1}},function(n){var o={nodeName:"A"};n.commands.removeLink={exec:function(e,t){n.commands.formatInline.remove(e,t,o)},state:function(e,t){return n.commands.formatInline.state(e,t,o)}}}(wysihtml),wysihtml.commands.undo={exec:function(e){return e.undoManager.undo()},state:function(e){return!1}},function(c){var d="data-wysihtml-selection-node",u="data-wysihtml-selection-offset",e=(c.INVISIBLE_SPACE,c.INVISIBLE_SPACE,c.dom);c.UndoManager=c.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var n,r=this;this.composer.sandbox.getDocument();e.observe(this.element,"keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var t=e.keyCode,n=90===t&&!e.shiftKey,o=90===t&&e.shiftKey||89===t;n?(r.undo(),e.preventDefault()):o&&(r.redo(),e.preventDefault())}}),e.observe(this.element,"keydown",function(e){var t=e.keyCode;t!==n&&(8!==(n=t)&&46!==t||r.transact())}),this.editor.on("newword:composer",function(){r.transact()}).on("beforecommand:composer",function(){r.transact()})},transact:function(){var e,t,n,o,r,i=this.historyStr[this.position-1],s=this.composer.getValue(!1,!1),a=0<this.element.offsetWidth&&0<this.element.offsetHeight;if(s!==i){25<(this.historyStr.length=this.historyDom.length=this.position)&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,a&&(t=(e=this.composer.selection.getRange())&&e.startContainer?e.startContainer:this.element,n=e&&e.startOffset?e.startOffset:0,t.nodeType===c.ELEMENT_NODE?o=t:(o=t.parentNode,r=this.getChildNodeIndex(o,t)),o.setAttribute(u,n),void 0!==r&&o.setAttribute(d,r));var l=this.element.cloneNode(!!s);this.historyDom.push(l),this.historyStr.push(s),o&&(o.removeAttribute(u),o.removeAttribute(d))}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return 1<this.position},redoPossible:function(){return this.position<this.historyStr.length},set:function(e){this.element.innerHTML="";for(var t,n,o,r=0,i=e.childNodes,s=e.childNodes.length;r<s;r++)this.element.appendChild(i[r].cloneNode(!0));e.hasAttribute(u)?(t=e.getAttribute(u),o=e.getAttribute(d),n=this.element):(t=(n=this.element.querySelector("["+u+"]")||this.element).getAttribute(u),o=n.getAttribute(d),n.removeAttribute(u),n.removeAttribute(d)),null!==o&&(n=this.getChildNodeByIndex(n,+o)),this.composer.selection.set(n,t)},getChildNodeIndex:function(e,t){for(var n=0,o=e.childNodes,r=o.length;n<r;n++)if(o[n]===t)return n},getChildNodeByIndex:function(e,t){return e.childNodes[t]}})}(wysihtml),wysihtml.views.View=Base.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var t=this;this.parent.on("beforeload",function(){t.parent.on("change_view",function(e){e===t.name?((t.parent.currentView=t).show(),setTimeout(function(){t.focus()},0)):t.hide()})})},focus:function(){if(!this.element||!this.element.ownerDocument||this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element&&this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(l){var c=l.dom,d=l.browser;l.views.Composer=l.views.View.extend({name:"composer",constructor:function(e,t,n){this.base(e,t,n),this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=d.displaysCaretInEmptyContentEditableCorrectly()?"":"<br>"},getValue:function(e,t){var n=this.isEmpty()?"":l.quirks.getCorrectInnerHTML(this.element);return!1!==e&&(n=this.parent.parse(n,!1!==t)),n},setValue:function(t,e){!1!==e&&(t=this.parent.parse(t));try{this.element.innerHTML=t}catch(e){this.element.innerText=t}},cleanUp:function(e){var t;this.selection&&this.selection.isInThisEditable()&&(t=rangy.saveSelection(this.win)),this.parent.parse(this.element,void 0,e),t&&rangy.restoreSelection(t)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=c.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(e){l.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var t=this.element.lastChild;e&&t&&this.selection&&("BR"===t.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getScrollPos:function(){if(this.doc&&this.win){var e={};return void 0!==this.win.pageYOffset?e.y=this.win.pageYOffset:e.y=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollTop,void 0!==this.win.pageXOffset?e.x=this.win.pageXOffset:e.x=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollLeft,e}},setScrollPos:function(e){e&&void 0!==e.x&&void 0!==e.y&&this.win.scrollTo(e.x,e.y)},getTextContent:function(){return c.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var e=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(e)||""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.hasPlaceholderSet()},_initContentEditableArea:function(){var e=this;this.config.noTextarea?this.sandbox=new c.ContentEditableArea(function(){e._create()},{className:this.config.classNames.sandbox},this.editableArea):(this.sandbox=new c.ContentEditableArea(function(){e._create()},{className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getContentEditable(),c.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var e=this;this.sandbox=new c.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets,className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getIframe();var t=this.textarea.element;c.insert(this.editableArea).after(t),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var e=document.createElement("input");e.type="hidden",e.name="_wysihtml_mode",e.value=1,c.insert(e).after(this.textarea.element)}},_create:function(){var e=this;this.doc=this.sandbox.getDocument(),this.win=this.sandbox.getWindow(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new l.Selection(this.parent,this.element,this.config.classNames.uneditableContainer),this.commands=new l.Commands(this.parent),this.config.noTextarea||c.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),this._initAutoLinking(),c.addClass(this.element,this.config.classNames.composer),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var t=this.config.name;t&&(c.addClass(this.element,t),this.config.contentEditableMode||c.addClass(this.editableArea,t)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var n="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");n&&c.simulatePlaceholder(this.parent,this,n,this.config.classNames.placeholder),this.commands.exec("styleWithCSS",!1),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||d.isIos()||setTimeout(function(){e.focus(!0)},100),d.clearsContentEditableCorrectly()||l.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var r=this,e=d.canDisableAutoLinking(),t=d.doesAutoLinkingInContentEditable();if(e&&this.commands.exec("AutoUrlDetect",!1,!1),this.config.autoLink){(!t||t&&e)&&(this.parent.on("newword:composer",function(){if(c.getTextContent(r.element).match(c.autoLink.URL_REG_EXP)){for(var e=r.selection.getSelectedNode(),t=r.element.querySelectorAll("."+r.config.classNames.uneditableContainer),n=!1,o=t.length;o--;)l.dom.contains(t[o],e)&&(n=!0);n||c.autoLink(e,[r.config.classNames.uneditableContainer])}}),c.observe(this.element,"blur",function(){c.autoLink(r.element,[r.config.classNames.uneditableContainer])}));var i=this.sandbox.getDocument().getElementsByTagName("a"),s=c.autoLink.URL_REG_EXP,a=function(e){var t=l.lang.string(c.getTextContent(e)).trim();return"www."===t.substr(0,4)&&(t="http://"+t),t};c.observe(this.element,"keydown",function(e){if(i.length){var t,n=r.selection.getSelectedNode(e.target.ownerDocument),o=c.getParentElement(n,{query:"a"},4);o&&(t=a(o),setTimeout(function(){var e=a(o);e!==t&&e.match(s)&&o.setAttribute("href",e)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),d.supportsEvent("resizeend")){var i=["width","height"],s=i.length,a=this.element;c.observe(a,"resizeend",function(e){var t,n=e.target||e.srcElement,o=n.style,r=0;if("IMG"===n.nodeName){for(;r<s;r++)o[t=i[r]]&&(n.setAttribute(t,parseInt(o[t],10)),o[t]="");l.quirks.redraw(a)}})}},_initUndoManager:function(){this.undoManager=new l.UndoManager(this.parent)},_initLineBreaking:function(){var o=this;function r(e){var t=c.getParentElement(e,{query:"p, div"},2);t&&c.contains(o.element,t)&&o.selection.executeAndRestoreRangy(function(){o.config.useLineBreaks?((!t.firstChild||t.firstChild===t.lastChild&&1===t.firstChild.nodeType&&t.firstChild.classList.contains("rangySelectionBoundary"))&&t.appendChild(o.doc.createElement("br")),c.replaceWithChildNodes(t)):"P"!==t.nodeName&&c.renameElement(t,"p")})}this.config.useLineBreaks||c.observe(this.element,["focus"],function(){o.isEmpty()&&setTimeout(function(){var e=o.doc.createElement("P");o.element.innerHTML="",o.element.appendChild(e),d.displaysCaretInEmptyContentEditableCorrectly()?o.selection.selectNode(e,!0):(e.innerHTML="<br>",o.selection.setBefore(e.firstChild))},0)}),c.observe(this.element,"keydown",function(e){var t=e.keyCode;if(!(e.shiftKey||e.ctrlKey||e.defaultPrevented||t!==l.ENTER_KEY&&t!==l.BACKSPACE_KEY)){var n=c.getParentElement(o.selection.getSelectedNode(),{query:"li, p, h1, h2, h3, h4, h5, h6"},4);n?setTimeout(function(){var e=o.selection.getSelectedNode();if("LI"===n.nodeName){if(!e)return;c.getParentElement(e,{query:"ul, ol, menu"},2)||r(e)}t===l.ENTER_KEY&&n.nodeName.match(/^H[1-6]$/)&&r(e)},0):o.config.useLineBreaks&&t===l.ENTER_KEY&&!l.browser.insertsLineBreaksOnReturn()&&(e.preventDefault(),o.commands.exec("insertLineBreak"))}})}})}(wysihtml),function(c){var d=c.dom,u=document,i=window,f=u.createElement("div"),h=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],m=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],p=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml-temp     { display: none; }",c.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],g=function(e){if(e.setActive)try{e.setActive()}catch(e){}else{var t=e.style,n=u.documentElement.scrollTop||u.body.scrollTop,o=u.documentElement.scrollLeft||u.body.scrollLeft,r={position:t.position,top:t.top,left:t.left,WebkitUserSelect:t.WebkitUserSelect};d.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),d.setStyles(r).on(e),i.scrollTo&&i.scrollTo(o,n)}};c.views.Composer.prototype.style=function(){var e,t=this,n=u.querySelector(":focus"),o=this.textarea.element,r=o.hasAttribute("placeholder"),i=r&&o.getAttribute("placeholder"),s=o.style.display,a=o.disabled;this.focusStylesHost=f.cloneNode(!1),this.blurStylesHost=f.cloneNode(!1),this.disabledStylesHost=f.cloneNode(!1),r&&o.removeAttribute("placeholder"),o===n&&o.blur(),o.disabled=!1,o.style.display=e="none",(o.getAttribute("rows")&&"auto"===d.getStyle("height").from(o)||o.getAttribute("cols")&&"auto"===d.getStyle("width").from(o))&&(o.style.display=e=s),d.copyStyles(m).from(o).to(this.editableArea).andTo(this.blurStylesHost),d.copyStyles(h).from(o).to(this.element).andTo(this.blurStylesHost),d.insertCSS(p).into(this.element.ownerDocument),o.disabled=!0,d.copyStyles(m).from(o).to(this.disabledStylesHost),d.copyStyles(h).from(o).to(this.disabledStylesHost),o.disabled=a,o.style.display=s,g(o),o.style.display=e,d.copyStyles(m).from(o).to(this.focusStylesHost),d.copyStyles(h).from(o).to(this.focusStylesHost),o.style.display=s,d.copyStyles(["display"]).from(o).to(this.editableArea);var l=c.lang.array(m).without(["display"]);return n?g(n):o.blur(),r&&o.setAttribute("placeholder",i),this.parent.on("focus:composer",function(){d.copyStyles(l).from(t.focusStylesHost).to(t.editableArea),d.copyStyles(h).from(t.focusStylesHost).to(t.element)}),this.parent.on("blur:composer",function(){d.copyStyles(l).from(t.blurStylesHost).to(t.editableArea),d.copyStyles(h).from(t.blurStylesHost).to(t.element)}),this.parent.observe("disable:composer",function(){d.copyStyles(l).from(t.disabledStylesHost).to(t.editableArea),d.copyStyles(h).from(t.disabledStylesHost).to(t.element)}),this.parent.observe("enable:composer",function(){d.copyStyles(l).from(t.blurStylesHost).to(t.editableArea),d.copyStyles(h).from(t.blurStylesHost).to(t.element)}),this}}(wysihtml),function(l){var c=l.dom,d=c.domNode,i=l.browser,s={66:"bold",73:"italic",85:"underline"},a={addListeners:function(e,t,n){for(var o=0,r=t.length;o<r;o++)e.addEventListener(t[o],n,!1)},removeListeners:function(e,t,n){for(var o=0,r=t.length;o<r;o++)e.removeEventListener(t[o],n,!1)},fixLastBrDeletionInTable:function(e,t){if(e.selection.caretIsInTheEndOfNode()){var n=e.selection.getSelection(),o=n.anchorNode;if(o&&1===o.nodeType&&(l.dom.getParentElement(o,{query:"td, th"},!1,e.element)||t)){var r=o.childNodes[n.anchorOffset];if(r&&1===r.nodeType&"BR"===r.nodeName)return r.parentNode.removeChild(r),!0}}return!1},handleUneditableDeletion:function(e){var t=e.selection.getBeforeSelection(!0);if(t&&("element"===t.type||"leafnode"===t.type)&&1===t.node.nodeType&&t.node.classList.contains(e.config.classNames.uneditableContainer)){if(a.fixLastBrDeletionInTable(e,!0))return!0;try{var n=new CustomEvent("wysihtml:uneditable:delete",{bubbles:!0,cancelable:!1});t.node.dispatchEvent(n)}catch(e){}return t.node.parentNode.removeChild(t.node),!0}return!1},fixDeleteInTheBeginningOfBlock:function(e){var t=e.selection,n=t.getPreviousNode();if(t.caretIsFirstInSelection(l.browser.usesControlRanges())&&n&&1===n.nodeType&&l.dom.domNode(n).is.block()&&!d(n).test({query:"ol, ul, table, tr, dl"})){if(/^\s*$/.test(n.textContent||n.innerText))return n.parentNode.removeChild(n),!0;if(n.lastChild){var o=n.lastChild,r=t.getSelectedNode(),i=d(n).commonAncestor(r,e.element),s=l.dom.getParentElement(r,{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},!1,i||e.element);if(s)return d(s).transferContentTo(n,!0),t.setAfter(o),!0;if(l.browser.usesControlRanges())return r=t.getCaretNode(),d(r).transferContentTo(n,!0),t.setAfter(o),!0}}return!1},fixDeleteInTheBeginningOfLi:function(e){if(l.browser.hasLiDeletingProblem()){var t,n,o,r=e.selection.getSelection(),i=r.anchorNode,s=e.selection.caretIsFirstInSelection();if(3===i.nodeType&&0===r.anchorOffset&&i===i.parentNode.firstChild&&(i=i.parentNode,s=!0),s&&i&&1===i.nodeType&&"LI"===i.nodeName&&((n=d(i).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}))||!i.parentNode||"UL"!==i.parentNode.nodeName&&"OL"!==i.parentNode.nodeName||(n=d(i.parentNode).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),o=i.parentNode),n))return t=i.firstChild,d(i).transferContentTo(n,!0),o&&0===o.children.length&&o.remove(),t?e.selection.setBefore(t):n&&(1===n.nodeType?n.lastChild?e.selection.setAfter(n.lastChild):e.selection.selectNode(n):e.selection.setAfter(n)),!0}return!1},fixDeleteInTheBeginningOfControlSelection:function(e){var t,n=e.selection,o=n.getPreviousNode(),r=n.getSelectedNode();return!!n.caretIsFirstInSelection()&&(3===r.nodeType&&(r=r.parentNode),t=r.firstChild,d(r).transferContentTo(o,!0),t&&e.selection.setBefore(t),!0)},doLineBreaksModeEnterWithCaret:function(e){var t,n,o=!1;if((t=e.selection.getNodesNearCaret())&&((t.caretNode||t.nextNode)&&(n=c.getParentElement(t.caretNode||t.nextNode,{query:"p, pre, div, blockquote"},2))===e.element&&(n=void 0),n&&t.caretNode))if(d(t.caretNode).is.lineBreak()){if(e.config.doubleLineBreakEscapesBlock){o=!0,t.caretNode.parentNode.removeChild(t.caretNode),d(t.nextNode).is.lineBreak()&&t.nextNode.parentNode.removeChild(t.nextNode);var r=e.doc.createElement("br");d(t.nextNode).is.lineBreak()&&t.nextNode===n.lastChild?n.parentNode.insertBefore(r,n.nextSibling):e.selection.splitElementAtCaret(n,r),t.nextNode&&3===t.nextNode.nodeType&&(t.nextNode.data=t.nextNode.data.replace(/^ *[\r\n]+/,"")),e.selection.setBefore(r)}}else if(3===t.caretNode.nodeType&&l.browser.hasCaretBlockElementIssue()&&t.textOffset===t.caretNode.data.length&&!t.nextNode){o=!0;var i=e.doc.createElement("br"),s=e.doc.createElement("br"),a=e.doc.createDocumentFragment();a.appendChild(i),a.appendChild(s),e.selection.insertNode(a),e.selection.setBefore(s)}return o}},n=function(e){this.domNodeRemovedInterval&&clearInterval(domNodeRemovedInterval),this.parent.fire("destroy:composer")},o=function(e){var t,n=e.keyCode,o=s[n],r=this.selection.getSelectedNode(!0);r&&3===r.nodeType&&r.parentNode;if((e.ctrlKey||e.metaKey)&&!e.altKey&&65===n)return this.selection.selectAll(),void e.preventDefault();(e.ctrlKey||e.metaKey)&&!e.altKey&&o&&(this.commands.exec(o),e.preventDefault()),n===l.BACKSPACE_KEY&&function(e,t){var n=t.selection;t.element;if(n.isCollapsed()){if(t.isEmpty()&&!t.config.useLineBreaks)return e.preventDefault();if(a.handleUneditableDeletion(t))return e.preventDefault();if(a.fixDeleteInTheBeginningOfLi(t))return e.preventDefault();if(a.fixDeleteInTheBeginningOfBlock(t))return e.preventDefault();if(a.fixLastBrDeletionInTable(t))return e.preventDefault();if(l.browser.usesControlRanges()&&a.fixDeleteInTheBeginningOfControlSelection(t))e.preventDefault()}else n.containsUneditable()&&(e.preventDefault(),n.deleteContents())}(e,this),n!==l.BACKSPACE_KEY&&n!==l.DELETE_KEY||r&&"IMG"===r.nodeName&&(e.preventDefault(),(t=r.parentNode).removeChild(r),"A"!==t.nodeName||t.firstChild||t.parentNode.removeChild(t),setTimeout(function(){l.quirks.redraw(this.element)}.bind(this),0)),this.config.handleTabKey&&n===l.TAB_KEY&&(e.preventDefault(),function(e,t,n){if(e.selection.isCollapsed()){if(e.selection.caretIsInTheBeginnig("li"))if(n){if(e.commands.exec("outdentList"))return}else if(e.commands.exec("indentList"))return}else e.selection.deleteContents();e.commands.exec("insertHTML","&emsp;")}(this,this.element,e.shiftKey)),n===l.ENTER_KEY&&function(e,t){!t.config.useLineBreaks||e.shiftKey||e.ctrlKey||t.selection.isCollapsed()&&a.doLineBreaksModeEnterWithCaret(t)&&e.preventDefault();if(i.hasCaretAtLinkEndInsertionProblems()&&t.selection.caretIsInTheEndOfNode()){var n=t.selection.getSelectedNode(!0),o=n&&3===n.nodeType?n.parentNode:n;o&&o.closest("a")&&3===n.nodeType&&n===o.lastChild&&t.selection.setAfter(o)}}(e,this)};l.views.Composer.prototype.observeActions=a,l.views.Composer.prototype.observe=function(){var e=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),t=(this.element,i.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?this.element:this.sandbox.getWindow());this.focusState=this.getValue(!1,!1),this.actions=a,e.addEventListener(["DOMNodeRemoved"],n.bind(this),!1),i.supportsMutationEvents()||(this.domNodeRemovedInterval=setInterval(function(){c.contains(document.documentElement,e)||n.call(this)},250)),a.addListeners(t,["drop","paste","mouseup","focus","keyup"],function(e){this.parent.fire("beforeinteraction",e).fire("beforeinteraction:composer",e),setTimeout(function(){this.parent.fire("interaction",e).fire("interaction:composer",e)}.bind(this),0)}.bind(this)),t.addEventListener("focus",function(e){this.parent.fire("focus",e).fire("focus:composer",e),setTimeout(function(){this.focusState=this.getValue(!1,!1)}.bind(this),0)}.bind(this),!1),t.addEventListener("blur",function(e){if(this.focusState!==this.getValue(!1,!1)){var t=e;"function"==typeof Object.create&&(t=Object.create(e,{type:{value:"change"}})),this.parent.fire("change",t).fire("change:composer",t)}this.parent.fire("blur",e).fire("blur:composer",e)}.bind(this),!1),a.addListeners(this.element,["drop","paste","beforepaste"],function(e){this.parent.fire(e.type,e).fire(e.type+":composer",e),"paste"===e.type&&setTimeout(function(){this.parent.fire("newword:composer")}.bind(this),0)}.bind(this),!1),this.element.addEventListener("copy",function(e){this.config.copyedFromMarking&&(l.browser.supportsModernPaste()&&(e.clipboardData.setData("text/html",this.config.copyedFromMarking+this.selection.getHtml()),e.clipboardData.setData("text/plain",this.selection.getPlainText()),e.preventDefault()),this.parent.fire(e.type,e).fire(e.type+":composer",e))}.bind(this),!1),this.element.addEventListener("mousedown",function(e){if(!i.canSelectImagesInContentEditable()){var t=e.target,n=this.element.querySelectorAll("img"),o=this.element.querySelectorAll("."+this.config.classNames.uneditableContainer+" img"),r=l.lang.array(n).without(o);"IMG"===t.nodeName&&l.lang.array(r).contains(t)&&this.selection.selectNode(t)}l.browser.usesControlRanges()&&(this.selection.lastMouseDownPos={x:e.clientX,y:e.clientY},setTimeout(function(){delete this.selection.lastMouseDownPos}.bind(this),0))}.bind(this),!1),this.element.addEventListener("click",function(e){if(this.config.classNames.uneditableContainer){var t=l.dom.getParentElement(e.target,{query:"."+this.config.classNames.uneditableContainer},!1,this.element);t&&this.selection.setAfter(t)}}.bind(this),!1),this.element.addEventListener("drop",function(e){i.canSelectImagesInContentEditable()||setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)}.bind(this),!1),this.element.addEventListener("keyup",function(e){var t=e.keyCode;t!==l.SPACE_KEY&&t!==l.ENTER_KEY||this.parent.fire("newword:composer")}.bind(this),!1),this.element.addEventListener("keydown",o.bind(this),!1),this.element.addEventListener("keypress",function(e){if(0!==e.which&&this.selection.caretIsInTheEndOfNode()){var t,n,o=this.selection.getSelectedNode(!0),r=o&&3===o.nodeType?o.parentNode:o;r&&r.closest("a")&&o===r.lastChild&&(32!==e.which||this.selection.caretIsInTheEndOfNode(!0)&&i.hasCaretAtLinkEndInsertionProblems()?(t=this.doc.createTextNode(l.INVISIBLE_SPACE),this.selection.insertNode(t),this.selection.setBefore(t),setTimeout(function(){1<t.textContent.length?(t.textContent=t.textContent.replace(l.INVISIBLE_SPACE_REG_EXP,""),this.selection.setAfter(t)):t.remove()}.bind(this),0)):32===e.which&&3===o.nodeType&&/[\u00A0 ]$/.test(o.textContent)&&(o.textContent=o.textContent.replace(/[\u00A0 ]$/,""),n=this.doc.createTextNode(" "),r.parentNode.insertBefore(n,r.nextSibling),this.selection.setAfter(n,!1),e.preventDefault()))}}.bind(this),!1),l.browser.usesControlRanges()&&this.element.addEventListener("mscontrolselect",function(e){e.target;var t=this.selection.lastMouseDownPos;if(t){var n=document.body.createTextRange();setTimeout(function(){try{n.moveToPoint(t.x,t.y),n.select()}catch(e){}}.bind(this),0)}}.bind(this),!1),this.element.addEventListener("dragenter",function(){this.parent.fire("unset_placeholder")}.bind(this),!1)}}(wysihtml),function(i){i.views.Synchronizer=Base.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(e){this.textarea.setValue(i.lang.string(this.composer.getValue(!1,!1)).trim(),e)},fromTextareaToComposer:function(e){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var t,n=this,e=this.textarea.element.form,o=function(){t=setInterval(function(){n.fromComposerToTextarea()},400)},r=function(){clearInterval(t),t=null};o(),e&&(i.dom.observe(e,"submit",function(){n.sync(!0)}),i.dom.observe(e,"reset",function(){setTimeout(function(){n.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(e){"composer"!==e||t?"textarea"===e&&(n.fromComposerToTextarea(!0),r()):(n.fromTextareaToComposer(!0),o())}),this.editor.on("destroy:composer",r)}})}(wysihtml),wysihtml.views.SourceView=Base.extend({constructor:function(e,t){this.editor=e,this.composer=t,this._observe()},switchToTextarea:function(e){var t=this.composer.win.getComputedStyle(this.composer.element),n=parseFloat(t.width),o=Math.max(parseFloat(t.height),100);this.textarea||(this.textarea=this.composer.doc.createElement("textarea"),this.textarea.className="wysihtml-source-view"),this.textarea.style.width=n+"px",this.textarea.style.height=o+"px",this.textarea.value=this.editor.getValue(e,!0),this.composer.element.parentNode.insertBefore(this.textarea,this.composer.element),this.editor.currentView="source",this.composer.element.style.display="none"},switchToComposer:function(e){var t=this.textarea.value;t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder")),this.textarea.parentNode.removeChild(this.textarea),this.editor.currentView=this.composer,this.composer.element.style.display=""},_observe:function(){this.editor.on("change_view",function(e){"composer"===e?this.switchToComposer(!0):"textarea"===e&&this.switchToTextarea(!0)}.bind(this))}}),wysihtml.views.Textarea=wysihtml.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return!1!==e&&(t=this.parent.parse(t)),t},setValue:function(e,t){!1!==t&&(e=this.parent.parse(e)),this.element.value=e},cleanUp:function(e){var t=this.parent.parse(this.element.value,void 0,e);this.element.value=t},hasPlaceholderSet:function(){var e=wysihtml.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,n=this.element.value;return e&&!n||n===t},isEmpty:function(){return!wysihtml.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,n=this.parent,o={focusin:"focus",focusout:"blur"},t=wysihtml.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];n.on("beforeload",function(){wysihtml.dom.observe(e,t,function(e){var t=o[e.type]||e.type;n.fire(t).fire(t+":textarea")}),wysihtml.dom.observe(e,["paste","drop"],function(){setTimeout(function(){n.fire("paste").fire("paste:textarea")},0)})})}}),function(i){i.Editor=i.lang.Dispatcher.extend({defaults:{name:void 0,style:!0,autoLink:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{},b:{},i:{},u:{}},classes:{}},pasteParserRulesets:null,parser:i.dom.parse,useLineBreaks:!0,doubleLineBreakEscapesBlock:!0,stylesheets:[],placeholderText:void 0,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,classNames:{composer:"wysihtml-editor",body:"wysihtml-supported",sandbox:"wysihtml-sandbox",placeholder:"wysihtml-placeholder",uneditableContainer:"wysihtml-uneditable-container"},copyedFromMarking:'<meta name="copied-from" content="wysihtml">'},constructor:function(e,t){if(this.editableElement="string"==typeof e?document.getElementById(e):e,this.config=i.lang.object({}).merge(this.defaults).merge(t).get(),this._isCompatible=i.browser.supported(),t&&t.classNames&&i.lang.object(this.config.classNames).merge(t.classNames),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new i.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&i.browser.isTouchDevice()){var n=this;setTimeout(function(){n.fire("beforeload").fire("load")},0)}else i.dom.addClass(document.body,this.config.classNames.body),this.composer=new i.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea?this.sourceView=new i.views.SourceView(this,this.composer):this.synchronizer=new i.views.Synchronizer(this,this.textarea,this.composer),this.runEditorExtenders()},runEditorExtenders:function(){i.editorExtenders.forEach(function(e){e(this)}.bind(this))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e,t){return this.currentView.getValue(e,t)},setValue:function(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},cleanUp:function(e){this.currentView.cleanUp(e)},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},destroy:function(){this.composer&&this.composer.sandbox&&this.composer.sandbox.destroy(),this.fire("destroy:composer"),this.off()},parse:function(e,t,n){var o=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,r=this.config.parser(e,{rules:n||this.config.parserRules,cleanUp:this.config.cleanUp,context:o,uneditableClass:this.config.classNames.uneditableContainer,clearInternals:t});return"object"==typeof e&&i.quirks.redraw(e),r},_initParser:function(){var t;i.browser.supportsModernPaste()?this.on("paste:composer",function(e){e.preventDefault(),(t=i.dom.getPastedHtml(e))&&this._cleanAndPaste(t)}.bind(this)):this.on("beforepaste:composer",function(e){e.preventDefault();var t=this.composer.getScrollPos();i.dom.getPastedHtmlWithDiv(this.composer,function(e){e&&this._cleanAndPaste(e),this.composer.setScrollPos(t)}.bind(this))}.bind(this))},_cleanAndPaste:function(e){var t=i.quirks.cleanPastedHTML(e,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.classNames.uneditableContainer});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(t)}})}(wysihtml);
//# sourceMappingURL=wysihtml.min.js.map