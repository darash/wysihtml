!function(c){c.dom;var d="[data-wysihtml-dialog-field]",h="data-wysihtml-dialog-field";c.toolbar.Dialog_bgColorStyle=c.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var e={},t=this.container.querySelectorAll(d),o=t.length,i=0;i<o;i++)e[t[i].getAttribute(h)]=t[i].value;return e},_interpolate:function(e){for(var t,o=document.querySelector(":focus"),i=this.container.querySelectorAll(d),n=i.length,a=0,l=this.elementToChange?c.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,s=l?l.getAttribute("style"):null,r=s?c.quirks.styleParser.parseColor(s,"background-color"):null;a<n;a++)(t=i[a])!==o&&(e&&"hidden"===t.type||"color"===t.getAttribute(h)&&(r?r[3]&&1!=r[3]?t.value="rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+");":t.value="rgb("+r[0]+","+r[1]+","+r[2]+");":t.value="rgb(0,0,0);"))}})}(wysihtml),function(e){e.toolbar.Dialog_createTable=e.toolbar.Dialog.extend({show:function(e){this.base(e)}})}(wysihtml),function(l){l.dom;l.toolbar.Dialog_fontSizeStyle=l.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml-dialog-field="size"]').value}},_interpolate:function(e){var t=document.querySelector(":focus"),o=this.container.querySelector("[data-wysihtml-dialog-field='size']"),i=this.elementToChange?l.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,n=i?i.getAttribute("style"):null,a=n?l.quirks.styleParser.parseFontSize(n):null;o&&o!==t&&a&&!/^\s*$/.test(a)&&(o.value=a)}})}(wysihtml),function(h){var u="[data-wysihtml-dialog-field]",m="data-wysihtml-dialog-field";h.toolbar.Dialog_foreColorStyle=h.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var e={},t=this.container.querySelectorAll(u),o=t.length,i=0;i<o;i++)e[t[i].getAttribute(m)]=t[i].value;return e},_interpolate:function(e){for(var t,o,i=h.quirks.styleParser,n=document.querySelector(":focus"),a=this.container.querySelectorAll(u),l=a.length,s=0,r=this.elementToChange?h.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,c=r?r.getAttribute("style"):null,d=c?i.parseColor(c,"color"):null;s<l;s++)(t=a[s])!==n&&(e&&"hidden"===t.type||"color"===t.getAttribute(m)&&(o="hex"===(o=(t.dataset.colormode||"rgb").toLowerCase())?"hash":o,t.value=d?i.unparseColor(d,o):i.unparseColor([0,0,0],o)))}})}(wysihtml),function(n){var a=n.dom,l="wysihtml-command-dialog-opened",r="[data-wysihtml-dialog-field]",c="data-wysihtml-dialog-field";n.toolbar.Dialog=n.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){if(!this._observed){var o=this,i=function(e){var t=o._serialize();o.fire("save",t),o.hide(),e.preventDefault(),e.stopPropagation()};a.observe(o.link,"click",function(){a.hasClass(o.link,l)&&setTimeout(function(){o.hide()},0)}),a.observe(this.container,"keydown",function(e){var t=e.keyCode;t===n.ENTER_KEY&&i(e),t===n.ESCAPE_KEY&&o.cancel()}),a.delegate(this.container,"[data-wysihtml-dialog-action=save]","click",i),a.delegate(this.container,"[data-wysihtml-dialog-action=cancel]","click",function(e){o.cancel(),e.preventDefault(),e.stopPropagation()}),this._observed=!0}},_serialize:function(){for(var e={},t=this.container.querySelectorAll(r),o=t.length,i=0;i<o;i++)e[t[i].getAttribute(c)]=t[i].value;return e},_interpolate:function(e){for(var t,o,i,n=document.querySelector(":focus"),a=this.container.querySelectorAll(r),l=a.length,s=0;s<l;s++)(t=a[s])!==n&&(e&&"hidden"===t.type||(o=t.getAttribute(c),i=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(o)||"":t.defaultValue,t.value=i))},update:function(e){this.elementToChange=e||this.elementToChange,this._interpolate()},show:function(e){var t=this.container.querySelector("input, select, textarea");if(this._observe(),this.update(e),a.addClass(this.link,l),this.container.style.display="",this.isOpen=!0,this.fire("show"),t&&!e)try{t.focus()}catch(e){}},_hide:function(e){this.elementToChange=null,a.removeClass(this.link,l),this.container.style.display="none",this.isOpen=!1},hide:function(){this._hide(),this.fire("hide")},cancel:function(){this._hide(),this.fire("cancel")}})}(wysihtml),function(l){var s=l.dom,r={position:"relative"},c={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},d={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},h={"x-webkit-speech":"",speech:""};l.toolbar.Speech=function(e,t){var o=document.createElement("input");if(l.browser.supportsSpeechApiOn(o)){var i=e.editor.textarea.element.getAttribute("lang");i&&(h.lang=i);var n=document.createElement("div");l.lang.object(c).merge({width:t.offsetWidth+"px",height:t.offsetHeight+"px"}),s.insert(o).into(n),s.insert(n).into(t),s.setStyles(d).on(o),s.setAttributes(h).on(o),s.setStyles(c).on(n),s.setStyles(r).on(t);var a="onwebkitspeechchange"in o?"webkitspeechchange":"speechchange";s.observe(o,a,function(){e.execCommand("insertText",o.value),o.value=""}),s.observe(o,"click",function(e){s.hasClass(t,"wysihtml-command-disabled")&&e.preventDefault(),e.stopPropagation()})}else t.style.display="none"}}(wysihtml),function(h){var r="wysihtml-command-disabled",l="wysihtml-commands-disabled",c="wysihtml-command-active",d="wysihtml-action-active",u=h.dom;function m(e,t){var o=e.commands.state(t.name,t.value);return!t.dialog.multiselect&&h.lang.object(o).isArray()&&(o=1!==o.length||o[0]),o}h.toolbar.Toolbar=Base.extend({constructor:function(e,t,o){this.editor=e,this.container="string"==typeof t?document.getElementById(t):t,this.composer=e.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),o&&this.show(),null!=e.config.classNameCommandDisabled&&(r=e.config.classNameCommandDisabled),null!=e.config.classNameCommandsDisabled&&(l=e.config.classNameCommandsDisabled),null!=e.config.classNameCommandActive&&(c=e.config.classNameCommandActive),null!=e.config.classNameActionActive&&(d=e.config.classNameActionActive);for(var i=this.container.querySelectorAll("[data-wysihtml-command=insertSpeech]"),n=i.length,a=0;a<n;a++)new h.toolbar.Speech(this,i[a])},_getLinks:function(e){for(var t,o,i,n,a,l,s=this[e+"Links"]=h.lang.array(this.container.querySelectorAll("[data-wysihtml-"+e+"]")).get(),r=s.length,c=0,d=this[e+"Mapping"]={};c<r;c++)i=(t=s[c]).getAttribute("data-wysihtml-"+e),n=t.getAttribute("data-wysihtml-"+e+"-value"),l=t.getAttribute("data-wysihtml-"+e+"-blank-value"),o=this.container.querySelector("[data-wysihtml-"+e+"-group='"+i+"']"),a=this._getDialog(t,i),d[i+":"+n]={link:t,group:o,name:i,value:n,tracksBlankValue:l,dialog:a,state:!1}},_getDialog:function(t,o){var e,i,n=this,a=this.container.querySelector("[data-wysihtml-dialog='"+o+"']");return a&&((e=h.toolbar["Dialog_"+o]?new h.toolbar["Dialog_"+o](t,a):new h.toolbar.Dialog(t,a)).on("show",function(){i=n.composer.selection.getBookmark(),n.editor.fire("show:dialog",{command:o,dialogContainer:a,commandLink:t})}),e.on("save",function(e){i&&n.composer.selection.setBookmark(i),n._execCommand(o,e),n.editor.fire("save:dialog",{command:o,dialogContainer:a,commandLink:t}),n._hideAllDialogs(),n._preventInstantFocus(),i=void 0}),e.on("cancel",function(){i&&n.composer.selection.setBookmark(i),n.editor.fire("cancel:dialog",{command:o,dialogContainer:a,commandLink:t}),i=void 0,n._preventInstantFocus()}),e.on("hide",function(){n.editor.fire("hide:dialog",{command:o,dialogContainer:a,commandLink:t}),i=void 0})),e},execCommand:function(e,t){this.commandsDisabled||this._execCommand(e,t)},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;"change_view"===e&&(t.currentView===t.textarea||"source"===t.currentView?t.fire("change_view","composer"):t.fire("change_view","textarea")),"showSource"==e&&t.fire("showSource")},_observe:function(){for(var a=this,e=this.editor,t=this.container,o=this.commandLinks.concat(this.actionLinks),i=o.length,n=0;n<i;n++)"A"===o[n].nodeName?u.setAttributes({href:"javascript:;",unselectable:"on"}).on(o[n]):u.setAttributes({unselectable:"on"}).on(o[n]);u.delegate(t,"[data-wysihtml-command], [data-wysihtml-action]","mousedown",function(e){e.preventDefault()}),u.delegate(t,"[data-wysihtml-command]","click",function(e){var t,o=this.getAttribute("data-wysihtml-command"),i=this.getAttribute("data-wysihtml-command-value"),n=a.commandMapping[o+":"+i];i||!n.dialog?a.execCommand(o,i):(t=m(a.composer,n),n.dialog.show(t)),e.preventDefault()}),u.delegate(t,"[data-wysihtml-action]","click",function(e){var t=this.getAttribute("data-wysihtml-action");a.execAction(t),e.preventDefault()}),e.on("interaction:composer",function(e){a.preventFocus||a._updateLinkStates()}),this._ownerDocumentClick=function(e){h.dom.contains(a.container,e.target)||h.dom.contains(a.composer.element,e.target)||(a._updateLinkStates(),a._preventInstantFocus())},this.container.ownerDocument.addEventListener("click",this._ownerDocumentClick,!1),this.editor.on("destroy:composer",this.destroy.bind(this)),this.editor.config.handleTables&&(e.on("tableselect:composer",function(){a.container.querySelectorAll('[data-wysihtml-hiddentools="table"]')[0].style.display=""}),e.on("tableunselect:composer",function(){a.container.querySelectorAll('[data-wysihtml-hiddentools="table"]')[0].style.display="none"})),e.on("change_view",function(e){setTimeout(function(){a.commandsDisabled="composer"!==e,a._updateLinkStates(),a.commandsDisabled?u.addClass(t,l):u.removeClass(t,l)},0)})},destroy:function(){this.container.ownerDocument.removeEventListener("click",this._ownerDocumentClick,!1)},_hideAllDialogs:function(){var e=this.commandMapping;for(var t in e)e[t].dialog&&e[t].dialog.hide()},_preventInstantFocus:function(){this.preventFocus=!0,setTimeout(function(){this.preventFocus=!1}.bind(this),0)},_updateLinkStates:function(){var e,t,o,i,n,a=this.commandMapping,l=this.composer,s=this.actionMapping;for(e in a)i=a[e],this.commandsDisabled?(t=!1,u.removeClass(i.link,c),i.group&&u.removeClass(i.group,c),i.dialog&&i.dialog.hide()):(t=this.composer.commands.state(i.name,i.value),u.removeClass(i.link,r),i.group&&u.removeClass(i.group,r)),(i.state!==t||i.tracksBlankValue)&&((i.state=t)?i.tracksBlankValue?u.removeClass(i.link,c):(u.addClass(i.link,c),i.group&&u.addClass(i.group,c),!i.dialog||void 0!==i.value&&null!==i.value||(t&&"object"==typeof t?(t=m(l,i),i.state=t,n=!!i.dialog.container.dataset&&i.dialog.container.dataset.showdialogonselection,l.config.showToolbarDialogsOnSelection||n?i.dialog.show(t):i.dialog.update(t)):i.dialog.hide())):i.tracksBlankValue?u.addClass(i.link,c):(u.removeClass(i.link,c),i.group&&u.removeClass(i.group,c),i.dialog&&!i.value&&i.dialog.hide()));for(e in s)"change_view"===(o=s[e]).name&&(o.state=this.editor.currentView===this.editor.textarea||"source"===this.editor.currentView,o.state?u.addClass(o.link,d):u.removeClass(o.link,d))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}}),h.Editor.prototype.defaults.toolbar=void 0,h.Editor.prototype.defaults.showToolbarAfterInit=!0,h.Editor.prototype.defaults.showToolbarDialogsOnSelection=!0,h.extendEditor(function(e){e.config.toolbar&&(e.toolbar=new h.toolbar.Toolbar(e,e.config.toolbar,e.config.showToolbarAfterInit),e.on("destroy:composer",function(){e&&e.toolbar&&e.toolbar.destroy()}))})}(wysihtml);
//# sourceMappingURL=wysihtml.toolbar.min.js.map